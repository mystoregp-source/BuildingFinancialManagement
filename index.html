<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø± Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø§Ø®ØªÙ…Ø§Ù† - Ù†Ø³Ø®Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„</title>
    <link rel="manifest" href="./manifest.json">
<script src="./app.js" defer></script>
<link rel="icon" href="./icon-192.png">
<meta name="theme-color" content="#64b5f6">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="apple-touch-icon" href="./icon-192.png">
    <style>
        /* ÙÙˆÙ†Øª ÙØ§Ø±Ø³ÛŒ */
        @font-face {
            font-family: 'Vazir';
            src: url('https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@v30.1.0/dist/Vazir.woff2') format('woff2');
            font-weight: normal;
            font-style: normal;
        }
        
        /* Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø±Ù†Ú¯ Ù¾Ø§ÛŒÙ‡ */
        :root {
            --primary-color: #f0f7ff;
            --secondary-color: #64b5f6;
            --text-color: #333;
            --header-bg: #e3f2fd;
            --card-bg: #ffffff;
            --button-bg: #64b5f6;
            --button-hover: #42a5f5;
            --tab-active: #64b5f6;
            --tab-inactive: #e3f2fd;
            --border-color: #ddd;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --export-color: #4CAF50;
            --import-color: #FF9800;
            --backup-color: #2196F3;
            --payments-color: #9C27B0;
            --payments-hover: #7B1FA2;
            --danger-color: #f44336;
            --success-color: #4CAF50;
            --warning-color: #ff9800;
        }
        /* ØªÙ… Ø¢Ø¨ÛŒ Ø´Ø¨Ø§Ù†Ù‡ (ØªÛŒØ±Ù‡â€ŒØªØ±ÛŒÙ†) */
[data-theme="midnight-blue"] {
    --primary-color: #e8f1f2;
    --secondary-color: #1b98e0;
    --text-color: #13293d;
    --header-bg: #247ba0;
    --card-bg: #ffffff;
    --button-bg: #1b98e0;
    --button-hover: #006494;
    --tab-active: #1b98e0;
    --tab-inactive: #e8f1f2;
    --border-color: #247ba0;
    --shadow-color: rgba(27, 152, 224, 0.15);
    --payments-color: #7b1fa2;
    --payments-hover: #6a1b9a;
}

/* ØªÙ… Ø¨Ù†ÙØ´-Ø®Ø§Ú©Ø³ØªØ±ÛŒ */
[data-theme="purple-gray"] {
    --primary-color: #f2e9e4;
    --secondary-color: #9a8c98;
    --text-color: #22223b;
    --header-bg: #4a4e69;
    --card-bg: #ffffff;
    --button-bg: #9a8c98;
    --button-hover: #4a4e69;
    --tab-active: #9a8c98;
    --tab-inactive: #f2e9e4;
    --border-color: #9a8c98;
    --shadow-color: rgba(154, 140, 152, 0.15);
    --payments-color: #4a4e69;
    --payments-hover: #22223b;
}

/* ØªÙ… Ø¢Ø¨ÛŒ Ø§Ø¨Ø±ÛŒ */
[data-theme="cloudy-blue"] {
    --primary-color: #e3f2fd;
    --secondary-color: #42a5f5;
    --text-color: #1565c0;
    --header-bg: #bbdefb;
    --card-bg: #ffffff;
    --button-bg: #42a5f5;
    --button-hover: #1e88e5;
    --tab-active: #42a5f5;
    --tab-inactive: #e3f2fd;
    --border-color: #90caf9;
    --shadow-color: rgba(66, 165, 245, 0.15);
    --payments-color: #7b1fa2;
    --payments-hover: #6a1b9a;
}

/* ØªÙ… Ø³Ø¨Ø² Ø¹Ù…ÛŒÙ‚ */
[data-theme="deep-green"] {
    --primary-color: #c9e4ca;
    --secondary-color: #55828b;
    --text-color: #364958;
    --header-bg: #3b6064;
    --card-bg: #ffffff;
    --button-bg: #55828b;
    --button-hover: #3b6064;
    --tab-active: #55828b;
    --tab-inactive: #c9e4ca;
    --border-color: #87bba2;
    --shadow-color: rgba(85, 130, 139, 0.15);
    --payments-color: #364958;
    --payments-hover: #3b6064;
}

/* ØªÙ… Ø³Ø¨Ø² Ø¨Ù‡Ø§Ø±ÛŒ */
[data-theme="spring-green"] {
    --primary-color: #f3e9d2;
    --secondary-color: #88d498;
    --text-color: #114b5f;
    --header-bg: #1a936f;
    --card-bg: #ffffff;
    --button-bg: #88d498;
    --button-hover: #1a936f;
    --tab-active: #88d498;
    --tab-inactive: #f3e9d2;
    --border-color: #c6dabf;
    --shadow-color: rgba(136, 212, 152, 0.15);
    --payments-color: #114b5f;
    --payments-hover: #1a936f;
}

/* ØªÙ… Ù‚Ù‡ÙˆÙ‡â€ŒØ§ÛŒ Ù…Ù„Ø§ÛŒÙ… */
[data-theme="soft-brown"] {
    --primary-color: #d6cfcb;
    --secondary-color: #a6808c;
    --text-color: #565264;
    --header-bg: #706677;
    --card-bg: #ffffff;
    --button-bg: #a6808c;
    --button-hover: #706677;
    --tab-active: #a6808c;
    --tab-inactive: #d6cfcb;
    --border-color: #ccb7ae;
    --shadow-color: rgba(166, 128, 140, 0.15);
    --payments-color: #565264;
    --payments-hover: #706677;
}

/* ØªÙ… Ø·Ø¨ÛŒØ¹Øª Ú¯Ø±Ù… */
[data-theme="warm-nature"] {
    --primary-color: #f4f1de;
    --secondary-color: #e07a5f;
    --text-color: #3d405b;
    --header-bg: #81b29a;
    --card-bg: #ffffff;
    --button-bg: #e07a5f;
    --button-hover: #d45d3e;
    --tab-active: #e07a5f;
    --tab-inactive: #f4f1de;
    --border-color: #f2cc8f;
    --shadow-color: rgba(224, 122, 95, 0.15);
    --payments-color: #81b29a;
    --payments-hover: #6a9c84;
}

/* ØªÙ… Ú©Ø±Ù…-Ø®Ø§Ú©Ø³ØªØ±ÛŒ (Ø±ÙˆØ´Ù†â€ŒØªØ±ÛŒÙ†) */
[data-theme="cream-gray"] {
    --primary-color: #fbfbf2;
    --secondary-color: #a6a2a2;
    --text-color: #847577;
    --header-bg: #cfd2cd;
    --card-bg: #ffffff;
    --button-bg: #a6a2a2;
    --button-hover: #847577;
    --tab-active: #a6a2a2;
    --tab-inactive: #fbfbf2;
    --border-color: #e5e6e4;
    --shadow-color: rgba(166, 162, 162, 0.15);
    --payments-color: #847577;
    --payments-hover: #cfd2cd;
}

/* Ú¯Ø±Ø§Ø¯ÛŒØ§Ù†Øª Ù…Ø³ØªÙ‚Ù„ Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ ØªÙ… */
.theme-btn[data-theme="midnight-blue"] { background: linear-gradient(135deg, #1b98e0, #006494); }
.theme-btn[data-theme="purple-gray"] { background: linear-gradient(135deg, #9a8c98, #4a4e69); }
.theme-btn[data-theme="cloudy-blue"] { background: linear-gradient(135deg, #42a5f5, #bbdefb); }
.theme-btn[data-theme="deep-green"] { background: linear-gradient(135deg, #55828b, #3b6064); }
.theme-btn[data-theme="spring-green"] { background: linear-gradient(135deg, #88d498, #1a936f); }
.theme-btn[data-theme="soft-brown"] { background: linear-gradient(135deg, #a6808c, #706677); }
.theme-btn[data-theme="warm-nature"] { background: linear-gradient(135deg, #e07a5f, #81b29a); }
.theme-btn[data-theme="cream-gray"] { background: linear-gradient(135deg, #a6a2a2, #847577); }


    .app-title {
    font-family: Vazir, sans-serif;
    font-size: 1.15rem !important;
    text-shadow: 0 0.4px 0.4px rgba(0,0,0,0.3);
    letter-spacing: -0.1px;
}

        
        /* Reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Vazir', sans-serif;
            -webkit-tap-highlight-color: transparent;
            -webkit-text-size-adjust: 100%;
        }
        
        body {
            background-color: var(--primary-color);
            color: var(--text-color);
            max-width: 100%;
            overflow-x: hidden;
            padding: 8px;
            min-height: 100vh;
            font-size: 14px;
            line-height: 1.4;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        .container {
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
            padding-bottom: 20px;
        }
        
        /* ========== Ù‡Ø¯Ø± Ø¬Ø¯ÛŒØ¯ ========== */
        .header-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        /* Ú©Ø§Ø±Øª Ø¹Ù†ÙˆØ§Ù† */
        .title-card {
    background: linear-gradient(145deg, 
        color-mix(in srgb, var(--header-bg) 65%, white),
        var(--header-bg),
        color-mix(in srgb, var(--header-bg) 65%, white)
    );
    padding: 16px 20px;
    border-radius: 16px;
    box-shadow: 0 4px 12px var(--shadow-color);
    border: 2px solid var(--border-color);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 15px;
    transition: all 0.3s ease;
}
        
        
        
        .settings-btn-large {
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--secondary-color);
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }
        
        .settings-btn-large:hover {
            background-color: color-mix(in srgb, var(--secondary-color) 15%, transparent);
            transform: rotate(30deg);
        }
        
        /* Ú©Ø§Ø±Øª ØªÙ…â€ŒÙ‡Ø§ */
        .title-card {
    background: linear-gradient(145deg, 
        color-mix(in srgb, var(--header-bg) 90%, white),
        var(--header-bg),
        color-mix(in srgb, var(--header-bg) 90%, white)
    );
    padding: 16px 20px;
    border-radius: 16px;
    box-shadow: 0 4px 12px var(--shadow-color);
    border: 2px solid var(--border-color);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 15px;
    transition: all 0.3s ease;
}

.themes-card {
    background: linear-gradient(145deg, 
        color-mix(in srgb, var(--header-bg) 40%, white),
        var(--header-bg),
        color-mix(in srgb, var(--header-bg) 40%, white)
    );
    padding: 12px 14px;
    border-radius: 14px;
    box-shadow: 0 4px 12px var(--shadow-color);
    border: 2px solid var(--border-color);
    transition: all 0.3s ease;
}
        
        .themes-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 6px;
            flex-wrap: nowrap;
            overflow-x: auto;
            padding: 4px 0;
            min-height: 36px;
        }
        
        .themes-container::-webkit-scrollbar {
            height: 4px;
        }
        
        .themes-container::-webkit-scrollbar-track {
            background: color-mix(in srgb, var(--secondary-color) 10%, transparent);
            border-radius: 2px;
        }
        
        .themes-container::-webkit-scrollbar-thumb {
            background: var(--secondary-color);
            border-radius: 2px;
        }
        
        /* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ ØªÙ… */
        .theme-btn {
            width: 32px;
            height: 32px;
            border-radius: 50px;
            cursor: pointer;
            border: none !important;
            transparent;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            flex-shrink: 0;
            position: relative;
            background-color: var(--theme-color, #e3f2fd);
        }
        
        /* Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ ØªÙ… */
        .theme-btn[data-theme="blue"] { --theme-color: #bbdefb; }
        .theme-btn[data-theme="green"] { --theme-color: #c8e6c9; }
        .theme-btn[data-theme="purple"] { --theme-color: #e1bee7; }
        .theme-btn[data-theme="dark"] { --theme-color: #2d2d2d; color: white; }
        .theme-btn[data-theme="gold"] { --theme-color: #ffecb3; }
        .theme-btn[data-theme="pink"] { --theme-color: #f8bbd9; }
        .theme-btn[data-theme="orange"] { --theme-color: #ffe0b2; }
        .theme-btn[data-theme="teal"] { --theme-color: #b2dfdb; }
        
        .theme-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .theme-btn.active {
            width: 32px;
            height: 32px;
            transform: scale(1.1);
            z-index: 1;
            position: relative;
            border: none !important;
        }
        
      /* ========== Ø³ÛŒØ³ØªÙ… ØªØ¨â€ŒÙ‡Ø§ Ø¨Ø§ Ú†ÛŒØ¯Ù…Ø§Ù† Ø¯Ùˆ Ø±Ø¯ÛŒÙ Ú†Ù‡Ø§Ø±ØªØ§ÛŒÛŒ ========== */
.tabs-container {
    position: relative;
    margin: 12px 0;
    background-color: transparent;  /* ØªØºÛŒÛŒØ± Ú©Ø±Ø¯Ù‡ */
    border: none;                   /* ØªØºÛŒÛŒØ± Ú©Ø±Ø¯Ù‡ */
    overflow: visible;              /* ØªØºÛŒÛŒØ± Ú©Ø±Ø¯Ù‡ */
}

.tabs-scroll {
    display: flex;
    flex-wrap: wrap;                /* ØªØºÛŒÛŒØ± Ú©Ø±Ø¯Ù‡ (Ù‚Ø¨Ù„Ø§Ù‹ nowrap Ø¨ÙˆØ¯) */
    gap: 2px;
    padding: 4px 2px;
    background-color: var(--tab-inactive);
    border-radius: 12px;             /* Ø§ÙØ²Ø§ÛŒØ´ ÛŒØ§ÙØªÙ‡ */
    border: 1px solid var(--border-color);
    overflow: visible;               /* ØªØºÛŒÛŒØ± Ú©Ø±Ø¯Ù‡ */
    -ms-overflow-style: none;
    scroll-behavior: smooth;
}

.tabs-scroll::-webkit-scrollbar {
    display: none;
}

.tab {
    flex: 0 0 calc(25% - 1.5px) !important;        /* Ø¬Ø¯ÛŒØ¯ - 4 ØªØ§ Ø¯Ø± Ù‡Ø± Ø±Ø¯ÛŒÙ */
    min-width: calc(25% - 1.5px) !important;       /* Ø¬Ø¯ÛŒØ¯ */
    max-width: calc(25% - 1.5px) !important;       /* Ø¬Ø¯ÛŒØ¯ */
    padding: 8px 2px;                               /* Ú©Ø§Ù‡Ø´ ÛŒØ§ÙØªÙ‡ */
    text-align: center;
    cursor: pointer;
    font-weight: 600;
    font-size: 0.75rem;                             /* Ú©Ø§Ù‡Ø´ ÛŒØ§ÙØªÙ‡ */
    user-select: none;
    transition: all 0.3s ease;
    border-radius: 8px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    position: relative;
    color: var(--text-color);
    background: linear-gradient(145deg, 
        color-mix(in srgb, var(--tab-inactive) 95%, white),
        color-mix(in srgb, var(--tab-inactive) 80%, var(--secondary-color))
    );
    min-height: 44px;                               /* Ø§Ø±ØªÙØ§Ø¹ Ø«Ø§Ø¨Øª */
    display: flex;
    flex-direction: column;                          /* ØªØºÛŒÛŒØ± Ú©Ø±Ø¯Ù‡ (Ù‚Ø¨Ù„Ø§Ù‹ row Ø¨ÙˆØ¯) */
    align-items: center;
    justify-content: center;
    gap: 2px;                                        /* Ø¬Ø¯ÛŒØ¯ */
}

/* Ø¢ÛŒÚ©ÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ù„Ø§ÛŒ ØªØ¨â€ŒÙ‡Ø§ - Ø¬Ø¯ÛŒØ¯ */
.tab::before {
    font-size: 1.2rem;
    display: block;
    margin-bottom: 2px;
}

/* Ø¢ÛŒÚ©ÙˆÙ†â€ŒÙ‡Ø§ÛŒ ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ù‡Ø± ØªØ¨ - Ø¬Ø¯ÛŒØ¯ */
.tab[data-tab="residents"]::before { content: "ğŸ‘¥"; }
.tab[data-tab="water"]::before { content: "ğŸ’§"; }
.tab[data-tab="electricity"]::before { content: "âš¡"; }
.tab[data-tab="gas"]::before { content: "ğŸ”¥"; }
.tab[data-tab="elevator"]::before { content: "ğŸ›—"; }
.tab[data-tab="cleaning"]::before { content: "ğŸ§¹"; }
.tab[data-tab="misc"]::before { content: "ğŸš§"; }
.tab[data-tab="payments"]::before { content: "ğŸ’°"; }

.tab.active {
    background: var(--tab-active) !important;
    color: white;
    box-shadow: 0 3px 8px rgba(0, 0, 0, 0.25);
    font-weight: 700 !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.3);
    transform: scale(1.02);
}

.tab:hover:not(.active) {
    background-color: color-mix(in srgb, var(--tab-active) 20%, transparent);
}

.tab-indicator {
    display: none;  /* Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù†Ø´Ø§Ù†Ú¯Ø± Ù¾Ø§ÛŒÛŒÙ† ØªØ¨ */
}

.tab-content {
    display: none;
    animation: fadeIn 0.3s ease;
}

.tab-content.active {
    display: block;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}
        
        /* ========== Ù…Ø­ØªÙˆØ§ Ùˆ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ ========== */
        .content-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px var(--shadow-color);
            border: 1px solid var(--border-color);
        }
        
        .tab-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--secondary-color);
        }
        
        .tab-title {
            font-size: 0.95rem;
            color: var(--secondary-color);
            font-weight: 600;
        }
        
        /* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ */
        .tab-action-btn {
            padding: 10px 16px;
            background: linear-gradient(135deg, var(--payments-color) 0%, var(--payments-hover) 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: bold;
            transition: all 0.3s ease;
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        .tab-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .tab-action-btn:active {
            transform: translateY(0);
        }
        
        .tab-action-btn.pulse {
            animation: pulse 0.5s ease;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        /* ÙØ±Ù…â€ŒÙ‡Ø§ */
        .form-row {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        @media (min-width: 480px) {
            .form-row {
                flex-direction: row;
            }
        }
        
        .form-input {
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.9rem;
            background-color: var(--card-bg);
            color: var(--text-color);
            min-height: 38px;
            width: 100%;
            transition: all 0.3s ease;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 2px color-mix(in srgb, var(--secondary-color) 30%, transparent);
        }
        
        .number-input {
            direction: ltr;
            text-align: left;
            font-family: monospace;
        }
        
        /* Ú†ÛŒØ¯Ù…Ø§Ù† ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ù‚Ø¨Ø¶ */
        .bill-fields-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .bill-fields-row.mobile-layout {
            display: flex;
            gap: 8px;
            margin-bottom: 0;
            align-items: flex-end;
        }
        
        .bill-field {
            display: flex;
            flex-direction: column;
            gap: 6px;
            flex: 1;
        }
        
        .bill-field label {
            font-size: 0.75rem;
            color: var(--text-color);
            opacity: 0.9;
            font-weight: bold;
            margin-bottom: 4px;
            display: block;
            white-space: nowrap;
        }
        
        .bill-field.period-field {
            min-width: 90px;
        }
        
        .bill-field.amount-field {
            min-width: 110px;
        }
        
        .bill-field.method-field {
            min-width: 120px;
        }
        
        .bill-field.bill-id-field,
        .bill-field.description-field {
            min-width: 120px;
        }
        
        .payment-input {
            max-width: 120px;
            height: 32px;
            font-size: 0.85rem;
            padding: 6px 8px;
            direction: ltr;
            text-align: left;
        }
        
        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 16px;
        }
        
        /* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ */
        .btn {
            padding: 12px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            font-weight: 600;
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex: 1;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #1976D2 0%, #2196F3 100%);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success-color) 0%, #2E7D32 100%);
            color: white;
        }
        
        .btn-success:hover {
            background: linear-gradient(135deg, #2E7D32 0%, var(--success-color) 100%);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger-color) 0%, #d32f2f 100%);
            color: white;
        }
        
        .btn-danger:hover {
            background: linear-gradient(135deg, #d32f2f 0%, var(--danger-color) 100%);
            box-shadow: 0 4px 12px rgba(244, 67, 54, 0.3);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, var(--warning-color) 0%, #f57c00 100%);
            color: white;
        }
        
        .btn-warning:hover {
            background: linear-gradient(135deg, #f57c00 0%, var(--warning-color) 100%);
            box-shadow: 0 4px 12px rgba(255, 152, 0, 0.3);
        }
        
        .btn-info {
            background: linear-gradient(135deg, #00bcd4 0%, #0097a7 100%);
            color: white;
        }
        
        .btn-info:hover {
            background: linear-gradient(135deg, #0097a7 0%, #00bcd4 100%);
            box-shadow: 0 4px 12px rgba(0, 188, 212, 0.3);
        }
        
        .btn-payments {
            background: linear-gradient(135deg, var(--payments-color) 0%, var(--payments-hover) 100%);
            color: white;
        }
        
        .btn-payments:hover {
            background: linear-gradient(135deg, var(--payments-hover) 0%, var(--payments-color) 100%);
            box-shadow: 0 4px 12px rgba(156, 39, 176, 0.3);
        }
        
        /* Ú©Ø§Ø±Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù‚Ø¨Ø¶ */
        .bill-info-card {
            background-color: color-mix(in srgb, var(--card-bg) 95%, var(--secondary-color));
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 12px;
            border: 1px solid var(--border-color);
        }
        
        /* Ø¬Ø¯Ø§ÙˆÙ„ */
        .table-container {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 16px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
        }
        
        .table-container::-webkit-scrollbar {
            width: 6px;
        }
        
        .table-container::-webkit-scrollbar-track {
            background: color-mix(in srgb, var(--secondary-color) 10%, transparent);
            border-radius: 3px;
        }
        
        .table-container::-webkit-scrollbar-thumb {
            background: var(--secondary-color);
            border-radius: 3px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }
        
        .data-table th, .data-table td {
            padding: 12px 10px;
            text-align: right;
            border-bottom: 1px solid var(--border-color);
        }
        
        .data-table th {
            background-color: var(--secondary-color);
            color: white;
            font-weight: 700;
            padding: 14px 10px;
            position: sticky;
            top: 0;
            z-index: 1;
            font-size: 0.9rem;
        }
        
        .data-table tr:nth-child(even) {
            background-color: color-mix(in srgb, var(--secondary-color) 5%, transparent);
        }
        
        /* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª */
        .action-buttons {
            display: flex;
            gap: 6px;
        }
        
        .action-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s ease;
            font-weight: 500;
            min-height: 36px;
        }
        
        /* Ø®Ù„Ø§ØµÙ‡ */
        .summary-box {
            margin-top: 16px;
            padding: 16px;
            background-color: color-mix(in srgb, var(--secondary-color) 10%, transparent);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        
        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }
        
        .summary-total {
            font-weight: bold;
            color: var(--danger-color);
        }
        
        .summary-calculated {
            font-weight: bold;
            color: var(--success-color);
        }
        
        .summary-status {
            text-align: center;
            margin-top: 12px;
            padding: 8px;
            border-radius: 6px;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .status-match {
            background-color: rgba(76, 175, 80, 0.1);
            color: var(--success-color);
        }
        
        .status-mismatch {
            background-color: rgba(244, 67, 54, 0.1);
            color: var(--danger-color);
        }
        
        .status-paid {
            background-color: rgba(156, 39, 176, 0.1);
            color: var(--payments-color);
        }
        
        /* ØªÙ†Ø¸ÛŒÙ…Ø§Øª */
        .settings-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 16px;
            display: none;
        }
        
        .settings-content {
            background-color: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            width: 100%;
            max-width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .settings-content::-webkit-scrollbar {
            width: 8px;
        }
        
        .settings-content::-webkit-scrollbar-track {
            background: color-mix(in srgb, var(--secondary-color) 10%, transparent);
            border-radius: 4px;
        }
        
        .settings-content::-webkit-scrollbar-thumb {
            background: var(--secondary-color);
            border-radius: 4px;
        }
        
        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--secondary-color);
        }
        
        .settings-title {
            font-size: 1.1rem;
            color: var(--secondary-color);
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .close-settings-btn {
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--text-color);
            opacity: 0.7;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }
        
        .close-settings-btn:hover {
            opacity: 1;
            background-color: color-mix(in srgb, var(--secondary-color) 10%, transparent);
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .settings-card {
            background: var(--primary-color);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 12px 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 70px;
        }
        
        .settings-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px var(--shadow-color);
            border-color: var(--secondary-color);
        }
        
        .settings-card-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
        }
        
        .settings-icon {
            font-size: 1.8rem;
            order: 1;
            flex-shrink: 0;
        }
        
        .settings-label {
            font-size: 0.85rem;
            font-weight: bold;
            color: var(--text-color);
            order: 2;
            text-align: right;
            flex-grow: 1;
        }
        
        .settings-form {
            margin-top: 20px;
            display: none;
        }
        
        .settings-form.active {
            display: block;
        }
        
        /* Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ø²Ú¯Ø´Øª */
        .back-btn {
            background: linear-gradient(135deg, var(--secondary-color) 0%, var(--button-hover) 100%);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 14px 20px;
            font-size: 0.95rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            font-weight: bold;
            transition: all 0.3s ease;
            width: 100%;
            min-height: 48px;
        }
        
        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        /* Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ */
        .data-management-buttons {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        
        .data-management-buttons .btn {
            flex: 1 0 calc(50% - 10px);
            min-width: 0;
            max-width: calc(50% - 10px);
            margin: 5px;
        }
        
        .data-management-buttons {
            margin: -5px;
        }
        
        .export-section {
            margin-bottom: 20px;
        }
        
        .section-title {
            font-size: 0.9rem;
            color: var(--text-color);
            font-weight: bold;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
        }
        
        /* ÙÛŒÙ„ØªØ±ÛŒÙ†Ú¯ Ø¢Ø±Ø´ÛŒÙˆ */
        .archive-filters-panel {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 12px var(--shadow-color);
            max-height: 400px;
            overflow-y: auto;
        }
        
        .filter-section {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .filter-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .filter-title {
            font-weight: bold;
            margin-bottom: 12px;
            color: var(--text-color);
            font-size: 0.95rem;
        }
        
        .filter-checkboxes {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 12px;
        }
        
        .filter-checkbox {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            font-size: 0.85rem;
            padding: 12px 16px;
            background: color-mix(in srgb, var(--primary-color) 90%, var(--secondary-color));
            border-radius: 8px;
            cursor: pointer;
            user-select: none;
            min-width: 80px;
            transition: all 0.2s ease;
            border: 2px solid transparent;
            font-weight: 500;
        }
        
        .filter-checkbox:hover {
            background: color-mix(in srgb, var(--primary-color) 80%, var(--secondary-color));
            transform: translateY(-2px);
        }
        
        .filter-checkbox.active {
            background: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
            font-weight: bold;
        }
        
        .filter-checkbox.active::before {
            content: 'âœ“ ';
            font-weight: bold;
        }
        
        .filter-actions-row {
            display: flex;
            gap: 10px;
            margin-top: 16px;
            flex-wrap: wrap;
        }
        
        .quick-select-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 12px;
        }
        
        .quick-select-btn {
            padding: 10px 16px;
            border: 2px solid var(--border-color);
            background: var(--card-bg);
            border-radius: 8px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            min-height: 44px;
        }
        
        .quick-select-btn:hover {
            border-color: var(--secondary-color);
            background: color-mix(in srgb, var(--secondary-color) 15%, transparent);
        }
        
        .quick-select-btn.active {
            background: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
        }
        
        .date-inputs-row {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 12px;
        }
        
        @media (min-width: 480px) {
            .date-inputs-row {
                flex-direction: row;
                align-items: center;
            }
        }
        
        .date-input {
            flex: 1;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.9rem;
            background: var(--card-bg);
            color: var(--text-color);
            text-align: center;
            min-height: 44px;
        }
        
        .date-input::placeholder {
            color: #999;
        }
        
        /* ØµÙØ­Ù‡ Ø¢Ø±Ø´ÛŒÙˆ */
        .archive-page {
            display: none;
        }
        
        .archive-page.active {
            display: block;
        }
        
        .archive-header {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        @media (min-width: 480px) {
            .archive-header {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
        }
        
        .filter-toggle-btn {
            padding: 12px 16px;
            background: linear-gradient(135deg, var(--payments-color) 0%, var(--payments-hover) 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            min-height: 48px;
            flex: 1;
        }
        
        /* Ú¯Ø²Ø§Ø±Ø´ ØªØ¬Ù…ÛŒØ¹ÛŒ ÙˆØ§Ø­Ø¯ */
        .unit-report-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2001;
            padding: 16px;
            display: none;
        }
        
        .unit-report-content {
            background-color: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            width: 100%;
            max-width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }
        
        .unit-report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--payments-color);
        }
        
        .unit-report-title {
            font-size: 1.1rem;
            color: var(--payments-color);
            font-weight: bold;
        }
        
        .report-summary {
            background: color-mix(in srgb, var(--payments-color) 10%, transparent);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            border: 1px solid var(--payments-color);
        }
        
        .report-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 0.9rem;
            line-height: 1.3;
        }
        
        .report-item.total {
            font-weight: bold;
            font-size: 1rem;
            padding-top: 12px;
            border-top: 1px solid var(--border-color);
            margin-top: 8px;
        }
        
        /* Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--success-color);
            color: white;
            padding: 14px 24px;
            border-radius: 10px;
            z-index: 9999;
            box-shadow: 0 6px 16px rgba(0,0,0,0.2);
            animation: fadeIn 0.3s ease;
            max-width: 90%;
            text-align: center;
            font-weight: 500;
            font-size: 0.95rem;
        }
        
        .notification.error {
            background: var(--danger-color);
        }
        
        .notification.info {
            background: var(--secondary-color);
        }
        
        
        /* ===== FIX FOOTER POSITION - Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡ ===== */
html, body {
    height: 100%;
    margin: 0;
    padding: 0;
}

body {
    display: flex;
    flex-direction: column;
    min-height: 100vh;
}

.container {
    flex: 1 0 auto;
    width: 100%;
    padding-bottom: 20px;  /* Ú©Ø§Ù‡Ø´ padding */
}

.footer {
    flex-shrink: 0;  /* ØªØºÛŒÛŒØ± Ø§Ø² position: absolute */
    text-align: center;
    padding: 15px;
    color: var(--text-color);
    opacity: 0.6;
    font-size: 0.75rem;
    border-top: 1px solid var(--border-color);
    background: transparent;
    width: 100%;
    margin-top: 20px;  /* ÙØ§ØµÙ„Ù‡ Ø§Ø² Ù…Ø­ØªÙˆØ§ */
    position: relative;  /* ØªØºÛŒÛŒØ± Ø§Ø² absolute */
    bottom: auto;
    left: auto;
    right: auto;
    height: auto;  /* Ø­Ø°Ù Ø§Ø±ØªÙØ§Ø¹ Ø«Ø§Ø¨Øª */
}


        /* ========== Ø±ÛŒØ³Ù¾Ø§Ù†Ø³ÛŒÙˆ ========== */
        @media (max-width: 480px) {
            .container {
                padding: 6px;
            }
            
            .content-card {
                padding: 12px;
            }
            
            /* Ù‡Ø¯Ø± Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„ */
            .title-card {
                padding: 12px 16px;
            }
            
            .app-title {
                font-size: 1.1rem;
            }
            
            .settings-btn-large {
                width: 44px;
                height: 44px;
                font-size: 1.6rem;
            }
            
            .themes-card {
                padding: 10px 12px;
            }
            
            .theme-btn {
                width: 30px;
                height: 30px;
                font-size: 0.95rem;
            }
            
            .theme-btn.active {
                width: 34px;
                height: 34px;
            }
            
            /* ØªØ¶Ù…ÛŒÙ† Ù†Ù…Ø§ÛŒØ´ Ù‡Ù…Ù‡ ØªÙ…â€ŒÙ‡Ø§ Ø¯Ø± ÛŒÚ© Ø®Ø· */
            .themes-container {
                min-width: 300px;
            }
            
            .data-table {
                font-size: 0.8rem;
            }
            
            .data-table th, .data-table td {
                padding: 8px 5px;
            }
            
            .data-table th {
                font-size: 0.8rem;
                padding: 10px 5px;
            }
            
            .form-input {
                min-height: 34px !important;
                padding: 6px 8px !important;
                font-size: 0.85rem !important;
            }
            
            .bill-info-card .form-input {
                min-height: 30px !important;
                padding: 4px 8px !important;
                font-size: 0.8rem !important;
            }
            
            .bill-fields-row.mobile-layout {
                flex-wrap: wrap;
            }
            
            .bill-field {
                flex: 1 0 calc(50% - 8px) !important;
                min-width: calc(50% - 8px) !important;
                max-width: calc(50% - 8px) !important;
            }
            
            .bill-field.period-field,
            .bill-field.amount-field,
            .bill-field.method-field,
            .bill-field.bill-id-field,
            .bill-field.description-field {
                flex: 1 0 calc(50% - 8px) !important;
                min-width: calc(50% - 8px) !important;
                max-width: calc(50% - 8px) !important;
            }
            
            .bill-field label {
                font-size: 0.7rem;
                font-weight: bold;
                margin-bottom: 2px;
            }
            
            .btn, .tab-action-btn {
                padding: 8px 12px;
                font-size: 0.85rem;
                min-height: 36px;
            }
            
            .action-btn {
                padding: 4px 6px;
                font-size: 0.75rem;
                min-height: 28px;
            }
            
            /* ØªØ¨â€ŒÙ‡Ø§ Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„ */
            .tab {
                padding: 8px 5px;
                font-size: 0.75rem;
            }
            
            .tab-action-btn {
                padding: 8px 10px;
                font-size: 0.8rem;
            }
            
            .settings-grid {
                grid-template-columns: 1fr;
            }
            
            .settings-card {
                min-height: 70px;
                padding: 10px 6px;
            }
            
            .settings-icon {
                font-size: 1.6rem;
            }
            
            .data-management-buttons .btn {
                flex: 1 0 calc(50% - 10px) !important;
                min-width: calc(50% - 10px) !important;
                max-width: calc(50% - 10px) !important;
                font-size: 0.75rem !important;
                padding: 8px 6px !important;
                margin: 4px !important;
            }
            
            .filter-checkbox {
                flex: 1;
                min-width: 70px;
                padding: 8px 10px;
                font-size: 0.75rem;
                min-height: 32px;
            }
            
            .back-btn {
                padding: 10px 14px;
                font-size: 0.85rem;
                min-height: 40px;
            }
            
            .report-item {
                font-size: 0.8rem;
            }
            
            .action-buttons {
                flex-direction: row !important;
                gap: 4px !important;
                flex-wrap: nowrap !important;
            }
            
            .action-buttons .action-btn {
                padding: 3px 5px !important;
                font-size: 0.7rem !important;
                min-height: 26px !important;
            }
            
            .archive-page .action-btn {
                padding: 3px 5px !important;
                font-size: 0.7rem !important;
                min-height: 24px !important;
            }
            
            @media (max-width: 380px) {
                .tab {
                    font-size: 0.7rem;
                    padding: 6px 3px;
                }
                
                .data-management-buttons .btn {
                    flex: 1 0 100% !important;
                    min-width: 100% !important;
                    max-width: 100% !important;
                }
                
                /* ØªÙ†Ø¸ÛŒÙ…Ø§Øª ØªÙ… Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø®ÛŒÙ„ÛŒ Ú©ÙˆÚ†Ú© */
                .themes-container {
                    min-width: 280px;
                    gap: 4px;
                }
                
                .theme-btn {
                    width: 24px;
                    height: 24px;
                    font-size: 0.9rem;
                }
                
                .theme-btn.active {
                    width: 32px;
                    height: 32px;
                }
            }
        }
        
        @media (max-width: 360px) {
            .tab {
                font-size: 0.7rem;
                padding: 6px 3px;
            }
            
            .tab-title {
                font-size: 0.85rem;
            }
            
            .action-buttons {
                gap: 2px;
            }
            
            .action-btn {
                padding: 2px 4px;
                font-size: 0.7rem;
                min-height: 24px;
            }
            
            .settings-card {
                min-height: 65px;
            }
            
            .data-management-buttons .btn {
                flex: 1 0 100% !important;
                min-width: 100% !important;
                max-width: 100% !important;
                font-size: 0.75rem !important;
            }
        }
        
        /* ÙˆØ¶Ø¹ÛŒØª Ù„ÙˆØ¯ÛŒÙ†Ú¯ */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--secondary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Ù¾ÛŒØ§Ù… Ø®Ø§Ù„ÛŒ */
        .empty-message {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-color);
            opacity: 0.6;
            font-size: 0.95rem;
        }
        
        /* Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ */
        .category-section {
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .category-title {
            font-size: 1rem;
            color: var(--secondary-color);
            font-weight: bold;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Ø¨Ù‡Ø¨ÙˆØ¯ ÙÙˆÚ©ÙˆØ³ */
        button:focus, input:focus, select:focus, textarea:focus {
    outline: none !important;
}
        
        /* Ø¨Ù‡Ø¨ÙˆØ¯ Ù„Ù…Ø³ÛŒ */
        @media (hover: none) {
            .btn:hover, .tab:hover, .settings-card:hover, .filter-checkbox:hover {
                transform: none;
            }
            
            .tab-action-btn:hover {
                transform: none;
                box-shadow: none;
            }
            
            .theme-btn:hover {
                transform: none;
                box-shadow: none;
            }
            
            .settings-btn-large:hover {
                transform: none;
            }
        }
        
        /* ========== Ú†Ø§Ù¾ ========== */
        @media print {
            body * {
                visibility: hidden;
            }
            
            .settings-modal,
            .unit-report-modal {
                position: absolute !important;
                top: 0 !important;
                left: 0 !important;
                width: 100% !important;
                height: auto !important;
                background: white !important;
                margin: 0 !important;
                padding: 20mm !important;
                box-shadow: none !important;
                border: none !important;
                display: block !important;
                z-index: 999999 !important;
            }
            
            .settings-modal *,
            .unit-report-modal * {
                visibility: visible !important;
            }
            
            .settings-content,
            .unit-report-content {
                max-height: none !important;
                height: auto !important;
                overflow: visible !important;
                border-radius: 0 !important;
                box-shadow: none !important;
                padding: 20mm !important;
                margin: 0 !important;
                page-break-inside: avoid !important;
            }
            
            .btn, .action-btn, .tab-action-btn, .form-actions,
            .back-btn, .settings-card, .filter-checkbox,
            .theme-btn, .settings-btn-large, .close-settings-btn {
                display: none !important;
            }
            
            body {
                font-family: 'Vazir', Tahoma, sans-serif !important;
                font-size: 12pt !important;
                line-height: 1.6 !important;
                color: #000 !important;
                background: white !important;
            }
            
            .data-table {
                font-size: 10pt !important;
                border: 1px solid #333 !important;
                width: 100% !important;
                border-collapse: collapse !important;
            }
            
            .data-table th {
                background-color: #f0f0f0 !important;
                color: #000 !important;
                font-weight: bold !important;
                border: 1px solid #ddd !important;
            }
            
            .data-table td {
                border-bottom: 1px solid #ddd !important;
                border: 1px solid #ddd !important;
            }
            
            .summary-row, .report-item {
                font-size: 11pt !important;
            }
            
            .report-summary, .summary-box {
                border: 1px solid #333 !important;
                page-break-inside: avoid !important;
                background: #f9f9f9 !important;
                margin: 15px 0 !important;
                padding: 15px !important;
            }
            
            .print-optimized {
                font-family: 'Vazir', Tahoma, sans-serif !important;
                line-height: 1.6 !important;
                color: #000 !important;
                background: white !important;
            }
            
            .print-optimized .data-table {
                width: 100% !important;
                border-collapse: collapse !important;
                font-size: 11pt !important;
            }
            
            .print-optimized .data-table th {
                background-color: #f5f5f5 !important;
                font-weight: bold !important;
                padding: 8px !important;
                border: 1px solid #ddd !important;
            }
            
            .print-optimized .data-table td {
                padding: 6px 8px !important;
                border: 1px solid #ddd !important;
            }
            
            .print-optimized h1, 
            .print-optimized h2, 
            .print-optimized h3 {
                color: #000 !important;
                margin: 15px 0 10px 0 !important;
                font-weight: bold !important;
            }
            
            .tab-header, .settings-header, .unit-report-header {
                border-bottom: 2px solid #000 !important;
                margin-bottom: 20px !important;
            }
            
            .tab-title, .settings-title, .unit-report-title {
                color: #000 !important;
                font-weight: bold !important;
                font-size: 14pt !important;
            }
            
            .content-card {
                break-inside: avoid !important;
                page-break-inside: avoid !important;
                border: 1px solid #ddd !important;
                margin-bottom: 10px !important;
                padding: 10px !important;
                background: white !important;
            }
        }
        
        /* ÙÙˆØªØ± */
        .footer {
            text-align: center;
            padding: 20px;
            color: var(--text-color);
            opacity: 0.6;
            font-size: 0.75rem;
            margin-top: 20px;
            border-top: 1px solid var(--border-color);
        }
        
        /* ØªØ¶Ù…ÛŒÙ† Ù†Ù…Ø§ÛŒØ´ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒÙ‡Ø§ */
#generateUnitReportBtn,
#exportUnitReportBtn,
#printUnitReportBtn,
#exportUnitReportPDFBtn {
    display: inline-flex !important;
    visibility: visible !important;
    opacity: 1 !important;
    position: relative !important;
    z-index: 9999 !important;
    pointer-events: auto !important;
    min-width: 120px !important;
}

/* ØªØ¶Ù…ÛŒÙ† Ù†Ù…Ø§ÛŒØ´ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ø¯Ø± Ù…ÙˆØ¯Ø§Ù„ */
.unit-report-content .btn,
.unit-report-content .form-actions .btn {
    display: inline-flex !important;
    visibility: visible !important;
    opacity: 1 !important;
}


    </style>
</head>
<body>
    <div class="container">
        <!-- Ù‡Ø¯Ø± Ø¬Ø¯ÛŒØ¯ -->
        <div class="header-container">
            <!-- Ú©Ø§Ø±Øª Ø¹Ù†ÙˆØ§Ù† -->
            <div class="title-card">
                <div class="app-title" id="appTitle">
                    Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø± Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø§Ø®ØªÙ…Ø§Ù†
                </div>
                <button class="settings-btn-large" id="settingsBtn" title="ØªÙ†Ø¸ÛŒÙ…Ø§Øª">âš™ï¸</button>
            </div>
            
            <!-- Ú©Ø§Ø±Øª ØªÙ…â€ŒÙ‡Ø§ -->
            <div class="themes-card">
                <div class="themes-container" id="themesContainer">
                    <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ ØªÙ… Ø¨Ù‡ ØµÙˆØ±Øª Ø¯ÛŒÙ†Ø§Ù…ÛŒÚ© Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
                </div>
            </div>
        </div>
        
        <!-- ØªØ¨â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ -->
<div class="tabs-container">
    <div class="tabs-scroll" id="tabsScroll">
        <div class="tab active" data-tab="residents">
            <span>Ø³Ø§Ú©Ù†ÛŒÙ†</span>
            <div class="tab-indicator"></div>
        </div>
        <div class="tab" data-tab="water">
            <span>Ø¢Ø¨</span>
            <div class="tab-indicator"></div>
        </div>
        <div class="tab" data-tab="electricity">
            <span>Ø¨Ø±Ù‚</span>
            <div class="tab-indicator"></div>
        </div>
        <div class="tab" data-tab="gas">
            <span>Ú¯Ø§Ø²</span>
            <div class="tab-indicator"></div>
        </div>
        <div class="tab" data-tab="elevator">
            <span>Ø¢Ø³Ø§Ù†Ø³ÙˆØ±</span>
            <div class="tab-indicator"></div>
        </div>
        <div class="tab" data-tab="cleaning">
            <span>Ù†Ø¸Ø§ÙØª</span>
            <div class="tab-indicator"></div>
        </div>
        <div class="tab" data-tab="misc">
            <span>Ù…ØªÙØ±Ù‚Ù‡</span>
            <div class="tab-indicator"></div>
        </div>
        <div class="tab" data-tab="payments">
            <span>Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒÙ‡Ø§</span>
            <div class="tab-indicator"></div>
        </div>
    </div>
</div>
        
        <!-- Ù…Ø­ØªÙˆØ§ÛŒ ØªØ¨â€ŒÙ‡Ø§ -->
        <div id="residents-tab" class="tab-content active">
            <div class="content-card">
                <div class="tab-header">
                    <div class="tab-title">Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø§Ú©Ù†ÛŒÙ† Ø³Ø§Ø®ØªÙ…Ø§Ù†</div>
                    <button class="tab-action-btn pulse" id="addResidentBtn">Ø§ÙØ²ÙˆØ¯Ù† Ø³Ø§Ú©Ù†</button>
                </div>
                
                <div id="residentForm" style="display: none; margin-bottom: 16px; padding: 16px; background-color: color-mix(in srgb, var(--secondary-color) 5%, transparent); border-radius: 10px;">
                    <div class="form-row">
                        <div class="bill-field">
                            <label for="residentName">Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</label>
                            <input type="text" id="residentName" class="form-input" placeholder="Ù†Ø§Ù… Ú©Ø§Ù…Ù„">
                        </div>
                        <div class="bill-field">
                            <label for="unitNumber">Ø´Ù…Ø§Ø±Ù‡ ÙˆØ§Ø­Ø¯</label>
                            <input type="text" id="unitNumber" class="form-input" placeholder="Ù…Ø«Ø§Ù„: Û±Û°Û±">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="bill-field">
                            <label for="phoneNumber">Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ†</label>
                            <input type="tel" id="phoneNumber" class="form-input" placeholder="Û°Û¹Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹" dir="ltr">
                        </div>
                        <div class="bill-field">
                            <label for="residentCount">ØªØ¹Ø¯Ø§Ø¯ Ø³Ø§Ú©Ù†ÛŒÙ†</label>
                            <input type="text" id="residentCount" class="form-input number-input" placeholder="ØªØ¹Ø¯Ø§Ø¯" inputmode="numeric">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="bill-field">
                            <label for="unitArea">Ù…ØªØ±Ø§Ú˜ ÙˆØ§Ø­Ø¯</label>
                            <input type="text" id="unitArea" class="form-input number-input" placeholder="Ù…ØªØ± Ù…Ø±Ø¨Ø¹" inputmode="decimal">
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-danger" id="cancelAddBtn">Ù„ØºÙˆ</button>
                            <button class="btn btn-success" id="saveResidentBtn">Ø°Ø®ÛŒØ±Ù‡</button>
                        </div>
                    </div>
                </div>
                
                <div class="table-container">
                    <table class="data-table" id="residentsTable">
                        <thead>
                            <tr>
                                <th>Ø±Ø¯ÛŒÙ</th>
                                <th>Ù†Ø§Ù…</th>
                                <th>ÙˆØ§Ø­Ø¯</th>
                                <th>ØªÙ„ÙÙ†</th>
                                <th>Ù†ÙØ±Ø§Øª</th>
                                <th>Ù…ØªØ±Ø§Ú˜</th>
                                <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="residentsList">
                            <!-- Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
                        </tbody>
                    </table>
                </div>
                
                <div style="text-align: center; margin-top: 16px; color: var(--text-color); opacity: 0.7; font-size: 0.85rem;">
                    <span id="residentsCount">ØªØ¹Ø¯Ø§Ø¯ Ø³Ø§Ú©Ù†ÛŒÙ†: Û° Ù†ÙØ±</span> | 
                    <span id="unitsCount">ØªØ¹Ø¯Ø§Ø¯ ÙˆØ§Ø­Ø¯Ù‡Ø§: Û° ÙˆØ§Ø­Ø¯</span>
                </div>
            </div>
        </div>
        
        <!-- ØªØ¨ Ø¢Ø¨ -->
        <div id="water-tab" class="tab-content">
            <div class="content-card">
                <div class="tab-header">
                    <div class="tab-title">Ù…Ø¯ÛŒØ±ÛŒØª Ù‚Ø¨Ø¶ Ø¢Ø¨</div>
                    <button class="tab-action-btn pulse" id="calculateWaterBtn">Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³Ù‡Ù…</button>
                </div>
                
                <div class="bill-info-card">
                    <div class="bill-fields-container">
                        <div class="bill-fields-row mobile-layout">
                            <div class="bill-field period-field">
                                <label for="waterPeriod">Ø¯ÙˆØ±Ù‡</label>
                                <input type="text" id="waterPeriod" class="form-input" placeholder="1403/01" maxlength="7">
                            </div>
                            
                            <div class="bill-field amount-field">
                                <label for="waterTotal">Ù…Ø¨Ù„Øº</label>
                                <input type="text" id="waterTotal" class="form-input number-input" placeholder="ØªÙˆÙ…Ø§Ù†" inputmode="numeric" maxlength="13">
                            </div>
                        </div>
                        
                        <div class="bill-fields-row mobile-layout">
                            <div class="bill-field method-field">
                                <label for="waterMethod">Ø±ÙˆØ´ Ù…Ø­Ø§Ø³Ø¨Ù‡</label>
                                <select id="waterMethod" class="form-input">
                                    <option value="" disabled selected>Ø§Ù†ØªØ®Ø§Ø¨</option>
                                    <option value="per_resident">ØªØ¹Ø¯Ø§Ø¯ Ù†ÙØ±Ø§Øª</option>
                                    <option value="per_unit">ØªØ¹Ø¯Ø§Ø¯ ÙˆØ§Ø­Ø¯Ù‡Ø§</option>
                                    <option value="per_area">Ù…ØªØ±Ø§Ú˜ ÙˆØ§Ø­Ø¯Ù‡Ø§</option>
                                </select>
                            </div>
                            
                            <div class="bill-field bill-id-field">
                                <label for="waterBillId">Ø´Ù†Ø§Ø³Ù‡ Ù‚Ø¨Ø¶</label>
                                <input type="text" id="waterBillId" class="form-input" placeholder="Ø´Ù†Ø§Ø³Ù‡ Ù‚Ø¨Ø¶" maxlength="20">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="table-container">
                    <table class="data-table" id="waterTable">
                        <thead>
                            <tr>
                                <th>ÙˆØ§Ø­Ø¯</th>
                                <th>Ù†Ø§Ù…</th>
                                <th>Ù†ÙØ±Ø§Øª</th>
                                <th>Ø³Ù‡Ù…</th>
                                <th>Ù¾ÛŒØ§Ù…Ú©</th>
                            </tr>
                        </thead>
                        <tbody id="waterList">
                            <!-- Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
                        </tbody>
                    </table>
                </div>
                
                <div class="summary-box" id="waterSummary">
                    <div class="summary-row">
                        <span>Ù…Ø¨Ù„Øº Ú©Ù„ Ù‚Ø¨Ø¶:</span>
                        <span class="summary-total" id="waterTotalAmount">Û° ØªÙˆÙ…Ø§Ù†</span>
                    </div>
                    <div class="summary-row">
                        <span>Ø¬Ù…Ø¹ Ø³Ù‡Ù… ÙˆØ§Ø­Ø¯Ù‡Ø§:</span>
                        <span class="summary-calculated" id="waterCalculatedAmount">Û° ØªÙˆÙ…Ø§Ù†</span>
                    </div>
                    <div class="summary-status" id="waterStatus">
                        Ø§Ø¨ØªØ¯Ø§ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø±Ø§ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ØªØ¨ Ø¨Ø±Ù‚ -->
        <div id="electricity-tab" class="tab-content">
            <div class="content-card">
                <div class="tab-header">
                    <div class="tab-title">Ù…Ø¯ÛŒØ±ÛŒØª Ù‚Ø¨Ø¶ Ø¨Ø±Ù‚</div>
                    <button class="tab-action-btn pulse" id="calculateElectricityBtn">Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³Ù‡Ù…</button>
                </div>
                
                <div class="bill-info-card">
                    <div class="bill-fields-container">
                        <div class="bill-fields-row mobile-layout">
                            <div class="bill-field period-field">
                                <label for="electricityPeriod">Ø¯ÙˆØ±Ù‡</label>
                                <input type="text" id="electricityPeriod" class="form-input" placeholder="1403/01" maxlength="7">
                            </div>
                            
                            <div class="bill-field amount-field">
                                <label for="electricityTotal">Ù…Ø¨Ù„Øº</label>
                                <input type="text" id="electricityTotal" class="form-input number-input" placeholder="ØªÙˆÙ…Ø§Ù†" inputmode="numeric" maxlength="13">
                            </div>
                        </div>
                        
                        <div class="bill-fields-row mobile-layout">
                            <div class="bill-field method-field">
                                <label for="electricityMethod">Ø±ÙˆØ´ Ù…Ø­Ø§Ø³Ø¨Ù‡</label>
                                <select id="electricityMethod" class="form-input">
                                    <option value="" disabled selected>Ø§Ù†ØªØ®Ø§Ø¨</option>
                                    <option value="per_unit">ØªØ¹Ø¯Ø§Ø¯ ÙˆØ§Ø­Ø¯Ù‡Ø§</option>
                                    <option value="per_resident">ØªØ¹Ø¯Ø§Ø¯ Ù†ÙØ±Ø§Øª</option>
                                    <option value="per_area">Ù…ØªØ±Ø§Ú˜ ÙˆØ§Ø­Ø¯Ù‡Ø§</option>
                                </select>
                            </div>
                            
                            <div class="bill-field bill-id-field">
                                <label for="electricityBillId">Ø´Ù†Ø§Ø³Ù‡ Ù‚Ø¨Ø¶</label>
                                <input type="text" id="electricityBillId" class="form-input" placeholder="Ø´Ù†Ø§Ø³Ù‡ Ù‚Ø¨Ø¶" maxlength="20">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="table-container">
                    <table class="data-table" id="electricityTable">
                        <thead>
                            <tr>
                                <th>ÙˆØ§Ø­Ø¯</th>
                                <th>Ù†Ø§Ù…</th>
                                <th>Ù†ÙØ±Ø§Øª</th>
                                <th>Ø³Ù‡Ù…</th>
                                <th>Ù¾ÛŒØ§Ù…Ú©</th>
                            </tr>
                        </thead>
                        <tbody id="electricityList">
                            <!-- Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
                        </tbody>
                    </table>
                </div>
                
                <div class="summary-box" id="electricitySummary">
                    <div class="summary-row">
                        <span>Ù…Ø¨Ù„Øº Ú©Ù„ Ù‚Ø¨Ø¶:</span>
                        <span class="summary-total" id="electricityTotalAmount">Û° ØªÙˆÙ…Ø§Ù†</span>
                    </div>
                    <div class="summary-row">
                        <span>Ø¬Ù…Ø¹ Ø³Ù‡Ù… ÙˆØ§Ø­Ø¯Ù‡Ø§:</span>
                        <span class="summary-calculated" id="electricityCalculatedAmount">Û° ØªÙˆÙ…Ø§Ù†</span>
                    </div>
                    <div class="summary-status" id="electricityStatus">
                        Ø§Ø¨ØªØ¯Ø§ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø±Ø§ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ØªØ¨ Ú¯Ø§Ø² -->
        <div id="gas-tab" class="tab-content">
            <div class="content-card">
                <div class="tab-header">
                    <div class="tab-title">Ù…Ø¯ÛŒØ±ÛŒØª Ù‚Ø¨Ø¶ Ú¯Ø§Ø²</div>
                    <button class="tab-action-btn pulse" id="calculateGasBtn">Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³Ù‡Ù…</button>
                </div>
                
                <div class="bill-info-card">
                    <div class="bill-fields-container">
                        <div class="bill-fields-row mobile-layout">
                            <div class="bill-field period-field">
                                <label for="gasPeriod">Ø¯ÙˆØ±Ù‡</label>
                                <input type="text" id="gasPeriod" class="form-input" placeholder="1403/01" maxlength="7">
                            </div>
                            
                            <div class="bill-field amount-field">
                                <label for="gasTotal">Ù…Ø¨Ù„Øº</label>
                                <input type="text" id="gasTotal" class="form-input number-input" placeholder="ØªÙˆÙ…Ø§Ù†" inputmode="numeric" maxlength="13">
                            </div>
                        </div>
                        
                        <div class="bill-fields-row mobile-layout">
                            <div class="bill-field method-field">
                                <label for="gasMethod">Ø±ÙˆØ´ Ù…Ø­Ø§Ø³Ø¨Ù‡</label>
                                <select id="gasMethod" class="form-input">
                                    <option value="" disabled selected>Ø§Ù†ØªØ®Ø§Ø¨</option>
                                    <option value="per_area">Ù…ØªØ±Ø§Ú˜ ÙˆØ§Ø­Ø¯Ù‡Ø§</option>
                                    <option value="per_unit">ØªØ¹Ø¯Ø§Ø¯ ÙˆØ§Ø­Ø¯Ù‡Ø§</option>
                                    <option value="per_resident">ØªØ¹Ø¯Ø§Ø¯ Ù†ÙØ±Ø§Øª</option>
                                </select>
                            </div>
                            
                            <div class="bill-field bill-id-field">
                                <label for="gasBillId">Ø´Ù†Ø§Ø³Ù‡ Ù‚Ø¨Ø¶</label>
                                <input type="text" id="gasBillId" class="form-input" placeholder="Ø´Ù†Ø§Ø³Ù‡ Ù‚Ø¨Ø¶" maxlength="20">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="table-container">
                    <table class="data-table" id="gasTable">
                        <thead>
                            <tr>
                                <th>ÙˆØ§Ø­Ø¯</th>
                                <th>Ù†Ø§Ù…</th>
                                <th>Ù…ØªØ±Ø§Ú˜</th>
                                <th>Ø³Ù‡Ù…</th>
                                <th>Ù¾ÛŒØ§Ù…Ú©</th>
                            </tr>
                        </thead>
                        <tbody id="gasList">
                            <!-- Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
                        </tbody>
                    </table>
                </div>
                
                <div class="summary-box" id="gasSummary">
                    <div class="summary-row">
                        <span>Ù…Ø¨Ù„Øº Ú©Ù„ Ù‚Ø¨Ø¶:</span>
                        <span class="summary-total" id="gasTotalAmount">Û° ØªÙˆÙ…Ø§Ù†</span>
                    </div>
                    <div class="summary-row">
                        <span>Ø¬Ù…Ø¹ Ø³Ù‡Ù… ÙˆØ§Ø­Ø¯Ù‡Ø§:</span>
                        <span class="summary-calculated" id="gasCalculatedAmount">Û° ØªÙˆÙ…Ø§Ù†</span>
                    </div>
                    <div class="summary-status" id="gasStatus">
                        Ø§Ø¨ØªØ¯Ø§ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø±Ø§ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ØªØ¨ Ø¢Ø³Ø§Ù†Ø³ÙˆØ± -->
        <div id="elevator-tab" class="tab-content">
            <div class="content-card">
                <div class="tab-header">
                    <div class="tab-title">Ù…Ø¯ÛŒØ±ÛŒØª Ù‡Ø²ÛŒÙ†Ù‡ Ø¢Ø³Ø§Ù†Ø³ÙˆØ±</div>
                    <button class="tab-action-btn pulse" id="calculateElevatorBtn">Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³Ù‡Ù…</button>
                </div>
                
                <div class="bill-info-card">
                    <div class="bill-fields-container">
                        <div class="bill-fields-row mobile-layout">
                            <div class="bill-field period-field">
                                <label for="elevatorPeriod">Ø¯ÙˆØ±Ù‡</label>
                                <input type="text" id="elevatorPeriod" class="form-input" placeholder="1403/01" maxlength="7">
                            </div>
                            
                            <div class="bill-field amount-field">
                                <label for="elevatorTotal">Ù…Ø¨Ù„Øº</label>
                                <input type="text" id="elevatorTotal" class="form-input number-input" placeholder="ØªÙˆÙ…Ø§Ù†" inputmode="numeric" maxlength="13">
                            </div>
                        </div>
                        
                        <div class="bill-fields-row mobile-layout">
                            <div class="bill-field method-field">
                                <label for="elevatorMethod">Ø±ÙˆØ´ Ù…Ø­Ø§Ø³Ø¨Ù‡</label>
                                <select id="elevatorMethod" class="form-input">
                                    <option value="per_unit" selected>ØªØ¹Ø¯Ø§Ø¯ ÙˆØ§Ø­Ø¯Ù‡Ø§</option>
                                    <option value="per_resident">ØªØ¹Ø¯Ø§Ø¯ Ù†ÙØ±Ø§Øª</option>
                                    <option value="per_area">Ù…ØªØ±Ø§Ú˜ ÙˆØ§Ø­Ø¯Ù‡Ø§</option>
                                </select>
                            </div>
                            
                            <div class="bill-field description-field">
                                <label for="elevatorDescription">ØªÙˆØ¶ÛŒØ­Ø§Øª</label>
                                <input type="text" id="elevatorDescription" class="form-input" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª" maxlength="50">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="table-container">
                    <table class="data-table" id="elevatorTable">
                        <thead>
                            <tr>
                                <th>ÙˆØ§Ø­Ø¯</th>
                                <th>Ù†Ø§Ù…</th>
                                <th>ÙˆØ§Ø­Ø¯Ù‡Ø§</th>
                                <th>Ø³Ù‡Ù…</th>
                                <th>Ù¾ÛŒØ§Ù…Ú©</th>
                            </tr>
                        </thead>
                        <tbody id="elevatorList">
                            <!-- Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
                        </tbody>
                    </table>
                </div>
                
                <div class="summary-box" id="elevatorSummary">
                    <div class="summary-row">
                        <span>Ù…Ø¨Ù„Øº Ú©Ù„ Ù‚Ø¨Ø¶:</span>
                        <span class="summary-total" id="elevatorTotalAmount">Û° ØªÙˆÙ…Ø§Ù†</span>
                    </div>
                    <div class="summary-row">
                        <span>Ø¬Ù…Ø¹ Ø³Ù‡Ù… ÙˆØ§Ø­Ø¯Ù‡Ø§:</span>
                        <span class="summary-calculated" id="elevatorCalculatedAmount">Û° ØªÙˆÙ…Ø§Ù†</span>
                    </div>
                    <div class="summary-status" id="elevatorStatus">
                        Ø§Ø¨ØªØ¯Ø§ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø±Ø§ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ØªØ¨ Ù†Ø¸Ø§ÙØª -->
        <div id="cleaning-tab" class="tab-content">
            <div class="content-card">
                <div class="tab-header">
                    <div class="tab-title">Ù…Ø¯ÛŒØ±ÛŒØª Ù‡Ø²ÛŒÙ†Ù‡ Ù†Ø¸Ø§ÙØª</div>
                    <button class="tab-action-btn pulse" id="calculateCleaningBtn">Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³Ù‡Ù…</button>
                </div>
                
                <div class="bill-info-card">
                    <div class="bill-fields-container">
                        <div class="bill-fields-row mobile-layout">
                            <div class="bill-field period-field">
                                <label for="cleaningPeriod">Ø¯ÙˆØ±Ù‡</label>
                                <input type="text" id="cleaningPeriod" class="form-input" placeholder="1403/01" maxlength="7">
                            </div>
                            
                            <div class="bill-field amount-field">
                                <label for="cleaningTotal">Ù…Ø¨Ù„Øº</label>
                                <input type="text" id="cleaningTotal" class="form-input number-input" placeholder="ØªÙˆÙ…Ø§Ù†" inputmode="numeric" maxlength="13">
                            </div>
                        </div>
                        
                        <div class="bill-fields-row mobile-layout">
                            <div class="bill-field method-field">
                                <label for="cleaningMethod">Ø±ÙˆØ´ Ù…Ø­Ø§Ø³Ø¨Ù‡</label>
                                <select id="cleaningMethod" class="form-input">
                                    <option value="per_unit" selected>ØªØ¹Ø¯Ø§Ø¯ ÙˆØ§Ø­Ø¯Ù‡Ø§</option>
                                    <option value="per_resident">ØªØ¹Ø¯Ø§Ø¯ Ù†ÙØ±Ø§Øª</option>
                                    <option value="per_area">Ù…ØªØ±Ø§Ú˜ ÙˆØ§Ø­Ø¯Ù‡Ø§</option>
                                </select>
                            </div>
                            
                            <div class="bill-field description-field">
                                <label for="cleaningDescription">ØªÙˆØ¶ÛŒØ­Ø§Øª</label>
                                <input type="text" id="cleaningDescription" class="form-input" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª" maxlength="50">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="table-container">
                    <table class="data-table" id="cleaningTable">
                        <thead>
                            <tr>
                                <th>ÙˆØ§Ø­Ø¯</th>
                                <th>Ù†Ø§Ù…</th>
                                <th>ÙˆØ§Ø­Ø¯Ù‡Ø§</th>
                                <th>Ø³Ù‡Ù…</th>
                                <th>Ù¾ÛŒØ§Ù…Ú©</th>
                            </tr>
                        </thead>
                        <tbody id="cleaningList">
                            <!-- Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
                        </tbody>
                    </table>
                </div>
                
                <div class="summary-box" id="cleaningSummary">
                    <div class="summary-row">
                        <span>Ù…Ø¨Ù„Øº Ú©Ù„ Ù‚Ø¨Ø¶:</span>
                        <span class="summary-total" id="cleaningTotalAmount">Û° ØªÙˆÙ…Ø§Ù†</span>
                    </div>
                    <div class="summary-row">
                        <span>Ø¬Ù…Ø¹ Ø³Ù‡Ù… ÙˆØ§Ø­Ø¯Ù‡Ø§:</span>
                        <span class="summary-calculated" id="cleaningCalculatedAmount">Û° ØªÙˆÙ…Ø§Ù†</span>
                    </div>
                    <div class="summary-status" id="cleaningStatus">
                        Ø§Ø¨ØªØ¯Ø§ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø±Ø§ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ØªØ¨ Ù…ØªÙØ±Ù‚Ù‡ -->
        <div id="misc-tab" class="tab-content">
            <div class="content-card">
                <div class="tab-header">
                    <div class="tab-title">Ù…Ø¯ÛŒØ±ÛŒØª Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ù…ØªÙØ±Ù‚Ù‡</div>
                    <button class="tab-action-btn pulse" id="calculateMiscBtn">Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³Ù‡Ù…</button>
                </div>
                
                <div class="bill-info-card">
                    <div class="bill-fields-container">
                        <div class="bill-fields-row mobile-layout">
                            <div class="bill-field period-field">
                                <label for="miscPeriod">Ø¯ÙˆØ±Ù‡</label>
                                <input type="text" id="miscPeriod" class="form-input" placeholder="1403/01" maxlength="7">
                            </div>
                            
                            <div class="bill-field amount-field">
                                <label for="miscTotal">Ù…Ø¨Ù„Øº</label>
                                <input type="text" id="miscTotal" class="form-input number-input" placeholder="ØªÙˆÙ…Ø§Ù†" inputmode="numeric" maxlength="13">
                            </div>
                        </div>
                        
                        <div class="bill-fields-row mobile-layout">
                            <div class="bill-field method-field">
                                <label for="miscMethod">Ø±ÙˆØ´ Ù…Ø­Ø§Ø³Ø¨Ù‡</label>
                                <select id="miscMethod" class="form-input">
                                    <option value="per_unit" selected>ØªØ¹Ø¯Ø§Ø¯ ÙˆØ§Ø­Ø¯Ù‡Ø§</option>
                                    <option value="per_resident">ØªØ¹Ø¯Ø§Ø¯ Ù†ÙØ±Ø§Øª</option>
                                    <option value="per_area">Ù…ØªØ±Ø§Ú˜ ÙˆØ§Ø­Ø¯Ù‡Ø§</option>
                                </select>
                            </div>
                            
                            <div class="bill-field description-field">
                                <label for="miscDescription">ØªÙˆØ¶ÛŒØ­Ø§Øª</label>
                                <input type="text" id="miscDescription" class="form-input" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)" maxlength="50">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="table-container">
                    <table class="data-table" id="miscTable">
                        <thead>
                            <tr>
                                <th>ÙˆØ§Ø­Ø¯</th>
                                <th>Ù†Ø§Ù…</th>
                                <th>ÙˆØ§Ø­Ø¯Ù‡Ø§</th>
                                <th>Ø³Ù‡Ù…</th>
                                <th>Ù¾ÛŒØ§Ù…Ú©</th>
                            </tr>
                        </thead>
                        <tbody id="miscList">
                            <!-- Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
                        </tbody>
                    </table>
                </div>
                
                <div class="summary-box" id="miscSummary">
                    <div class="summary-row">
                        <span>Ù…Ø¨Ù„Øº Ú©Ù„ Ù‚Ø¨Ø¶:</span>
                        <span class="summary-total" id="miscTotalAmount">Û° ØªÙˆÙ…Ø§Ù†</span>
                    </div>
                    <div class="summary-row">
                        <span>Ø¬Ù…Ø¹ Ø³Ù‡Ù… ÙˆØ§Ø­Ø¯Ù‡Ø§:</span>
                        <span class="summary-calculated" id="miscCalculatedAmount">Û° ØªÙˆÙ…Ø§Ù†</span>
                    </div>
                    <div class="summary-status" id="miscStatus">
                        Ø§Ø¨ØªØ¯Ø§ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø±Ø§ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ØªØ¨ Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒÙ‡Ø§ -->
        <div id="payments-tab" class="tab-content">
            <div class="content-card">
                <div class="tab-header">
                    <div class="tab-title">Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒÙ‡Ø§ÛŒ ÙˆØ§Ø­Ø¯Ù‡Ø§</div>
                    <button class="tab-action-btn btn-payments pulse" id="savePaymentsBtn">Ø«Ø¨Øª Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒÙ‡Ø§</button>
                </div>
                
                <div class="bill-info-card">
                    <div class="bill-fields-row mobile-layout">
                        <div class="bill-field period-field">
                            <label for="paymentPeriod">Ø¯ÙˆØ±Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª</label>
                            <input type="text" id="paymentPeriod" class="form-input" placeholder="1403/01" maxlength="7">
                        </div>
                        <div class="bill-field amount-field">
                            <label for="paymentDate">ØªØ§Ø±ÛŒØ® Ù¾Ø±Ø¯Ø§Ø®Øª</label>
                            <input type="text" id="paymentDate" class="form-input" placeholder="1403/01/01" maxlength="10">
                        </div>
                        <div class="bill-field description-field">
                            <label for="paymentDescription">ØªÙˆØ¶ÛŒØ­Ø§Øª</label>
                            <input type="text" id="paymentDescription" class="form-input" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)" maxlength="50">
                        </div>
                    </div>
                </div>
                
                <div class="table-container">
                    <table class="data-table" id="paymentsTable">
                        <thead>
                            <tr>
                                <th>Ø±Ø¯ÛŒÙ</th>
                                <th>ÙˆØ§Ø­Ø¯</th>
                                <th>Ù†Ø§Ù…</th>
                                <th>Ù…Ø¨Ù„Øº</th>
                                <th>ÙˆØ¶Ø¹ÛŒØª</th>
                            </tr>
                        </thead>
                        <tbody id="paymentsList">
                            <!-- Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
                        </tbody>
                    </table>
                </div>
                
                <div class="summary-box" id="paymentSummary">
                    <div class="summary-row">
                        <span>Ù…Ø¬Ù…ÙˆØ¹ Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒÙ‡Ø§:</span>
                        <span class="summary-calculated" id="totalPayments">Û° ØªÙˆÙ…Ø§Ù†</span>
                    </div>
                    <div class="summary-row">
                        <span>ÙˆØ§Ø­Ø¯Ù‡Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª Ú©Ù†Ù†Ø¯Ù‡:</span>
                        <span id="paidUnitsCount">Û° ÙˆØ§Ø­Ø¯</span>
                    </div>
                    <div class="summary-status status-paid" id="paymentStatus">
                        Ù…Ù†ØªØ¸Ø± Ø«Ø¨Øª Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒÙ‡Ø§
                    </div>
                </div>
                
                <div class="category-section">
                    <div class="category-title">Ú¯Ø²Ø§Ø±Ø´ ØªØ¬Ù…ÛŒØ¹ÛŒ ÙˆØ§Ø­Ø¯</div>
                    <div class="form-row">
                        <select id="unitReportFilter" class="form-input">
                            <option value="">Ø§Ù†ØªØ®Ø§Ø¨ ÙˆØ§Ø­Ø¯ Ø¨Ø±Ø§ÛŒ Ú¯Ø²Ø§Ø±Ø´</option>
                            <!-- ÙˆØ§Ø­Ø¯Ù‡Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
                        </select>
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-info" id="generateUnitReportBtn">
                            Ø§ÛŒØ¬Ø§Ø¯ Ú¯Ø²Ø§Ø±Ø´
                        </button>
                        <button class="btn btn-payments" id="exportUnitReportBtn">
                            Ú†Ø§Ù¾/Ø°Ø®ÛŒØ±Ù‡ PDF
                        </button>
                    </div>
                </div>
            </div>
        </div>
     


        <!-- ÙÙˆØªØ± -->
        
        <div class="footer">
            Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø± Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø§Ø®ØªÙ…Ø§Ù† | ØªÙˆØ³Ø¹Ù‡â€ŒÛŒØ§ÙØªÙ‡ ØªÙˆØ³Ø· [ÙØ±Ø­â€ŒØ²Ø§Ø¯ÛŒØ§Ù†]
        </div>
    </div>
    
    <!-- Ù…ÙˆØ¯Ø§Ù„ ØªÙ†Ø¸ÛŒÙ…Ø§Øª -->
    <div id="settingsModal" class="settings-modal">
        <div class="settings-content">
            <div class="settings-header">
                <div class="settings-title">ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³ÛŒØ³ØªÙ…</div>
                <button class="close-settings-btn" id="closeSettingsBtn">Ã—</button>
            </div>
            
            <div id="settingsMainPage">
                <div class="settings-grid">
                    <div class="settings-card" id="managerSettingsCard">
                        <div class="settings-card-content">
                            <span class="settings-icon">ğŸ‘¤</span>
                            <span class="settings-label">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø¯ÛŒØ±</span>
                        </div>
                    </div>
                    
                    <div class="settings-card" id="archiveSettingsCard">
                        <div class="settings-card-content">
                            <span class="settings-icon">ğŸ“</span>
                            <span class="settings-label">Ø¢Ø±Ø´ÛŒÙˆ Ù‚Ø¨ÙˆØ¶</span>
                        </div>
                    </div>
                    
                    <div class="settings-card" id="dataSettingsCard">
                        <div class="settings-card-content">
                            <span class="settings-icon">ğŸ’¾</span>
                            <span class="settings-label">Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</span>
                        </div>
                    </div>
                    
                    <div class="settings-card" id="smsSettingsCard">
                        <div class="settings-card-content">
                            <span class="settings-icon">ğŸ’¬</span>
                            <span class="settings-label">Ù‚Ø§Ù„Ø¨ Ù¾ÛŒØ§Ù…Ú©</span>
                        </div>
                    </div>
                    
                    <div class="settings-card" id="defaultSettingsCard">
                        <div class="settings-card-content">
                            <span class="settings-icon">âš™ï¸</span>
                            <span class="settings-label">ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶</span>
                        </div>
                    </div>
                    
                    <div class="settings-card" id="paymentsSettingsCard">
                        <div class="settings-card-content">
                            <span class="settings-icon">ğŸ’°</span>
                            <span class="settings-label">Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒÙ‡Ø§</span>
                        </div>
                    </div>
                    
                    <div class="settings-card" id="aboutSettingsCard">
                        <div class="settings-card-content">
                            <span class="settings-icon">â„¹ï¸</span>
                            <span class="settings-label">Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø±</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ØµÙØ­Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø¯ÛŒØ± -->
            <div id="managerSettingsForm" class="settings-form">
                <button class="back-btn" id="backFromManagerBtn">
                    Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
                </button>
                
                <div class="category-title">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø¯ÛŒØ± Ø³Ø§Ø®ØªÙ…Ø§Ù†</div>
                <div class="form-row">
                    <div class="bill-field">
                        <label for="managerName">Ù†Ø§Ù… Ù…Ø¯ÛŒØ±</label>
                        <input type="text" id="managerName" class="form-input" placeholder="Ù†Ø§Ù… Ú©Ø§Ù…Ù„">
                    </div>
                    <div class="bill-field">
                        <label for="managerPhone">ØªÙ„ÙÙ† Ù…Ø¯ÛŒØ±</label>
                        <input type="tel" id="managerPhone" class="form-input" placeholder="Û°Û¹Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹" dir="ltr">
                    </div>
                </div>
                <div class="form-row">
                    <div class="bill-field">
                        <label for="managerUnit">Ø´Ù…Ø§Ø±Ù‡ ÙˆØ§Ø­Ø¯ Ù…Ø¯ÛŒØ±</label>
                        <input type="text" id="managerUnit" class="form-input" placeholder="Ù…Ø«Ø§Ù„: Û±Û°Û±">
                    </div>
                    <div class="bill-field">
                        <label for="managerStartDate">ØªØ§Ø±ÛŒØ® Ø´Ø±ÙˆØ¹ Ù…Ø¯ÛŒØ±ÛŒØª</label>
                        <input type="text" id="managerStartDate" class="form-input" placeholder="1403/01/01">
                    </div>
                </div>
                
                <div class="form-actions">
                    <button class="btn btn-danger" id="cancelManagerBtn">Ù„ØºÙˆ</button>
                    <button class="btn btn-success" id="saveManagerBtn">Ø°Ø®ÛŒØ±Ù‡</button>
                </div>
            </div>
            
            <!-- ØµÙØ­Ù‡ Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ -->
            <div id="dataSettingsForm" class="settings-form">
                <button class="back-btn" id="backFromDataBtn">
                    Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
                </button>
                
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px; gap: 10px;">
                    <div class="category-title">Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ (ÙˆØ±ÙˆØ¯ÛŒ/Ø®Ø±ÙˆØ¬ÛŒ)</div>
                    <button class="btn btn-info" id="dataHelpBtn" 
                            style="padding: 6px 10px; font-size: 0.8rem; min-height: 32px; white-space: nowrap;">
                        Ø±Ø§Ù‡Ù†Ù…Ø§ â„¹ï¸
                    </button>
                </div>
                
                <div class="export-section">
                    <div class="section-title">Ø®Ø±ÙˆØ¬ÛŒâ€ŒÙ‡Ø§</div>
                    <div class="data-management-buttons">
                        <button class="btn btn-success" id="exportCSVBtn">
                            Ø³Ø§Ú©Ù†ÛŒÙ† (CSV)
                        </button>
                        
                        <button class="btn btn-success" id="exportPaymentsCSVBtn">
                            Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒÙ‡Ø§ (CSV)
                        </button>
                        
                        <button class="btn btn-success" id="exportJSONBtn">
                            Ù‚Ø¨Ø¶â€ŒÙ‡Ø§ Ùˆ Ø³Ø§Ú©Ù†ÛŒÙ†(JSON)
                        </button>
                        
                        <button class="btn btn-success" id="exportArchiveCSVBtn">
                            Ù‚Ø¨Ø¶â€ŒÙ‡Ø§(JSON)
                        </button>
                    </div>
                </div>
                
                <div class="export-section">
                    <div class="section-title">ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§</div>
                    <div class="data-management-buttons">
                        <button class="btn btn-warning" id="importCSVBtn">
                            Ø³Ø§Ú©Ù†ÛŒÙ† (CSV)
                        </button>
                        
                        <button class="btn btn-warning" id="importPaymentsCSVBtn">
                            Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒÙ‡Ø§ (CSV)
                        </button>
                        
                        <button class="btn btn-warning" id="importJSONBtn">
                            Ù‚Ø¨Ø¶â€ŒÙ‡Ø§ Ùˆ Ø³Ø§Ú©Ù†ÛŒÙ†(JSON)
                        </button>
                        
                        <button class="btn btn-warning" id="importArchiveJSONBtn">
                            Ù‚Ø¨Ø¶â€ŒÙ‡Ø§(JSON)
                        </button>
                    </div>
                </div>
                
                <div class="export-section">
                    <div class="section-title">Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ</div>
                    <div class="data-management-buttons">
                        <button class="btn btn-primary" id="createBackupBtn">
                            Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ú©Ø§Ù…Ù„(HTML)
                        </button>
                        
                        <button class="btn btn-primary" id="importBackupBtn">
                            Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ú©Ø§Ù…Ù„ (HTML)
                        </button>
                    </div>
                </div>
                
                <div class="export-section">
                    <div class="section-title">Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ú©Ø§Ù…Ù„</div>
                    <div class="data-management-buttons">
                        <button class="btn btn-danger" id="resetAllDataBtn">
                            Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- ØµÙØ­Ù‡ Ù‚Ø§Ù„Ø¨ Ù¾ÛŒØ§Ù…Ú© -->
            <div id="smsSettingsForm" class="settings-form">
                <button class="back-btn" id="backFromSmsBtn">
                    Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
                </button>
                
                <div class="category-title">Ù‚Ø§Ù„Ø¨ Ù¾ÛŒØ§Ù…Ú©</div>
                <textarea id="smsTemplate" class="form-input" rows="6" placeholder="Ù…ØªÙ† Ù¾ÛŒØ§Ù…Ú©...">Ø¨Ø§ Ø³Ù„Ø§Ù… Ùˆ Ø§Ø­ØªØ±Ø§Ù…
Ù‚Ø¨Ø¶ {billType} Ø¯ÙˆØ±Ù‡ {period}
Ù…Ø¨Ù„Øº Ú©Ù„: {totalAmount} ØªÙˆÙ…Ø§Ù†
Ø³Ù‡Ù… Ø´Ù…Ø§: {shareAmount} ØªÙˆÙ…Ø§Ù†
Ù„Ø·ÙØ§Ù‹ Ø¨Ø¹Ø¯ Ø§Ø² ÙˆØ§Ø±ÛŒØ² Ø§Ø·Ù„Ø§Ø¹â€ŒØ±Ø³Ø§Ù†ÛŒ ÙØ±Ù…Ø§ÛŒÛŒØ¯</textarea>
                <div style="font-size: 0.8rem; color: var(--text-color); opacity: 0.7; margin-top: 10px; margin-bottom: 16px;">
                    Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡: {billType}, {period}, {totalAmount}, {shareAmount}, {unitNumber}, {residentName}
                </div>
                
                <div class="form-actions">
                    <button class="btn btn-danger" id="resetSmsBtn">Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ</button>
                    <button class="btn btn-success" id="saveSmsBtn">Ø°Ø®ÛŒØ±Ù‡</button>
                </div>
            </div>
            
            <!-- ØµÙØ­Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶ -->
            <div id="defaultSettingsForm" class="settings-form">
                <button class="back-btn" id="backFromDefaultBtn">
                    Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
                </button>
                
                <div class="category-title">ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ù…Ø­Ø§Ø³Ø¨Ø§Øª</div>
                
                <div style="display: flex; flex-direction: column; gap: 16px;">
                    <div class="bill-field">
                        <label for="defaultWaterMethod">Ø±ÙˆØ´ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¢Ø¨:</label>
                        <select id="defaultWaterMethod" class="form-input">
                            <option value="per_resident">Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÙØ±Ø§Øª</option>
                            <option value="per_unit">Ø¨Ø± Ø§Ø³Ø§Ø³ ÙˆØ§Ø­Ø¯Ù‡Ø§</option>
                            <option value="per_area">Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…ØªØ±Ø§Ú˜</option>
                        </select>
                    </div>
                    
                    <div class="bill-field">
                        <label for="defaultElectricityMethod">Ø±ÙˆØ´ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ø±Ù‚:</label>
                        <select id="defaultElectricityMethod" class="form-input">
                            <option value="per_unit">Ø¨Ø± Ø§Ø³Ø§Ø³ ÙˆØ§Ø­Ø¯Ù‡Ø§</option>
                            <option value="per_resident">Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÙØ±Ø§Øª</option>
                            <option value="per_area">Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…ØªØ±Ø§Ú˜</option>
                        </select>
                    </div>
                    
                    <div class="bill-field">
                        <label for="defaultGasMethod">Ø±ÙˆØ´ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ú¯Ø§Ø²:</label>
                        <select id="defaultGasMethod" class="form-input">
                            <option value="per_area">Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…ØªØ±Ø§Ú˜</option>
                            <option value="per_unit">Ø¨Ø± Ø§Ø³Ø§Ø³ ÙˆØ§Ø­Ø¯Ù‡Ø§</option>
                            <option value="per_resident">Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÙØ±Ø§Øª</option>
                        </select>
                    </div>
                    
                    <div class="bill-field">
                        <label for="defaultElevatorMethod">Ø±ÙˆØ´ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¢Ø³Ø§Ù†Ø³ÙˆØ±:</label>
                        <select id="defaultElevatorMethod" class="form-input">
                            <option value="per_unit" selected>Ø¨Ø± Ø§Ø³Ø§Ø³ ÙˆØ§Ø­Ø¯Ù‡Ø§</option>
                            <option value="per_resident">Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÙØ±Ø§Øª</option>
                            <option value="per_area">Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…ØªØ±Ø§Ú˜</option>
                        </select>
                    </div>
                    
                    <div class="bill-field">
                        <label for="defaultCleaningMethod">Ø±ÙˆØ´ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ù†Ø¸Ø§ÙØª:</label>
                        <select id="defaultCleaningMethod" class="form-input">
                            <option value="per_unit" selected>Ø¨Ø± Ø§Ø³Ø§Ø³ ÙˆØ§Ø­Ø¯Ù‡Ø§</option>
                            <option value="per_resident">Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÙØ±Ø§Øª</option>
                            <option value="per_area">Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…ØªØ±Ø§Ú˜</option>
                        </select>
                    </div>
                    
                    <div class="bill-field">
                        <label for="defaultMiscMethod">Ø±ÙˆØ´ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ù…ØªÙØ±Ù‚Ù‡:</label>
                        <select id="defaultMiscMethod" class="form-input">
                            <option value="per_unit" selected>Ø¨Ø± Ø§Ø³Ø§Ø³ ÙˆØ§Ø­Ø¯Ù‡Ø§</option>
                            <option value="per_resident">Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÙØ±Ø§Øª</option>
                            <option value="per_area">Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…ØªØ±Ø§Ú˜</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-actions" style="margin-top: 20px;">
                    <button class="btn btn-danger" id="resetDefaultsBtn">Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ</button>
                    <button class="btn btn-success" id="saveDefaultsBtn">Ø°Ø®ÛŒØ±Ù‡</button>
                </div>
            </div>
            
            <!-- ØµÙØ­Ù‡ Ø¢Ø±Ø´ÛŒÙˆ -->
            <div id="archivePage" class="archive-page">
                <button class="back-btn" id="backFromArchiveBtn">
                    Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
                </button>
                
                <div class="archive-header">
                    <div class="category-title">Ø¢Ø±Ø´ÛŒÙˆ Ù‚Ø¨ÙˆØ¶ Ø³Ø§Ø®ØªÙ…Ø§Ù†</div>
                    <div style="display: flex; gap: 10px; width: 100%;">
                        <button class="filter-toggle-btn" id="toggleFiltersBtn">
                            ÙÛŒÙ„ØªØ±Ù‡Ø§
                        </button>
                        <button class="btn btn-success" id="applyFiltersBtn">
                            Ø§Ø¹Ù…Ø§Ù„
                        </button>
                        <button class="btn btn-danger" id="resetFiltersBtn">
                            Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ
                        </button>
                    </div>
                </div>
                
                <div id="archiveFiltersPanel" class="archive-filters-panel" style="display: none;">
                    <div class="filter-section">
                        <div class="filter-title">Ù†ÙˆØ¹ Ù‚Ø¨Ø¶</div>
                        <div class="filter-checkboxes" id="billTypeFilters">
                            <div class="filter-checkbox active" data-bill-type="water">Ø¢Ø¨</div>
                            <div class="filter-checkbox active" data-bill-type="electricity">Ø¨Ø±Ù‚</div>
                            <div class="filter-checkbox active" data-bill-type="gas">Ú¯Ø§Ø²</div>
                            <div class="filter-checkbox active" data-bill-type="elevator">Ø¢Ø³Ø§Ù†Ø³ÙˆØ±</div>
                            <div class="filter-checkbox active" data-bill-type="cleaning">Ù†Ø¸Ø§ÙØª</div>
                            <div class="filter-checkbox active" data-bill-type="misc">Ù…ØªÙØ±Ù‚Ù‡</div>
                        </div>
                        <div class="quick-select-buttons">
                            <button class="quick-select-btn" id="selectAllBills">Ù‡Ù…Ù‡</button>
                            <button class="quick-select-btn" id="selectNoneBills">Ù‡ÛŒÚ†Ú©Ø¯Ø§Ù…</button>
                        </div>
                    </div>
                    
                    <div class="filter-section">
                        <div class="filter-title">
                            Ø¨Ø§Ø²Ù‡ Ø²Ù…Ø§Ù†ÛŒ (ØªØ§Ø±ÛŒØ® Ø´Ù…Ø³ÛŒ)
                            <div>(ÙØ±Ù…Øª ÙˆØ±ÙˆØ¯ÛŒ 14040101)</div>
                        </div>
                        <div class="date-inputs-row">
                            <input type="text" id="filterDateFrom" class="date-input" placeholder="Ø§Ø² ØªØ§Ø±ÛŒØ® (1403/01/01)">
                            <span style="text-align: center; padding: 10px;">ØªØ§</span>
                            <input type="text" id="filterDateTo" class="date-input" placeholder="ØªØ§ ØªØ§Ø±ÛŒØ® (1403/01/30)">
                        </div>
                        <div class="quick-select-buttons">
                            <button class="quick-select-btn" data-period="lastMonth">Ù…Ø§Ù‡ Ú¯Ø°Ø´ØªÙ‡</button>
                            <button class="quick-select-btn" data-period="last3Months">Û³ Ù…Ø§Ù‡ Ø§Ø®ÛŒØ±</button>
                            <button class="quick-select-btn" data-period="thisYear">Ø§Ù…Ø³Ø§Ù„</button>
                        </div>
                    </div>
                </div>
                
                <div id="archiveList">
                    <div class="empty-message">
                        Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¢Ø±Ø´ÛŒÙˆ...
                    </div>
                </div>
                
                <div class="form-actions" style="margin-top: 20px;">
                    <button class="btn btn-warning" id="exportArchivePDFBtn">
                        Ø®Ù„Ø§ØµÙ‡ Ú†Ø§Ù¾/PDF
                    </button>
                    <button class="btn btn-primary" id="exportArchiveCSVBtn">
                        Ø®Ø±ÙˆØ¬ÛŒ CSV Ø¢Ø±Ø´ÛŒÙˆ
                    </button>
                </div>
            </div>
            
            <!-- ØµÙØ­Ù‡ Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒÙ‡Ø§ -->
            <div id="paymentsSettingsForm" class="settings-form">
                <button class="back-btn" id="backFromPaymentsBtn">
                    Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
                </button>
                
                <div class="category-title">Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒÙ‡Ø§</div>
                
                <div style="display: flex; flex-direction: column; gap: 12px; margin-bottom: 20px;">
                    <button class="btn btn-payments" id="exportAllPaymentsCSVBtn">
                        Ø®Ø±ÙˆØ¬ÛŒ CSV ØªÙ…Ø§Ù… Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒÙ‡Ø§
                    </button>
                    
                    <button class="btn btn-payments" id="exportPaymentsReportPDFBtn">
                        Ú†Ø§Ù¾/Ø°Ø®ÛŒØ±Ù‡ PDF Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒÙ‡Ø§
                    </button>
                    
                    <button class="btn btn-danger" id="clearOldPaymentsBtn">
                        Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ
                    </button>
                </div>
                
                <div class="summary-box">
                    <div class="category-title" style="margin-bottom: 16px;">Ø¢Ù…Ø§Ø± Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒÙ‡Ø§</div>
                    <div style="display: flex; flex-direction: column; gap: 10px; font-size: 0.9rem;">
                        <div class="summary-row">
                            <span>ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒÙ‡Ø§:</span>
                            <span id="totalPaymentsCount">Û°</span>
                        </div>
                        <div class="summary-row">
                            <span>Ù…Ø¬Ù…ÙˆØ¹ Ù…Ø¨Ø§Ù„Øº Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ:</span>
                            <span id="totalPaymentsAmount">Û° ØªÙˆÙ…Ø§Ù†</span>
                        </div>
                        <div class="summary-row">
                            <span>Ø¢Ø®Ø±ÛŒÙ† Ù¾Ø±Ø¯Ø§Ø®Øª:</span>
                            <span id="lastPaymentDate">-</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ØµÙØ­Ù‡ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø± -->
            <div id="aboutSettingsForm" class="settings-form">
                <button class="back-btn" id="backFromAboutBtn">
                    Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
                </button>
                
                <div class="category-title">Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø±</div>
                
                <div style="text-align: center; padding: 20px;">
                    <div style="font-size: 3rem; margin-bottom: 20px;">ğŸ¢</div>
                    <div style="font-size: 1.2rem; color: var(--secondary-color); font-weight: bold; margin-bottom: 10px;">
                        Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø± Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø§Ø®ØªÙ…Ø§Ù†
                    </div>
                    <div style="font-size: 0.9rem; color: var(--text-color); margin-bottom: 20px;">
                        Ù†Ø³Ø®Ù‡ Û¶.Û°
                    </div>
                    
                    <div style="background: var(--primary-color); padding: 20px; border-radius: 10px; margin: 20px 0;">
                        <div style="font-weight: bold; margin-bottom: 10px; color: var(--secondary-color);">
                            ØªÙˆØ³Ø¹Ù‡â€ŒÛŒØ§ÙØªÙ‡ ØªÙˆØ³Ø· [ÙØ±Ø­â€ŒØ²Ø§Ø¯ÛŒØ§Ù†]
                        </div>
                        <div style="font-size: 0.85rem; color: var(--text-color); line-height: 1.6;">
                            Ø§ÛŒÙ† Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø± Ø¨Ø§ Ù‡Ø¯Ù Ø³Ù‡ÙˆÙ„Øª Ø¯Ø± Ù…Ø¯ÛŒØ±ÛŒØª Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø³Ø§Ø®ØªÙ…Ø§Ù† Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡ Ø› <br>
                           Ùˆ Ø¯Ø§Ø±Ø§ÛŒ Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³Ù‡Ù… ÙˆØ§Ø­Ø¯Ù‡Ø§ØŒ Ø¢Ø±Ø´ÛŒÙˆ Ù‚Ø¨ÙˆØ¶ØŒ Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒÙ‡Ø§ Ùˆ Ú¯Ø²Ø§Ø±Ø´â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø³Øª.
                        </div>
                    </div>
                    
                    <div style="font-size: 0.8rem; color: var(--text-color); opacity: 0.7; margin-top: 30px;">
                        ØªÙ…Ø§Ù…ÛŒ Ø­Ù‚ÙˆÙ‚ Ø¨Ø±Ø§ÛŒ ØªÙˆØ³Ø¹Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ù‡ Ù…Ø­ÙÙˆØ¸ Ø§Ø³Øª Â© Û±Û´Û°Û´
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Ù…ÙˆØ¯Ø§Ù„ Ú¯Ø²Ø§Ø±Ø´ ØªØ¬Ù…ÛŒØ¹ÛŒ ÙˆØ§Ø­Ø¯ -->
    <div id="unitReportModal" class="unit-report-modal">
        <div class="unit-report-content">
            <div class="unit-report-header">
                <div class="unit-report-title" id="unitReportTitle">Ú¯Ø²Ø§Ø±Ø´ ØªØ¬Ù…ÛŒØ¹ÛŒ ÙˆØ§Ø­Ø¯</div>
                <button class="close-settings-btn" id="closeUnitReportBtn">Ã—</button>
            </div>
            
            <div id="unitReportContent">
                <div class="empty-message">
                    Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú¯Ø²Ø§Ø±Ø´...
                </div>
            </div>
            
            <div class="form-actions" style="margin-top: 20px;">
                <button class="btn btn-payments" id="printUnitReportBtn">
                    Ú†Ø§Ù¾ Ú¯Ø²Ø§Ø±Ø´
                </button>
                <button class="btn btn-success" id="exportUnitReportPDFBtn">
                    Ú†Ø§Ù¾/Ø°Ø®ÛŒØ±Ù‡ PDF
                </button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
        
       // ==================== PWA ====================
if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
        navigator.serviceWorker.register('./service-worker.js')
            .then(reg => {
                console.log('âœ… Service Worker Ø«Ø¨Øª Ø´Ø¯');
                
                // âœ… Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯ - ØªØ´Ø®ÛŒØµ Ø¢Ù¾Ø¯ÛŒØª
                reg.addEventListener('updatefound', () => {
                    const newWorker = reg.installing;
                    console.log(' Ù†Ø³Ø®Ù‡ Ø¬Ø¯ÛŒØ¯ Ù¾ÛŒØ¯Ø§ Ø´Ø¯');
                    
                    newWorker.addEventListener('statechange', () => {
                        if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                            // Ù†Ø³Ø®Ù‡ Ø¬Ø¯ÛŒØ¯ Ù†ØµØ¨ Ø´Ø¯Ù‡ - Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø§Ø·Ù„Ø§Ø¹ Ø¨Ø¯Ù‡
                            showUpdateNotification();
                        }
                    });
                });
                
                let deferredPrompt;
                window.addEventListener('beforeinstallprompt', (e) => {
                    e.preventDefault();
                    deferredPrompt = e;
                    
                    const installBtn = document.createElement('button');
                    installBtn.innerHTML = 'ğŸ“² Ù†ØµØ¨ Ø§Ù¾';
                    installBtn.className = 'tab-action-btn';
                    installBtn.style.position = 'fixed';
                    installBtn.style.bottom = '20px';
                    installBtn.style.left = '40px';
                    installBtn.style.zIndex = '9999';
                    installBtn.style.background = 'linear-gradient(135deg, #2196F3, #4CAF50, #FFC107, #F44336)';
                    
                    installBtn.style.color = 'white';
                    installBtn.style.padding = '12px 16px';
                    installBtn.style.borderRadius = '50px';
                    installBtn.style.boxShadow = '0 4px 12px rgba(0,0,0,0.3)';
                    installBtn.style.fontFamily = 'Vazir, sans-serif';
                    installBtn.style.fontSize = '14px';
                    installBtn.style.cursor = 'pointer';
                    installBtn.style.display = 'none';
                    
                    installBtn.onclick = () => {
                        deferredPrompt.prompt();
                        deferredPrompt.userChoice.then((choiceResult) => {
                            if (choiceResult.outcome === 'accepted') {
                                console.log('âœ… Ú©Ø§Ø±Ø¨Ø± Ø§Ù¾ Ø±Ø§ Ù†ØµØ¨ Ú©Ø±Ø¯');
                                installBtn.style.display = 'none';
                            }
                            deferredPrompt = null;
                        });
                    };
                    
                    document.body.appendChild(installBtn);
                    
                    setTimeout(() => {
                        installBtn.style.display = 'block';
                        installBtn.classList.add('pulse');
                    }, 3000);
                });
            })
            .catch(err => console.log('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øª Service Worker:', err));
    });
}

// âœ… ØªØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ø¢Ù¾Ø¯ÛŒØª
function showUpdateNotification() {
    // Ø§Ú¯Ø± Ù‚Ø¨Ù„Ø§Ù‹ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡ØŒ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ù†Ù…Ø§ÛŒØ´ Ù†Ø¯Ù‡
    if (sessionStorage.getItem('update_shown')) return;
    sessionStorage.setItem('update_shown', 'true');
    
    const notif = document.createElement('div');
    notif.style.cssText = `
        position: fixed;
        bottom: 20px;
        right: 20px;
        left: 20px;
        background: linear-gradient(135deg, var(--secondary-color), var(--button-hover));
        color: white;
        padding: 15px 20px;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        z-index: 10000;
        font-family: Vazir, sans-serif;
        direction: rtl;
        text-align: center;
        animation: slideUp 0.3s ease;
        border: 2px solid white;
    `;
    
    notif.innerHTML = `
        <div style="font-size: 1.3rem; margin-bottom: 8px;">ğŸš€ Ù†Ø³Ø®Ù‡ Ø¬Ø¯ÛŒØ¯!</div>
        <div style="margin-bottom: 15px; font-size: 0.95rem;">ØªØºÛŒÛŒØ±Ø§Øª Ø¬Ø¯ÛŒØ¯ Ø§Ø¹Ù…Ø§Ù„ Ø´Ø¯Ù‡. Ù„Ø·ÙØ§Ù‹ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø±Ø§ ÛŒÚ©Ø¨Ø§Ø± Ø¨Ø¨Ù†Ø¯ÛŒØ¯ Ùˆ Ø¨Ø§Ø² Ú©Ù†ÛŒØ¯.</div>
        <div style="display: flex; gap: 10px; justify-content: center;">
            <button onclick="location.reload()" style="
                background: white;
                color: var(--secondary-color);
                border: none;
                padding: 10px 25px;
                border-radius: 8px;
                font-weight: bold;
                cursor: pointer;
                font-family: Vazir, sans-serif;
                font-size: 0.9rem;
                flex: 1;
            "> Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ now</button>
            <button onclick="this.parentElement.parentElement.remove()" style="
                background: transparent;
                color: white;
                border: 2px solid white;
                padding: 10px 25px;
                border-radius: 8px;
                font-weight: bold;
                cursor: pointer;
                font-family: Vazir, sans-serif;
                font-size: 0.9rem;
                flex: 1;
            ">Ø¨Ø¹Ø¯Ø§Ù‹</button>
        </div>
    `;
    
    document.body.appendChild(notif);
}
// ==================== Ù¾Ø§ÛŒØ§Ù† PWA ====================

            // ==================== Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ ====================
            let residents = loadFromStorage('residents') || [];
            let payments = loadFromStorage('payments') || [];
            let waterShares = [];
            let electricityShares = [];
            let gasShares = [];
            let elevatorShares = [];
            let cleaningShares = [];
            let miscShares = [];

            // ==================== Ø³ÛŒØ³ØªÙ… ØªÙ…â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ ====================
           const themes = [
    { id: 'midnight-blue', name: 'Ø¢Ø¨ÛŒ Ø´Ø¨Ø§Ù†Ù‡', emoji: '', desc: 'Ø¢Ø¨ÛŒ Ø´Ø¨Ø§Ù†Ù‡' },
    { id: 'purple-gray', name: 'Ø¨Ù†ÙØ´-Ø®Ø§Ú©Ø³ØªØ±ÛŒ', emoji: '', desc: 'Ø¨Ù†ÙØ´-Ø®Ø§Ú©Ø³ØªØ±ÛŒ' },
    { id: 'cloudy-blue', name: 'Ø¢Ø¨ÛŒ Ø§Ø¨Ø±ÛŒ', emoji: '', desc: 'Ø¢Ø¨ÛŒ Ø§Ø¨Ø±ÛŒ' },
    { id: 'deep-green', name: 'Ø³Ø¨Ø² Ø¹Ù…ÛŒÙ‚', emoji: '', desc: 'Ø³Ø¨Ø² Ø¹Ù…ÛŒÙ‚' },
    { id: 'spring-green', name: 'Ø³Ø¨Ø² Ø¨Ù‡Ø§Ø±ÛŒ', emoji: '', desc: 'Ø³Ø¨Ø² Ø¨Ù‡Ø§Ø±ÛŒ' },
    { id: 'soft-brown', name: 'Ù‚Ù‡ÙˆÙ‡â€ŒØ§ÛŒ Ù…Ù„Ø§ÛŒÙ…', emoji: '', desc: 'Ù‚Ù‡ÙˆÙ‡â€ŒØ§ÛŒ Ù…Ù„Ø§ÛŒÙ…' },
    { id: 'warm-nature', name: 'Ø·Ø¨ÛŒØ¹Øª Ú¯Ø±Ù…', emoji: '', desc: 'Ø·Ø¨ÛŒØ¹Øª Ú¯Ø±Ù…' },
    { id: 'cream-gray', name: 'Ú©Ø±Ù…-Ø®Ø§Ú©Ø³ØªØ±ÛŒ', emoji: '', desc: 'Ú©Ø±Ù…-Ø®Ø§Ú©Ø³ØªØ±ÛŒ' }
];
            const themesContainer = document.getElementById('themesContainer');
            
            // Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ ØªÙ…
            themes.forEach(theme => {
                const btn = document.createElement('button');
                btn.className = 'theme-btn';
                btn.dataset.theme = theme.id;
                btn.title = `${theme.name} - ${theme.desc}`;
                btn.innerHTML = '';
                themesContainer.appendChild(btn);
            });

            const themeButtons = document.querySelectorAll('.theme-btn');
            
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªÙ… Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡
            const savedTheme = localStorage.getItem('appTheme') || 'blue';
            document.documentElement.setAttribute('data-theme', savedTheme);
            
            // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡ ØªÙ… Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
            themeButtons.forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.theme === savedTheme) {
                    btn.classList.add('active');
                }
            });

            // Ø±ÙˆÛŒØ¯Ø§Ø¯ ØªØºÛŒÛŒØ± ØªÙ…
            themeButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    const theme = this.dataset.theme;
                    
                    // ØªØºÛŒÛŒØ± ØªÙ…
                    document.documentElement.setAttribute('data-theme', theme);
                    localStorage.setItem('appTheme', theme);
                    
                    // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„
                    themeButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    showNotification(`ØªÙ… "${themes.find(t => t.id === theme)?.name || theme}" Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯`, 'info');
                });
            });

            // ==================== ØªÙˆØ§Ø¨Ø¹ ØªØ§Ø±ÛŒØ® Ø´Ù…Ø³ÛŒ ØµØ­ÛŒØ­ ====================
            function gregorianToPersian(date) {
    if (!date) return '';
    
    // Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… Ø¯Ù‚ÛŒÙ‚â€ŒØªØ± (Ù…Ù†Ø¨Ø¹: Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø¹ØªØ¨Ø±)
    const gYear = date.getFullYear();
    const gMonth = date.getMonth() + 1;
    const gDay = date.getDate();
    
    // ØªÙØ§ÙˆØª Ø±ÙˆØ² Ø§Ø² Ø§Ø¨ØªØ¯Ø§ÛŒ Ø³Ø§Ù„ Ù…ÛŒÙ„Ø§Ø¯ÛŒ
    const dayOfYear = Math.floor((date - new Date(gYear, 0, 1)) / 86400000) + 1;
    
    // Ø³Ø§Ù„ Ø´Ù…Ø³ÛŒ ØªÙ‚Ø±ÛŒØ¨ÛŒ
    let pYear = gYear - 621;
    const equinoxBefore = (gYear % 4) === 0 ? 80 : 79;
    
    let dayInPersianYear;
    if (dayOfYear <= equinoxBefore) {
        pYear = gYear - 622;
        dayInPersianYear = dayOfYear + 286;
    } else {
        dayInPersianYear = dayOfYear - equinoxBefore;
    }
    
    // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø§Ù‡ Ùˆ Ø±ÙˆØ² Ø´Ù…Ø³ÛŒ
    let pMonth, pDay;
    if (dayInPersianYear <= 186) {
        pMonth = Math.ceil(dayInPersianYear / 31);
        pDay = dayInPersianYear - (pMonth - 1) * 31;
    } else {
        const dayAfterSummer = dayInPersianYear - 186;
        pMonth = Math.ceil(dayAfterSummer / 30) + 6;
        pDay = dayAfterSummer - (pMonth - 7) * 30;
    }
    
    return `${pYear}/${String(pMonth).padStart(2, '0')}/${String(pDay).padStart(2, '0')}`;
}

function persianToGregorian(persianDate) {
    if (!persianDate) return null;
    
    try {
        const parts = persianDate.split('/');
        if (parts.length !== 3) return null;
        
        const pYear = parseInt(parts[0]);
        const pMonth = parseInt(parts[1]);
        const pDay = parseInt(parts[2]);
        
        // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø±ÙˆØ² Ø§Ø² Ø§Ø¨ØªØ¯Ø§ÛŒ Ø³Ø§Ù„ Ø´Ù…Ø³ÛŒ
        let dayOfYear;
        if (pMonth <= 6) {
            dayOfYear = (pMonth - 1) * 31 + pDay;
        } else {
            dayOfYear = 186 + (pMonth - 7) * 30 + pDay;
        }
        
        // Ø³Ø§Ù„ Ù…ÛŒÙ„Ø§Ø¯ÛŒ ØªÙ‚Ø±ÛŒØ¨ÛŒ
        let gYear = pYear + 621;
        const equinoxBefore = (gYear % 4) === 0 ? 80 : 79;
        
        let dayInGregorianYear;
        if (dayOfYear <= 286) {
            dayInGregorianYear = dayOfYear + equinoxBefore;
        } else {
            gYear = pYear + 622;
            dayInGregorianYear = dayOfYear - 286;
        }
        
        // Ø³Ø§Ø®Øª ØªØ§Ø±ÛŒØ® Ù…ÛŒÙ„Ø§Ø¯ÛŒ
        const gregorianDate = new Date(gYear, 0, 1);
        gregorianDate.setDate(gregorianDate.getDate() + dayInGregorianYear - 1);
        
        return gregorianDate;
    } catch (error) {
        console.error('Ø®Ø·Ø§ Ø¯Ø± ØªØ¨Ø¯ÛŒÙ„ ØªØ§Ø±ÛŒØ® Ø´Ù…Ø³ÛŒ:', error);
        return null;
    }
}

// ØªØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø²Ú¯Ø§Ø±ÛŒ
function gregorianToPersianSimple(date) {
    return gregorianToPersian(date);
}
            // ==================== Ø³ÛŒØ³ØªÙ… ØªØ¨â€ŒÙ‡Ø§ Ø¨Ø§ Ø¹Ø±Ø¶ Ù‡ÙˆØ´Ù…Ù†Ø¯ ====================
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            const tabsScroll = document.getElementById('tabsScroll');
            
            
            
            // Ø³ÙˆØ¦ÛŒÚ† Ø¨ÛŒÙ† ØªØ¨â€ŒÙ‡Ø§
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));
                    
                    this.classList.add('active');
                    
                    const selectedContent = document.getElementById(tabId + '-tab');
                    if (selectedContent) {
                        selectedContent.classList.add('active');
                        
                        if (tabId === 'payments') {
                            updatePaymentsTable();
                            updateUnitReportFilter();
                        }
                    }
                    
                    // Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¨Ù‡ ØªØ¨ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
                    if (tabsScroll.scrollWidth > tabsScroll.clientWidth) {
                        const tabRect = this.getBoundingClientRect();
                        const containerRect = tabsScroll.getBoundingClientRect();
                        const scrollLeft = tabsScroll.scrollLeft;
                        const targetScroll = scrollLeft + (tabRect.left - containerRect.left) - 50;
                        
                        tabsScroll.scrollTo({
                            left: targetScroll,
                            behavior: 'smooth'
                        });
                    }
                });
            });

            // ==================== Ø¨Ù‚ÛŒÙ‡ Ú©Ø¯Ù‡Ø§ ====================
            // ØªØ¨ Ø³Ø§Ú©Ù†ÛŒÙ†
            const addResidentBtn = document.getElementById('addResidentBtn');
            const residentForm = document.getElementById('residentForm');
            const cancelAddBtn = document.getElementById('cancelAddBtn');
            const saveResidentBtn = document.getElementById('saveResidentBtn');
            const residentsList = document.getElementById('residentsList');
            const residentsCount = document.getElementById('residentsCount');
            const unitsCount = document.getElementById('unitsCount');
            
            addResidentBtn.addEventListener('click', function() {
                residentForm.style.display = 'block';
                document.getElementById('residentName').focus();
            });
            
            cancelAddBtn.addEventListener('click', function() {
                residentForm.style.display = 'none';
                clearResidentForm();
            });
            
            saveResidentBtn.addEventListener('click', function() {
                const name = document.getElementById('residentName').value.trim();
                const unit = document.getElementById('unitNumber').value.trim();
                const phone = document.getElementById('phoneNumber').value.trim();
                const count = parseEnglishNumber(document.getElementById('residentCount').value) || 1;
                const area = parseEnglishNumber(document.getElementById('unitArea').value) || 0;
                
                if (!name || !unit || !phone) {
                    showNotification('Ù„Ø·ÙØ§Ù‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¶Ø±ÙˆØ±ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'error');
                    return;
                }
                
                const duplicate = residents.find(r => r.unit === unit);
                if (duplicate) {
                    showNotification('Ø§ÛŒÙ† Ø´Ù…Ø§Ø±Ù‡ ÙˆØ§Ø­Ø¯ Ù‚Ø¨Ù„Ø§Ù‹ Ø«Ø¨Øª Ø´Ø¯Ù‡ Ø§Ø³Øª', 'error');
                    return;
                }
                
                const resident = {
                    id: Date.now(),
                    name: name,
                    unit: unit,
                    phone: phone,
                    count: count,
                    area: area
                };
                
                residents.push(resident);
                saveToStorage('residents', residents);
                updateResidentsList();
                updateUnitReportFilter();
                
                residentForm.style.display = 'none';
                clearResidentForm();
                showNotification('Ø³Ø§Ú©Ù† Ø¬Ø¯ÛŒØ¯ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯');
            });
            
            function updateResidentsList() {
                residentsList.innerHTML = '';
                
                if (residents.length === 0) {
                    residentsList.innerHTML = `
                        <tr>
                            <td colspan="7" class="empty-message">
                                Ù‡ÛŒÚ† Ø³Ø§Ú©Ù†ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª
                            </td>
                        </tr>
                    `;
                } else {
                    residents.forEach((resident, index) => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${index + 1}</td>
                            <td>${resident.name}</td>
                            <td>${resident.unit}</td>
                            <td dir="ltr">${resident.phone}</td>
                            <td dir="ltr">${formatEnglishNumber(resident.count)}</td>
                            <td dir="ltr">${formatEnglishNumber(resident.area)}</td>
                            <td>
                                <div class="action-buttons">
                                    <button class="action-btn btn-warning" onclick="editResident(${resident.id})">ÙˆÛŒØ±Ø§ÛŒØ´</button>
                                    <button class="action-btn btn-danger" onclick="deleteResident(${resident.id})">Ø­Ø°Ù</button>
                                </div>
                            </td>
                        `;
                        residentsList.appendChild(row);
                    });
                }
                
                const totalResidents = residents.reduce((sum, r) => sum + r.count, 0);
                const totalUnits = residents.length;
                
                residentsCount.textContent = `ØªØ¹Ø¯Ø§Ø¯ Ø³Ø§Ú©Ù†ÛŒÙ†: ${formatEnglishNumber(totalResidents)} Ù†ÙØ±`;
                unitsCount.textContent = `ØªØ¹Ø¯Ø§Ø¯ ÙˆØ§Ø­Ø¯Ù‡Ø§: ${formatEnglishNumber(totalUnits)} ÙˆØ§Ø­Ø¯`;
            }
            
            function clearResidentForm() {
                document.getElementById('residentName').value = '';
                document.getElementById('unitNumber').value = '';
                document.getElementById('phoneNumber').value = '';
                document.getElementById('residentCount').value = '';
                document.getElementById('unitArea').value = '';
            }
            
            window.editResident = function(id) {
                const resident = residents.find(r => r.id === id);
                if (resident) {
                    document.getElementById('residentName').value = resident.name;
                    document.getElementById('unitNumber').value = resident.unit;
                    document.getElementById('phoneNumber').value = resident.phone;
                    document.getElementById('residentCount').value = formatEnglishNumber(resident.count);
                    document.getElementById('unitArea').value = formatEnglishNumber(resident.area);
                    
                    residentForm.style.display = 'block';
                    
                    residents = residents.filter(r => r.id !== id);
                    saveToStorage('residents', residents);
                    updateResidentsList();
                    showNotification('Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³Ø§Ú©Ù† Ø¨Ø±Ø§ÛŒ ÙˆÛŒØ±Ø§ÛŒØ´ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª', 'info');
                }
            };
            
            window.deleteResident = function(id) {
                if (confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ø³Ø§Ú©Ù† Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ')) {
                    residents = residents.filter(r => r.id !== id);
                    saveToStorage('residents', residents);
                    updateResidentsList();
                    updateUnitReportFilter();
                    showNotification('Ø³Ø§Ú©Ù† Ø­Ø°Ù Ø´Ø¯');
                }
            };

            // ==================== ØªØ¨ Ø¢Ø¨ ====================
            const calculateWaterBtn = document.getElementById('calculateWaterBtn');
            calculateWaterBtn.addEventListener('click', function() {
                if (residents.length === 0) {
                    showNotification('Ø§Ø¨ØªØ¯Ø§ Ø³Ø§Ú©Ù†ÛŒÙ† Ø±Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯', 'error');
                    return;
                }
                
                const period = document.getElementById('waterPeriod').value.trim();
                const total = parseEnglishNumber(document.getElementById('waterTotal').value) || 0;
                const method = document.getElementById('waterMethod').value;
                const billId = document.getElementById('waterBillId').value.trim();
                
                if (!period || total <= 0 || !method) {
                    showNotification('Ù„Ø·ÙØ§Ù‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¶Ø±ÙˆØ±ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'error');
                    return;
                }
                
                waterShares = calculateShares(residents, total, method, 'Ø¢Ø¨');
                updateWaterList();
                
                saveToArchive('water', period, total, method, waterShares, billId);
                showNotification('Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¢Ø¨ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯');
            });
            
            function updateWaterList() {
                const waterList = document.getElementById('waterList');
                waterList.innerHTML = '';
                
                if (waterShares.length === 0) {
                    waterList.innerHTML = `
                        <tr>
                            <td colspan="5" class="empty-message">
                                Ø§Ø¨ØªØ¯Ø§ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø±Ø§ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯
                            </td>
                        </tr>
                    `;
                    
                    document.getElementById('waterTotalAmount').textContent = 'Û° ØªÙˆÙ…Ø§Ù†';
                    document.getElementById('waterCalculatedAmount').textContent = 'Û° ØªÙˆÙ…Ø§Ù†';
                    document.getElementById('waterStatus').textContent = 'Ø§Ø¨ØªØ¯Ø§ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø±Ø§ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯';
                    document.getElementById('waterStatus').className = 'summary-status';
                    return;
                }
                
                let totalCalculated = 0;
                
                waterShares.forEach(share => {
                    totalCalculated += share.amount;
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${share.unit}</td>
                        <td>${share.name}</td>
                        <td dir="ltr">${formatEnglishNumber(share.count)}</td>
                        <td dir="ltr">${formatEnglishNumber(share.amount)}</td>
                        <td>
                            <button class="action-btn btn-success" onclick="sendWaterSMS(${share.id})">Ù¾ÛŒØ§Ù…Ú©</button>
                        </td>
                    `;
                    waterList.appendChild(row);
                });
                
                const totalBill = parseEnglishNumber(document.getElementById('waterTotal').value) || 0;
                const difference = Math.abs(totalBill - totalCalculated);
                const isMatch = difference < 1;
                
                document.getElementById('waterTotalAmount').textContent = formatEnglishNumber(totalBill) + ' ØªÙˆÙ…Ø§Ù†';
                document.getElementById('waterCalculatedAmount').textContent = formatEnglishNumber(totalCalculated) + ' ØªÙˆÙ…Ø§Ù†';
                
                const statusElement = document.getElementById('waterStatus');
                statusElement.textContent = isMatch ? 'ØªØ·Ø§Ø¨Ù‚ Ú©Ø§Ù…Ù„' : `Ù…ØºØ§ÛŒØ±Øª: ${formatEnglishNumber(difference)} ØªÙˆÙ…Ø§Ù†`;
                statusElement.className = `summary-status ${isMatch ? 'status-match' : 'status-mismatch'}`;
            }

            // ==================== ØªØ¨ Ø¨Ø±Ù‚ ====================
            const calculateElectricityBtn = document.getElementById('calculateElectricityBtn');
            calculateElectricityBtn.addEventListener('click', function() {
                if (residents.length === 0) {
                    showNotification('Ø§Ø¨ØªØ¯Ø§ Ø³Ø§Ú©Ù†ÛŒÙ† Ø±Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯', 'error');
                    return;
                }
                
                const period = document.getElementById('electricityPeriod').value.trim();
                const total = parseEnglishNumber(document.getElementById('electricityTotal').value) || 0;
                const method = document.getElementById('electricityMethod').value;
                const billId = document.getElementById('electricityBillId').value.trim();
                
                if (!period || total <= 0 || !method) {
                    showNotification('Ù„Ø·ÙØ§Ù‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¶Ø±ÙˆØ±ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'error');
                    return;
                }
                
                electricityShares = calculateShares(residents, total, method, 'Ø¨Ø±Ù‚');
                updateElectricityList();
                
                saveToArchive('electricity', period, total, method, electricityShares, billId);
                showNotification('Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¨Ø±Ù‚ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯');
            });
            
            function updateElectricityList() {
                const electricityList = document.getElementById('electricityList');
                electricityList.innerHTML = '';
                
                if (electricityShares.length === 0) {
                    electricityList.innerHTML = `
                        <tr>
                            <td colspan="5" class="empty-message">
                                Ø§Ø¨ØªØ¯Ø§ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø±Ø§ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯
                            </td>
                        </tr>
                    `;
                    
                    document.getElementById('electricityTotalAmount').textContent = 'Û° ØªÙˆÙ…Ø§Ù†';
                    document.getElementById('electricityCalculatedAmount').textContent = 'Û° ØªÙˆÙ…Ø§Ù†';
                    document.getElementById('electricityStatus').textContent = 'Ø§Ø¨ØªØ¯Ø§ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø±Ø§ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯';
                    document.getElementById('electricityStatus').className = 'summary-status';
                    return;
                }
                
                let totalCalculated = 0;
                
                electricityShares.forEach(share => {
                    totalCalculated += share.amount;
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${share.unit}</td>
                        <td>${share.name}</td>
                        <td dir="ltr">${formatEnglishNumber(share.count)}</td>
                        <td dir="ltr">${formatEnglishNumber(share.amount)}</td>
                        <td>
                            <button class="action-btn btn-success" onclick="sendElectricitySMS(${share.id})">Ù¾ÛŒØ§Ù…Ú©</button>
                        </td>
                    `;
                    electricityList.appendChild(row);
                });
                
                const totalBill = parseEnglishNumber(document.getElementById('electricityTotal').value) || 0;
                const difference = Math.abs(totalBill - totalCalculated);
                const isMatch = difference < 1;
                
                document.getElementById('electricityTotalAmount').textContent = formatEnglishNumber(totalBill) + ' ØªÙˆÙ…Ø§Ù†';
                document.getElementById('electricityCalculatedAmount').textContent = formatEnglishNumber(totalCalculated) + ' ØªÙˆÙ…Ø§Ù†';
                
                const statusElement = document.getElementById('electricityStatus');
                statusElement.textContent = isMatch ? 'ØªØ·Ø§Ø¨Ù‚ Ú©Ø§Ù…Ù„' : `Ù…ØºØ§ÛŒØ±Øª: ${formatEnglishNumber(difference)} ØªÙˆÙ…Ø§Ù†`;
                statusElement.className = `summary-status ${isMatch ? 'status-match' : 'status-mismatch'}`;
            }

            // ==================== ØªØ¨ Ú¯Ø§Ø² ====================
            const calculateGasBtn = document.getElementById('calculateGasBtn');
            calculateGasBtn.addEventListener('click', function() {
                if (residents.length === 0) {
                    showNotification('Ø§Ø¨ØªØ¯Ø§ Ø³Ø§Ú©Ù†ÛŒÙ† Ø±Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯', 'error');
                    return;
                }
                
                const period = document.getElementById('gasPeriod').value.trim();
                const total = parseEnglishNumber(document.getElementById('gasTotal').value) || 0;
                const method = document.getElementById('gasMethod').value;
                const billId = document.getElementById('gasBillId').value.trim();
                
                if (!period || total <= 0 || !method) {
                    showNotification('Ù„Ø·ÙØ§Ù‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¶Ø±ÙˆØ±ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'error');
                    return;
                }
                
                gasShares = calculateShares(residents, total, method, 'Ú¯Ø§Ø²');
                updateGasList();
                
                saveToArchive('gas', period, total, method, gasShares, billId);
                showNotification('Ù…Ø­Ø§Ø³Ø¨Ù‡ Ú¯Ø§Ø² Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯');
            });
            
            function updateGasList() {
                const gasList = document.getElementById('gasList');
                gasList.innerHTML = '';
                
                if (gasShares.length === 0) {
                    gasList.innerHTML = `
                        <tr>
                            <td colspan="5" class="empty-message">
                                Ø§Ø¨ØªØ¯Ø§ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø±Ø§ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯
                            </td>
                        </tr>
                    `;
                    
                    document.getElementById('gasTotalAmount').textContent = 'Û° ØªÙˆÙ…Ø§Ù†';
                    document.getElementById('gasCalculatedAmount').textContent = 'Û° ØªÙˆÙ…Ø§Ù†';
                    document.getElementById('gasStatus').textContent = 'Ø§Ø¨ØªØ¯Ø§ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø±Ø§ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯';
                    document.getElementById('gasStatus').className = 'summary-status';
                    return;
                }
                
                let totalCalculated = 0;
                
                gasShares.forEach(share => {
                    totalCalculated += share.amount;
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${share.unit}</td>
                        <td>${share.name}</td>
                        <td dir="ltr">${formatEnglishNumber(share.area)}</td>
                        <td dir="ltr">${formatEnglishNumber(share.amount)}</td>
                        <td>
                            <button class="action-btn btn-success" onclick="sendGasSMS(${share.id})">Ù¾ÛŒØ§Ù…Ú©</button>
                        </td>
                    `;
                    gasList.appendChild(row);
                });
                
                const totalBill = parseEnglishNumber(document.getElementById('gasTotal').value) || 0;
                const difference = Math.abs(totalBill - totalCalculated);
                const isMatch = difference < 1;
                
                document.getElementById('gasTotalAmount').textContent = formatEnglishNumber(totalBill) + ' ØªÙˆÙ…Ø§Ù†';
                document.getElementById('gasCalculatedAmount').textContent = formatEnglishNumber(totalCalculated) + ' ØªÙˆÙ…Ø§Ù†';
                
                const statusElement = document.getElementById('gasStatus');
                statusElement.textContent = isMatch ? 'ØªØ·Ø§Ø¨Ù‚ Ú©Ø§Ù…Ù„' : `Ù…ØºØ§ÛŒØ±Øª: ${formatEnglishNumber(difference)} ØªÙˆÙ…Ø§Ù†`;
                statusElement.className = `summary-status ${isMatch ? 'status-match' : 'status-mismatch'}`;
            }

            // ==================== ØªØ¨ Ø¢Ø³Ø§Ù†Ø³ÙˆØ± ====================
            const calculateElevatorBtn = document.getElementById('calculateElevatorBtn');
            calculateElevatorBtn.addEventListener('click', function() {
                if (residents.length === 0) {
                    showNotification('Ø§Ø¨ØªØ¯Ø§ Ø³Ø§Ú©Ù†ÛŒÙ† Ø±Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯', 'error');
                    return;
                }
                
                const period = document.getElementById('elevatorPeriod').value.trim();
                const total = parseEnglishNumber(document.getElementById('elevatorTotal').value) || 0;
                const method = document.getElementById('elevatorMethod').value;
                const description = document.getElementById('elevatorDescription').value.trim();
                
                if (!period || total <= 0) {
                    showNotification('Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ±Ù‡ Ùˆ Ù…Ø¨Ù„Øº Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'error');
                    return;
                }
                
                elevatorShares = calculateShares(residents, total, method, 'Ø¢Ø³Ø§Ù†Ø³ÙˆØ±');
                updateElevatorList();
                
                saveToArchive('elevator', period, total, method, elevatorShares, description);
                showNotification('Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¢Ø³Ø§Ù†Ø³ÙˆØ± Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯');
            });
            
            function updateElevatorList() {
                const elevatorList = document.getElementById('elevatorList');
                elevatorList.innerHTML = '';
                
                if (elevatorShares.length === 0) {
                    elevatorList.innerHTML = `
                        <tr>
                            <td colspan="5" class="empty-message">
                                Ø§Ø¨ØªØ¯Ø§ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø±Ø§ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯
                            </td>
                        </tr>
                    `;
                    
                    document.getElementById('elevatorTotalAmount').textContent = 'Û° ØªÙˆÙ…Ø§Ù†';
                    document.getElementById('elevatorCalculatedAmount').textContent = 'Û° ØªÙˆÙ…Ø§Ù†';
                    document.getElementById('elevatorStatus').textContent = 'Ø§Ø¨ØªØ¯Ø§ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø±Ø§ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯';
                    document.getElementById('elevatorStatus').className = 'summary-status';
                    return;
                }
                
                let totalCalculated = 0;
                
                elevatorShares.forEach(share => {
                    totalCalculated += share.amount;
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${share.unit}</td>
                        <td>${share.name}</td>
                        <td dir="ltr">${formatEnglishNumber(1)}</td>
                        <td dir="ltr">${formatEnglishNumber(share.amount)}</td>
                        <td>
                            <button class="action-btn btn-success" onclick="sendElevatorSMS(${share.id})">Ù¾ÛŒØ§Ù…Ú©</button>
                        </td>
                    `;
                    elevatorList.appendChild(row);
                });
                
                const totalBill = parseEnglishNumber(document.getElementById('elevatorTotal').value) || 0;
                const difference = Math.abs(totalBill - totalCalculated);
                const isMatch = difference < 1;
                
                document.getElementById('elevatorTotalAmount').textContent = formatEnglishNumber(totalBill) + ' ØªÙˆÙ…Ø§Ù†';
                document.getElementById('elevatorCalculatedAmount').textContent = formatEnglishNumber(totalCalculated) + ' ØªÙˆÙ…Ø§Ù†';
                
                const statusElement = document.getElementById('elevatorStatus');
                statusElement.textContent = isMatch ? 'ØªØ·Ø§Ø¨Ù‚ Ú©Ø§Ù…Ù„' : `Ù…ØºØ§ÛŒØ±Øª: ${formatEnglishNumber(difference)} ØªÙˆÙ…Ø§Ù†`;
                statusElement.className = `summary-status ${isMatch ? 'status-match' : 'status-mismatch'}`;
            }

            // ==================== ØªØ¨ Ù†Ø¸Ø§ÙØª ====================
            const calculateCleaningBtn = document.getElementById('calculateCleaningBtn');
            calculateCleaningBtn.addEventListener('click', function() {
                if (residents.length === 0) {
                    showNotification('Ø§Ø¨ØªØ¯Ø§ Ø³Ø§Ú©Ù†ÛŒÙ† Ø±Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯', 'error');
                    return;
                }
                
                const period = document.getElementById('cleaningPeriod').value.trim();
                const total = parseEnglishNumber(document.getElementById('cleaningTotal').value) || 0;
                const method = document.getElementById('cleaningMethod').value;
                const description = document.getElementById('cleaningDescription').value.trim();
                
                if (!period || total <= 0) {
                    showNotification('Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ±Ù‡ Ùˆ Ù…Ø¨Ù„Øº Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'error');
                    return;
                }
                
                cleaningShares = calculateShares(residents, total, method, 'Ù†Ø¸Ø§ÙØª');
                updateCleaningList();
                
                saveToArchive('cleaning', period, total, method, cleaningShares, description);
                showNotification('Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù†Ø¸Ø§ÙØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯');
            });
            
            function updateCleaningList() {
                const cleaningList = document.getElementById('cleaningList');
                cleaningList.innerHTML = '';
                
                if (cleaningShares.length === 0) {
                    cleaningList.innerHTML = `
                        <tr>
                            <td colspan="5" class="empty-message">
                                Ø§Ø¨ØªØ¯Ø§ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø±Ø§ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯
                            </td>
                        </tr>
                    `;
                    
                    document.getElementById('cleaningTotalAmount').textContent = 'Û° ØªÙˆÙ…Ø§Ù†';
                    document.getElementById('cleaningCalculatedAmount').textContent = 'Û° ØªÙˆÙ…Ø§Ù†';
                    document.getElementById('cleaningStatus').textContent = 'Ø§Ø¨ØªØ¯Ø§ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø±Ø§ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯';
                    document.getElementById('cleaningStatus').className = 'summary-status';
                    return;
                }
                
                let totalCalculated = 0;
                
                cleaningShares.forEach(share => {
                    totalCalculated += share.amount;
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${share.unit}</td>
                        <td>${share.name}</td>
                        <td dir="ltr">${formatEnglishNumber(1)}</td>
                        <td dir="ltr">${formatEnglishNumber(share.amount)}</td>
                        <td>
                            <button class="action-btn btn-success" onclick="sendCleaningSMS(${share.id})">Ù¾ÛŒØ§Ù…Ú©</button>
                        </td>
                    `;
                    cleaningList.appendChild(row);
                });
                
                const totalBill = parseEnglishNumber(document.getElementById('cleaningTotal').value) || 0;
                const difference = Math.abs(totalBill - totalCalculated);
                const isMatch = difference < 1;
                
                document.getElementById('cleaningTotalAmount').textContent = formatEnglishNumber(totalBill) + ' ØªÙˆÙ…Ø§Ù†';
                document.getElementById('cleaningCalculatedAmount').textContent = formatEnglishNumber(totalCalculated) + ' ØªÙˆÙ…Ø§Ù†';
                
                const statusElement = document.getElementById('cleaningStatus');
                statusElement.textContent = isMatch ? 'ØªØ·Ø§Ø¨Ù‚ Ú©Ø§Ù…Ù„' : `Ù…ØºØ§ÛŒØ±Øª: ${formatEnglishNumber(difference)} ØªÙˆÙ…Ø§Ù†`;
                statusElement.className = `summary-status ${isMatch ? 'status-match' : 'status-mismatch'}`;
            }

            // ==================== ØªØ¨ Ù…ØªÙØ±Ù‚Ù‡ ====================
            const calculateMiscBtn = document.getElementById('calculateMiscBtn');
            calculateMiscBtn.addEventListener('click', function() {
                if (residents.length === 0) {
                    showNotification('Ø§Ø¨ØªØ¯Ø§ Ø³Ø§Ú©Ù†ÛŒÙ† Ø±Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯', 'error');
                    return;
                }
                
                const period = document.getElementById('miscPeriod').value.trim();
                const total = parseEnglishNumber(document.getElementById('miscTotal').value) || 0;
                const method = document.getElementById('miscMethod').value;
                const description = document.getElementById('miscDescription').value.trim();
                
                if (!period || total <= 0) {
                    showNotification('Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ±Ù‡ Ùˆ Ù…Ø¨Ù„Øº Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'error');
                    return;
                }
                
                miscShares = calculateShares(residents, total, method, 'Ù…ØªÙØ±Ù‚Ù‡');
                updateMiscList();
                
                saveToArchive('misc', period, total, method, miscShares, description);
                showNotification('Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ØªÙØ±Ù‚Ù‡ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯');
            });
            
            function updateMiscList() {
                const miscList = document.getElementById('miscList');
                miscList.innerHTML = '';
                
                if (miscShares.length === 0) {
                    miscList.innerHTML = `
                        <tr>
                            <td colspan="5" class="empty-message">
                                Ø§Ø¨ØªØ¯Ø§ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø±Ø§ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯
                            </td>
                        </tr>
                    `;
                    
                    document.getElementById('miscTotalAmount').textContent = 'Û° ØªÙˆÙ…Ø§Ù†';
                    document.getElementById('miscCalculatedAmount').textContent = 'Û° ØªÙˆÙ…Ø§Ù†';
                    document.getElementById('miscStatus').textContent = 'Ø§Ø¨ØªØ¯Ø§ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø±Ø§ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯';
                    document.getElementById('miscStatus').className = 'summary-status';
                    return;
                }
                
                let totalCalculated = 0;
                
                miscShares.forEach(share => {
                    totalCalculated += share.amount;
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${share.unit}</td>
                        <td>${share.name}</td>
                        <td dir="ltr">${formatEnglishNumber(1)}</td>
                        <td dir="ltr">${formatEnglishNumber(share.amount)}</td>
                        <td>
                            <button class="action-btn btn-success" onclick="sendMiscSMS(${share.id})">Ù¾ÛŒØ§Ù…Ú©</button>
                        </td>
                    `;
                    miscList.appendChild(row);
                });
                
                const totalBill = parseEnglishNumber(document.getElementById('miscTotal').value) || 0;
                const difference = Math.abs(totalBill - totalCalculated);
                const isMatch = difference < 1;
                
                document.getElementById('miscTotalAmount').textContent = formatEnglishNumber(totalBill) + ' ØªÙˆÙ…Ø§Ù†';
                document.getElementById('miscCalculatedAmount').textContent = formatEnglishNumber(totalCalculated) + ' ØªÙˆÙ…Ø§Ù†';
                
                const statusElement = document.getElementById('miscStatus');
                statusElement.textContent = isMatch ? 'ØªØ·Ø§Ø¨Ù‚ Ú©Ø§Ù…Ù„' : `Ù…ØºØ§ÛŒØ±Øª: ${formatEnglishNumber(difference)} ØªÙˆÙ…Ø§Ù†`;
                statusElement.className = `summary-status ${isMatch ? 'status-match' : 'status-mismatch'}`;
            }

            // ==================== ØªØ¨ Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒÙ‡Ø§ ====================
            const savePaymentsBtn = document.getElementById('savePaymentsBtn');
            const generateUnitReportBtn = document.getElementById('generateUnitReportBtn');
            const exportUnitReportBtn = document.getElementById('exportUnitReportBtn');
            
            savePaymentsBtn.addEventListener('click', savePayments);
            generateUnitReportBtn.addEventListener('click', generateUnitReport);
            
            function savePayments() {
                const period = document.getElementById('paymentPeriod').value.trim();
                const date = document.getElementById('paymentDate').value.trim();
                const description = document.getElementById('paymentDescription').value.trim();
                
                if (!period || !date) {
                    showNotification('Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ±Ù‡ Ùˆ ØªØ§Ø±ÛŒØ® Ù¾Ø±Ø¯Ø§Ø®Øª Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'error');
                    return;
                }
                
                const paymentInputs = document.querySelectorAll('.payment-amount');
                let hasPayment = false;
                
                paymentInputs.forEach(input => {
                    const amount = parseEnglishNumber(input.value) || 0;
                    if (amount > 0) {
                        hasPayment = true;
                        const unitNumber = input.dataset.unit;
                        const resident = residents.find(r => r.unit === unitNumber);
                        
                        if (resident) {
                            const payment = {
                                id: Date.now() + Math.random(),
                                unitNumber: unitNumber,
                                residentName: resident.name,
                                amount: amount,
                                period: period,
                                paymentDate: date,
                                description: description,
                                createdAt: new Date().toISOString()
                            };
                            
                            payments.push(payment);
                        }
                    }
                });
                
                if (!hasPayment) {
                    showNotification('Ù‡ÛŒÚ† Ù…Ø¨Ù„Øº Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª', 'error');
                    return;
                }
                
                saveToStorage('payments', payments);
                updatePaymentsTable();
                showNotification('Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒÙ‡Ø§ Ø«Ø¨Øª Ø´Ø¯Ù†Ø¯');
                
                // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙÛŒÙ„Ø¯ ØªÙˆØ¶ÛŒØ­Ø§Øª
                document.getElementById('paymentDescription').value = '';
            }
            
            function updatePaymentsTable() {
                const paymentsList = document.getElementById('paymentsList');
                const period = document.getElementById('paymentPeriod').value || 'Ø¨Ø¯ÙˆÙ† Ø¯ÙˆØ±Ù‡';
                
                paymentsList.innerHTML = '';
                
                if (residents.length === 0) {
                    paymentsList.innerHTML = `
                        <tr>
                            <td colspan="5" class="empty-message">
                                Ø§Ø¨ØªØ¯Ø§ Ø³Ø§Ú©Ù†ÛŒÙ† Ø±Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                let totalPayments = 0;
                let paidUnits = 0;
                
                residents.forEach((resident, index) => {
                    const paymentForUnit = payments
                        .filter(p => p.unitNumber === resident.unit && p.period === period)
                        .reduce((sum, p) => sum + p.amount, 0);
                    
                    if (paymentForUnit > 0) paidUnits++;
                    totalPayments += paymentForUnit;
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${resident.unit}</td>
                        <td>${resident.name}</td>
                        <td>
                            <input type="text" 
                                   class="form-input payment-input payment-amount" 
                                   data-unit="${resident.unit}"
                                   value="${paymentForUnit > 0 ? formatEnglishNumber(paymentForUnit) : ''}"
                                   placeholder="Ù…Ø¨Ù„Øº"
                                   maxlength="12"
                                   inputmode="numeric">
                        </td>
                        <td>
                            <span style="color: ${paymentForUnit > 0 ? 'var(--success-color)' : 'var(--danger-color)'}; font-weight: 600;">
                                ${paymentForUnit > 0 ? 'Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ø¯Ù‡' : 'Ù¾Ø±Ø¯Ø§Ø®Øª Ù†Ø´Ø¯Ù‡'}
                            </span>
                        </td>
                    `;
                    paymentsList.appendChild(row);
                });
                
                document.getElementById('totalPayments').textContent = formatEnglishNumber(totalPayments) + ' ØªÙˆÙ…Ø§Ù†';
                document.getElementById('paidUnitsCount').textContent = paidUnits + ' ÙˆØ§Ø­Ø¯';
                document.getElementById('paymentStatus').textContent = paidUnits > 0 ? 
                    `${paidUnits} ÙˆØ§Ø­Ø¯ Ù¾Ø±Ø¯Ø§Ø®Øª Ú©Ø±Ø¯Ù‡â€ŒØ§Ù†Ø¯` : 
                    'Ù…Ù†ØªØ¸Ø± Ø«Ø¨Øª Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒÙ‡Ø§';
                
                setupNumberInputValidation();
            }
            
            function updateUnitReportFilter() {
                const unitReportFilter = document.getElementById('unitReportFilter');
                unitReportFilter.innerHTML = '<option value="">Ø§Ù†ØªØ®Ø§Ø¨ ÙˆØ§Ø­Ø¯ Ø¨Ø±Ø§ÛŒ Ú¯Ø²Ø§Ø±Ø´</option>';
                
                residents.forEach(resident => {
                    const option = document.createElement('option');
                    option.value = resident.unit;
                    option.textContent = `ÙˆØ§Ø­Ø¯ ${resident.unit} - ${resident.name}`;
                    unitReportFilter.appendChild(option);
                });
            }
            
            function generateUnitReport() {
                const unitNumber = document.getElementById('unitReportFilter').value;
                
                if (!unitNumber) {
                    showNotification('Ù„Ø·ÙØ§Ù‹ ÛŒÚ© ÙˆØ§Ø­Ø¯ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯', 'error');
                    return;
                }
                
                const report = getUnitReport(unitNumber);
                displayUnitReport(report);
            }
            
            function getUnitReport(unitNumber) {
                const archive = loadFromStorage('archive') || [];
                const unitPayments = payments.filter(p => 
                    p.unitNumber == unitNumber || 
                    String(p.unitNumber).trim() === String(unitNumber).trim()
                );
                const resident = residents.find(r => r.unit === unitNumber);
                
                const unitBills = [];
                archive.forEach(record => {
                    if (record.shares && Array.isArray(record.shares)) {
                        const share = record.shares.find(s => s.unit === unitNumber);
                        if (share) {
                            unitBills.push({
                                billType: record.billType,
                                billTypeName: getBillTypeName(record.billType),
                                period: record.period,
                                amount: share.amount,
                                totalBill: record.total,
                                method: record.method,
                                date: record.createdAt,
                                description: record.description || record.billId || ''
                            });
                        }
                    }
                });
                
                const totalBills = unitBills.reduce((sum, bill) => sum + bill.amount, 0);
                const totalPayments = unitPayments.reduce((sum, p) => sum + p.amount, 0);
                const balance = totalPayments - totalBills;
                
                return {
                    unitNumber: unitNumber,
                    residentName: resident ? resident.name : 'Ù†Ø§Ù…Ø´Ø®Øµ',
                    unitBills: unitBills,
                    unitPayments: unitPayments,
                    totalBills: totalBills,
                    totalPayments: totalPayments,
                    balance: balance,
                    status: balance >= 0 ? "ØªØ³ÙˆÛŒÙ‡ Ø´Ø¯Ù‡" : "Ø¨Ø¯Ù‡Ú©Ø§Ø±",
                    lastUpdate: new Date().toLocaleString('fa-IR')
                };
            }
            
            function displayUnitReport(report) {
                const modal = document.getElementById('unitReportModal');
                const title = document.getElementById('unitReportTitle');
                const content = document.getElementById('unitReportContent');
                
                title.textContent = `Ú¯Ø²Ø§Ø±Ø´ ØªØ¬Ù…ÛŒØ¹ÛŒ ÙˆØ§Ø­Ø¯ ${report.unitNumber}`;
                
                let html = `
                    <div class="report-summary">
                        <div class="report-item">
                            <span>Ù†Ø§Ù… Ø³Ø§Ú©Ù†:</span>
                            <span style="font-weight: 600;">${report.residentName}</span>
                        </div>
                        <div class="report-item">
                            <span>Ù…Ø¬Ù…ÙˆØ¹ Ù‚Ø¨Ø¶â€ŒÙ‡Ø§:</span>
                            <span style="color: var(--danger-color); font-weight: 600;">${formatEnglishNumber(report.totalBills)} ØªÙˆÙ…Ø§Ù†</span>
                        </div>
                        <div class="report-item">
                            <span>Ù…Ø¬Ù…ÙˆØ¹ Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒÙ‡Ø§:</span>
                            <span style="color: var(--success-color); font-weight: 600;">${formatEnglishNumber(report.totalPayments)} ØªÙˆÙ…Ø§Ù†</span>
                        </div>
                        <div class="report-item total">
                            <span>Ù…Ø§Ù†Ø¯Ù‡ Ø­Ø³Ø§Ø¨:</span>
                            <span style="color: ${report.balance >= 0 ? 'var(--success-color)' : 'var(--danger-color)'}; font-weight: 600;">
                                ${formatEnglishNumber(Math.abs(report.balance))} ØªÙˆÙ…Ø§Ù† ${report.balance >= 0 ? 'Ø¨Ø³ØªØ§Ù†Ú©Ø§Ø±' : 'Ø¨Ø¯Ù‡Ú©Ø§Ø±'}
                            </span>
                        </div>
                        <div class="report-item">
                            <span>ÙˆØ¶Ø¹ÛŒØª:</span>
                            <span style="color: ${report.status === 'ØªØ³ÙˆÛŒÙ‡ Ø´Ø¯Ù‡' ? 'var(--success-color)' : 'var(--danger-color)'}; font-weight: 600;">
                                ${report.status}
                            </span>
                        </div>
                    </div>
                `;
                
                if (report.unitBills.length > 0) {
                    html += `
                        <div class="category-title" style="margin-top: 20px; font-size: 0.95rem;">Ù‚Ø¨Ø¶â€ŒÙ‡Ø§ÛŒ ÙˆØ§Ø­Ø¯</div>
                        <table class="data-table print-friendly" style="font-size: 0.8rem; margin-top: 10px;">
                            <thead>
                                <tr>
                                    <th>Ù†ÙˆØ¹</th>
                                    <th>Ø¯ÙˆØ±Ù‡</th>
                                    <th>Ù…Ø¨Ù„Øº</th>
                                    <th>ØªÙˆØ¶ÛŒØ­Ø§Øª/Ø´Ù†Ø§Ø³Ù‡ Ù‚Ø¨Ø¶</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;
                    
                    report.unitBills.forEach(bill => {
                        html += `
                            <tr>
                                <td>${bill.billTypeName}</td>
                                <td>${bill.period}</td>
                                <td dir="ltr">${formatEnglishNumber(bill.amount)}</td>
                                <td>${bill.description || '-'}</td>
                            </tr>
                        `;
                    });
                    
                    html += `
                            </tbody>
                        </table>
                    `;
                }
                
                if (report.unitPayments.length > 0) {
                    html += `
                        <div class="category-title" style="margin-top: 20px; font-size: 0.95rem; color: var(--payments-color);">Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒÙ‡Ø§ÛŒ ÙˆØ§Ø­Ø¯</div>
                        <table class="data-table print-friendly" style="font-size: 0.8rem; margin-top: 10px;">
                            <thead>
                                <tr>
                                    <th>Ø¯ÙˆØ±Ù‡</th>
                                    <th>ØªØ§Ø±ÛŒØ® Ù¾Ø±Ø¯Ø§Ø®Øª</th>
                                    <th>Ù…Ø¨Ù„Øº</th>
                                    <th>ØªÙˆØ¶ÛŒØ­Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;
                    
                    report.unitPayments.forEach(payment => {
                        html += `
                            <tr>
                                <td>${payment.period}</td>
                                <td>${payment.paymentDate}</td>
                                <td dir="ltr">${formatEnglishNumber(payment.amount)}</td>
                                <td>${payment.description || '-'}</td>
                            </tr>
                        `;
                    });
                    
                    html += `
                            </tbody>
                        </table>
                    `;
                }
                
                content.innerHTML = html;
                modal.style.display = 'flex';
            }

            // ==================== ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ ====================
            function calculateShares(residents, total, method, billType) {
                const shares = [];
                let totalFactor = 0;
                
                residents.forEach(resident => {
                    if (method === 'per_resident') {
                        totalFactor += resident.count;
                    } else if (method === 'per_unit') {
                        totalFactor += 1;
                    } else if (method === 'per_area') {
                        totalFactor += resident.area;
                    }
                });
                
                if (totalFactor === 0) return shares;
                
                residents.forEach(resident => {
                    let factor = 0;
                    if (method === 'per_resident') {
                        factor = resident.count;
                    } else if (method === 'per_unit') {
                        factor = 1;
                    } else if (method === 'per_area') {
                        factor = resident.area;
                    }
                    
                    const shareAmount = Math.round((total * factor) / totalFactor);
                    
                    shares.push({
                        id: resident.id,
                        name: resident.name,
                        unit: resident.unit,
                        phone: resident.phone,
                        count: resident.count,
                        area: resident.area,
                        amount: shareAmount,
                        method: method,
                        billType: billType
                    });
                });
                
                return shares;
            }
            
            function formatEnglishNumber(num) {
                if (num === null || num === undefined) return '0';
                if (typeof num === 'string') {
                    num = parseEnglishNumber(num);
                }
                return num.toLocaleString('en-US');
            }
            
            function parseEnglishNumber(str) {
                if (!str) return 0;
                const cleanStr = String(str).replace(/,/g, '').replace(/\s/g, '');
                const num = parseFloat(cleanStr);
                return isNaN(num) ? 0 : num;
            }
            
            function saveToStorage(key, data) {
                try {
                    localStorage.setItem(key, JSON.stringify(data));
                } catch (e) {
                    console.error('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ:', e);
                }
            }
            
            function loadFromStorage(key) {
                try {
                    const data = localStorage.getItem(key);
                    return data ? JSON.parse(data) : null;
                } catch (e) {
                    console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ:', e);
                    return null;
                }
            }

            // ==================== Ø³ÛŒØ³ØªÙ… Ø¢Ø±Ø´ÛŒÙˆ ====================
            function saveToArchive(billType, period, total, method, shares, extraData = null) {
                try {
                    console.log('ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ø¢Ø±Ø´ÛŒÙˆ:', billType, period, total);
                    
                    let archive = loadFromStorage('archive') || [];
                    
                    archive = archive.filter(record => 
                        !(record.billType === billType && record.period === period)
                    );
                    
                    const archiveRecord = {
                        id: Date.now(),
                        billType: billType,
                        period: period,
                        total: total,
                        method: method,
                        shares: shares,
                        createdAt: new Date().toISOString()
                    };
                    
                    if (extraData) {
                        if (billType === 'misc' || billType === 'elevator' || billType === 'cleaning') {
                            archiveRecord.description = extraData;
                        } else if (['water', 'electricity', 'gas'].includes(billType)) {
                            archiveRecord.billId = extraData;
                        }
                    }
                    
                    archive.push(archiveRecord);
                    saveToStorage('archive', archive);
                    console.log('âœ… Ø¢Ø±Ø´ÛŒÙˆ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯. ØªØ¹Ø¯Ø§Ø¯ Ø±Ú©ÙˆØ±Ø¯Ù‡Ø§:', archive.length);
                } catch (error) {
                    console.error('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ø¢Ø±Ø´ÛŒÙˆ:', error);
                }
            }
            
            function getBillTypeName(billType) {
                const names = {
                    'water': 'Ø¢Ø¨',
                    'electricity': 'Ø¨Ø±Ù‚',
                    'gas': 'Ú¯Ø§Ø²',
                    'elevator': 'Ø¢Ø³Ø§Ù†Ø³ÙˆØ±',
                    'cleaning': 'Ù†Ø¸Ø§ÙØª',
                    'misc': 'Ù…ØªÙØ±Ù‚Ù‡'
                };
                return names[billType] || billType;
            }
            
            function getMethodName(method) {
                const methods = {
                    'per_resident': 'Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÙØ±Ø§Øª',
                    'per_unit': 'Ø¨Ø± Ø§Ø³Ø§Ø³ ÙˆØ§Ø­Ø¯Ù‡Ø§',
                    'per_area': 'Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…ØªØ±Ø§Ú˜'
                };
                return methods[method] || method;
            }

            // ==================== ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³ÛŒØ³ØªÙ… ====================
            const settingsModal = document.getElementById('settingsModal');
            const settingsBtn = document.getElementById('settingsBtn');
            const closeSettingsBtn = document.getElementById('closeSettingsBtn');
            
            const settingsPages = {
                main: 'settingsMainPage',
                manager: 'managerSettingsForm',
                data: 'dataSettingsForm',
                sms: 'smsSettingsForm',
                defaults: 'defaultSettingsForm',
                archive: 'archivePage',
                payments: 'paymentsSettingsForm',
                about: 'aboutSettingsForm'
            };
            
            let currentSettingsPage = 'main';
            
            settingsBtn.addEventListener('click', function() {
                settingsModal.style.display = 'flex';
                showSettingsPage('main');
            });
            
            closeSettingsBtn.addEventListener('click', function() {
                settingsModal.style.display = 'none';
            });
            
            settingsModal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.style.display = 'none';
                }
            });
            
            function showSettingsPage(pageName) {
                Object.values(settingsPages).forEach(pageId => {
                    const page = document.getElementById(pageId);
                    if (page) page.style.display = 'none';
                });
                
                const targetPage = document.getElementById(settingsPages[pageName]);
                if (targetPage) {
                    targetPage.style.display = 'block';
                    currentSettingsPage = pageName;
                    
                    const settingsContent = document.querySelector('.settings-content');
                    if (settingsContent) {
                        settingsContent.scrollTop = 0;
                    }
                    
                    if (pageName === 'archive') {
                        setTimeout(() => {
                            updateArchiveList();
                        }, 100);
                    }
                    
                    if (pageName === 'payments') {
                        updatePaymentsStats();
                    }
                }
            }
            
            document.getElementById('managerSettingsCard').addEventListener('click', function() {
                loadManagerSettings();
                showSettingsPage('manager');
            });
            
            document.getElementById('archiveSettingsCard').addEventListener('click', function() {
                showSettingsPage('archive');
            });
            
            document.getElementById('dataSettingsCard').addEventListener('click', function() {
                showSettingsPage('data');
            });
            
            document.getElementById('smsSettingsCard').addEventListener('click', function() {
                loadSmsSettings();
                showSettingsPage('sms');
            });
            
            document.getElementById('defaultSettingsCard').addEventListener('click', function() {
                loadDefaultSettings();
                showSettingsPage('defaults');
            });
            
            document.getElementById('paymentsSettingsCard').addEventListener('click', function() {
                showSettingsPage('payments');
            });
            
            document.getElementById('aboutSettingsCard').addEventListener('click', function() {
                showSettingsPage('about');
            });
            
            document.getElementById('backFromManagerBtn').addEventListener('click', function() {
                showSettingsPage('main');
            });
            
            document.getElementById('backFromDataBtn').addEventListener('click', function() {
                showSettingsPage('main');
            });
            
            document.getElementById('backFromSmsBtn').addEventListener('click', function() {
                showSettingsPage('main');
            });
            
            document.getElementById('backFromArchiveBtn').addEventListener('click', function() {
                showSettingsPage('main');
            });
            
            document.getElementById('backFromDefaultBtn').addEventListener('click', function() {
                showSettingsPage('main');
            });
            
            document.getElementById('backFromPaymentsBtn').addEventListener('click', function() {
                showSettingsPage('main');
            });
            
            document.getElementById('backFromAboutBtn').addEventListener('click', function() {
                showSettingsPage('main');
            });

            // ==================== Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø¯ÛŒØ± ====================
            function loadManagerSettings() {
                const managerName = localStorage.getItem('managerName') || '';
                const managerPhone = localStorage.getItem('managerPhone') || '';
                const managerUnit = localStorage.getItem('managerUnit') || '';
                const managerStartDate = localStorage.getItem('managerStartDate') || '';
                
                document.getElementById('managerName').value = managerName;
                document.getElementById('managerPhone').value = managerPhone;
                document.getElementById('managerUnit').value = managerUnit;
                document.getElementById('managerStartDate').value = managerStartDate;
            }
            
            document.getElementById('saveManagerBtn').addEventListener('click', function() {
                const managerName = document.getElementById('managerName').value.trim();
                const managerPhone = document.getElementById('managerPhone').value.trim();
                const managerUnit = document.getElementById('managerUnit').value.trim();
                const managerStartDate = document.getElementById('managerStartDate').value.trim();
                
                localStorage.setItem('managerName', managerName);
                localStorage.setItem('managerPhone', managerPhone);
                localStorage.setItem('managerUnit', managerUnit);
                localStorage.setItem('managerStartDate', managerStartDate);
                
                showNotification('Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø¯ÛŒØ± Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯');
                showSettingsPage('main');
            });
            
            document.getElementById('cancelManagerBtn').addEventListener('click', function() {
                showSettingsPage('main');
            });

            // ==================== Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ ====================
            document.getElementById('dataHelpBtn').addEventListener('click', function() {
                const helpText = `ğŸ“š Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§

ğŸŸ¢ Ø¨Ø®Ø´ Ø®Ø±ÙˆØ¬ÛŒâ€ŒÙ‡Ø§:
â€¢ Ø³Ø§Ú©Ù†ÛŒÙ† (CSV): Ø®Ø±ÙˆØ¬ÛŒ Ù„ÛŒØ³Øª Ø³Ø§Ú©Ù†ÛŒÙ†
â€¢ Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒÙ‡Ø§ (CSV): Ø®Ø±ÙˆØ¬ÛŒ Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒÙ‡Ø§
â€¢ Ù‚Ø¨Ø¶â€ŒÙ‡Ø§ Ùˆ Ø³Ø§Ú©Ù†ÛŒÙ† (JSON): Ø®Ø±ÙˆØ¬ÛŒ Ú©Ø§Ù…Ù„
â€¢ Ù‚Ø¨Ø¶â€ŒÙ‡Ø§ (JSON): ÙÙ‚Ø· Ø¢Ø±Ø´ÛŒÙˆ Ù‚Ø¨ÙˆØ¶

ğŸŸ¡ Ø¨Ø®Ø´ ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§:
â€¢ Ø³Ø§Ú©Ù†ÛŒÙ† (CSV): ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù† Ø³Ø§Ú©Ù†ÛŒÙ† Ø§Ø² ÙØ§ÛŒÙ„
â€¢ Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒÙ‡Ø§ (CSV): ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù† Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒÙ‡Ø§
â€¢ Ù‚Ø¨Ø¶â€ŒÙ‡Ø§ Ùˆ Ø³Ø§Ú©Ù†ÛŒÙ† (JSON): Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ú©Ø§Ù…Ù„
â€¢ Ù‚Ø¨Ø¶â€ŒÙ‡Ø§ (JSON): ÙÙ‚Ø· Ø¢Ø±Ø´ÛŒÙˆ Ù‚Ø¨ÙˆØ¶

ğŸ”µ Ø¨Ø®Ø´ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ:
â€¢ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ú©Ø§Ù…Ù„ (HTML): Ø°Ø®ÛŒØ±Ù‡ ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
â€¢ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ú©Ø§Ù…Ù„ (HTML): Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø§Ø² ÙØ§ÛŒÙ„

âš ï¸ Ø¨Ø®Ø´ Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ:
â€¢ Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§: Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ú©Ø§Ù…Ù„ ØªÙ…Ø§Ù… Ø§Ø·Ù„Ø§Ø¹Ø§Øª

âš ï¸ ØªÙˆØ¬Ù‡: Ù‚Ø¨Ù„ Ø§Ø² ÙˆØ±ÙˆØ¯ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ØŒ Ø§Ø² Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙØ¹Ù„ÛŒ backup Ø¨Ú¯ÛŒØ±ÛŒØ¯.`;

                const modal = document.createElement('div');
                modal.className = 'settings-modal';
                modal.style.display = 'flex';
                modal.innerHTML = `
                    <div class="settings-content" style="max-width: 500px;">
                        <div class="settings-header">
                            <div class="settings-title">Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</div>
                            <button class="close-settings-btn" onclick="this.parentElement.parentElement.parentElement.remove()">Ã—</button>
                        </div>
                        <div style="padding: 20px; white-space: pre-line; line-height: 1.6; font-size: 0.9rem; color: var(--text-color);">
                            ${helpText}
                        </div>
                        <div class="form-actions" style="margin-top: 20px;">
                            <button class="btn btn-primary" onclick="this.parentElement.parentElement.parentElement.remove()" style="width: 100%;">
                                ÙÙ‡Ù…ÛŒØ¯Ù…
                            </button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.remove();
                    }
                });
            });
            
            document.getElementById('resetAllDataBtn').addEventListener('click', function() {
                if (confirm('âš ï¸ Ù‡Ø´Ø¯Ø§Ø± Ø¬Ø¯ÛŒ!\n\nØ¢ÛŒØ§ Ø§Ø² Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ… Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ\n\nØ§ÛŒÙ† Ø¹Ù…Ù„:\nâ€¢ ØªÙ…Ø§Ù… Ø³Ø§Ú©Ù†ÛŒÙ† Ù¾Ø§Ú© Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯\nâ€¢ ØªÙ…Ø§Ù… Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒÙ‡Ø§ Ø­Ø°Ù Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯\nâ€¢ Ø¢Ø±Ø´ÛŒÙˆ Ù‚Ø¨ÙˆØ¶ Ù¾Ø§Ú© Ù…ÛŒâ€ŒØ´ÙˆØ¯\nâ€¢ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ù‡ Ø­Ø§Ù„Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø¯\n\nØ§ÛŒÙ† Ø¹Ù…Ù„ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ø§Ø³Øª!')) {
                    
                    localStorage.clear();
                    
                    residents = [];
                    payments = [];
                    waterShares = [];
                    electricityShares = [];
                    gasShares = [];
                    elevatorShares = [];
                    cleaningShares = [];
                    miscShares = [];
                    
                    localStorage.setItem('appTheme', 'blue');
                    document.documentElement.setAttribute('data-theme', 'blue');
                    
                    themeButtons.forEach(btn => {
                        btn.classList.remove('active');
                        if (btn.dataset.theme === 'blue') {
                            btn.classList.add('active');
                        }
                    });
                    
                    localStorage.setItem('defaultWaterMethod', 'per_resident');
                    localStorage.setItem('defaultElectricityMethod', 'per_unit');
                    localStorage.setItem('defaultGasMethod', 'per_area');
                    localStorage.setItem('defaultElevatorMethod', 'per_unit');
                    localStorage.setItem('defaultCleaningMethod', 'per_unit');
                    localStorage.setItem('defaultMiscMethod', 'per_unit');
                    
                    updateResidentsList();
                    updatePaymentsTable();
                    updateUnitReportFilter();
                    updateWaterList();
                    updateElectricityList();
                    updateGasList();
                    updateElevatorList();
                    updateCleaningList();
                    updateMiscList();
                    
                    document.getElementById('waterMethod').value = 'per_resident';
                    document.getElementById('electricityMethod').value = 'per_unit';
                    document.getElementById('gasMethod').value = 'per_area';
                    document.getElementById('elevatorMethod').value = 'per_unit';
                    document.getElementById('cleaningMethod').value = 'per_unit';
                    document.getElementById('miscMethod').value = 'per_unit';
                    
                    showNotification('ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø´Ø¯Ù†Ø¯');
                    
                    settingsModal.style.display = 'none';
                    
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    document.querySelector('.tab[data-tab="residents"]').classList.add('active');
                    document.getElementById('residents-tab').classList.add('active');
                }
            });
            
            document.getElementById('exportJSONBtn').addEventListener('click', exportJSON);
            document.getElementById('exportCSVBtn').addEventListener('click', exportResidentsCSV);
            document.getElementById('exportArchiveCSVBtn').addEventListener('click', exportArchiveJSON);
            document.getElementById('exportPaymentsCSVBtn').addEventListener('click', exportPaymentsCSV);
            document.getElementById('importCSVBtn').addEventListener('click', importCSV);
            document.getElementById('importJSONBtn').addEventListener('click', importJSON);
            document.getElementById('importPaymentsCSVBtn').addEventListener('click', importPaymentsCSV);
            document.getElementById('importArchiveJSONBtn').addEventListener('click', importArchiveJSON);
            document.getElementById('importBackupBtn').addEventListener('click', importHTMLBackup);
            document.getElementById('createBackupBtn').addEventListener('click', exportHTMLBackup);
            
            async function importPaymentsCSV() {
                try {
                    const input = document.createElement('input');
                    input.type = 'file';
                    input.accept = '.csv';
                    
                    input.onchange = async (e) => {
                        const file = e.target.files[0];
                        if (!file) return;
                        
                        const text = await file.text();
                        const lines = text.split('\n').filter(line => line.trim());
                        
                        if (lines.length < 2) {
                            showNotification('ÙØ§ÛŒÙ„ CSV Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ø³Ø·Ø± Ø¯Ø§Ø¯Ù‡ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯', 'error');
                            return;
                        }
                        
                        const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
                        
                        const newPayments = [];
                        
                        for (let i = 1; i < lines.length; i++) {
                            if (!lines[i].trim()) continue;
                            
                            // Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø®Ø· CSV (Ø­ÙØ¸ Ù…Ù‚Ø§Ø¯ÛŒØ± Ø¯Ø§Ø®Ù„ Ú©ÙˆØªÛŒØ´Ù†)
                            const values = [];
                            let current = '';
                            let inQuotes = false;
                            
                            for (let char of lines[i]) {
                                if (char === '"') {
                                    inQuotes = !inQuotes;
                                } else if (char === ',' && !inQuotes) {
                                    values.push(current.trim().replace(/"/g, ''));
                                    current = '';
                                } else {
                                    current += char;
                                }
                            }
                            values.push(current.trim().replace(/"/g, ''));
                            
                            if (values.length < 5) {
                                console.warn('Ø®Ø· Ù†Ø§Ù‚Øµ:', values);
                                continue;
                            }
                            
                            const payment = {
                                id: Date.now() + i + Math.random(),
                                unitNumber: values[0],
                                residentName: values[1],
                                amount: parseFloat(values[2].replace(/,/g, '')) || 0,
                                period: values[3],
                                paymentDate: values[4],
                                description: values[5] || '',
                                createdAt: new Date().toISOString()
                            };
                            
                            // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
                            if (!payment.unitNumber || !payment.residentName || payment.amount <= 0) {
                                console.warn('Ø¯Ø§Ø¯Ù‡ Ù†Ø§Ù…Ø¹ØªØ¨Ø±:', payment);
                                continue;
                            }
                            
                            newPayments.push(payment);
                        }
                        
                        if (newPayments.length === 0) {
                            showNotification('Ù‡ÛŒÚ† Ø¯Ø§Ø¯Ù‡ Ù…Ø¹ØªØ¨Ø±ÛŒ Ø¯Ø± ÙØ§ÛŒÙ„ CSV ÛŒØ§ÙØª Ù†Ø´Ø¯', 'error');
                            return;
                        }
                        
                        if (confirm(`Ø¢ÛŒØ§ Ø§Ø² ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù† ${newPayments.length} Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ Ø§Ø² ÙØ§ÛŒÙ„ CSV Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ`)) {
                            // Ø¨Ø±Ø±Ø³ÛŒ ØªÚ©Ø±Ø§Ø±ÛŒ Ø¨ÙˆØ¯Ù†
                            const existingPaymentKeys = new Set(payments.map(p => `${p.unitNumber}-${p.period}-${p.amount}`));
                            const uniquePayments = newPayments.filter(p => 
                                !existingPaymentKeys.has(`${p.unitNumber}-${p.period}-${p.amount}`)
                            );
                            
                            if (uniquePayments.length !== newPayments.length) {
                                showNotification(`${newPayments.length - uniquePayments.length} Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ ØªÚ©Ø±Ø§Ø±ÛŒ Ù†Ø§Ø¯ÛŒØ¯Ù‡ Ú¯Ø±ÙØªÙ‡ Ø´Ø¯Ù†Ø¯`, 'warning');
                            }
                            
                            payments = [...payments, ...uniquePayments];
                            saveToStorage('payments', payments);
                            updatePaymentsTable();
                            updatePaymentsStats();
                            
                            showNotification(`${uniquePayments.length} Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ Ø¬Ø¯ÛŒØ¯ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù†Ø¯`);
                        }
                    };
                    
                    input.click();
                } catch (error) {
                    console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ CSV Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒÙ‡Ø§:', error);
                    showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„ CSV Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒÙ‡Ø§', 'error');
                }
            }

            // ==================== ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÛŒØ§Ù…Ú© ====================
            function loadSmsSettings() {
                const smsTemplate = localStorage.getItem('smsTemplate') || `Ø¨Ø§ Ø³Ù„Ø§Ù… Ùˆ Ø§Ø­ØªØ±Ø§Ù…
Ù‚Ø¨Ø¶ {billType} Ø¯ÙˆØ±Ù‡ {period}
Ù…Ø¨Ù„Øº Ú©Ù„: {totalAmount} ØªÙˆÙ…Ø§Ù†
Ø³Ù‡Ù… Ø´Ù…Ø§: {shareAmount} ØªÙˆÙ…Ø§Ù†
Ù„Ø·ÙØ§Ù‹ Ø¨Ø¹Ø¯ Ø§Ø² ÙˆØ§Ø±ÛŒØ² Ø§Ø·Ù„Ø§Ø¹â€ŒØ±Ø³Ø§Ù†ÛŒ ÙØ±Ù…Ø§ÛŒÛŒØ¯`;
                
                document.getElementById('smsTemplate').value = smsTemplate;
            }
            
            document.getElementById('saveSmsBtn').addEventListener('click', function() {
                const smsTemplate = document.getElementById('smsTemplate').value.trim();
                localStorage.setItem('smsTemplate', smsTemplate);
                showNotification('Ù‚Ø§Ù„Ø¨ Ù¾ÛŒØ§Ù…Ú© Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯');
                showSettingsPage('main');
            });
            
            document.getElementById('resetSmsBtn').addEventListener('click', function() {
                const defaultTemplate = `Ø¨Ø§ Ø³Ù„Ø§Ù… Ùˆ Ø§Ø­ØªØ±Ø§Ù…
Ù‚Ø¨Ø¶ {billType} Ø¯ÙˆØ±Ù‡ {period}
Ù…Ø¨Ù„Øº Ú©Ù„: {totalAmount} ØªÙˆÙ…Ø§Ù†
Ø³Ù‡Ù… Ø´Ù…Ø§: {shareAmount} ØªÙˆÙ…Ø§Ù†
Ù„Ø·ÙØ§Ù‹ Ø¨Ø¹Ø¯ Ø§Ø² ÙˆØ§Ø±ÛŒØ² Ø§Ø·Ù„Ø§Ø¹â€ŒØ±Ø³Ø§Ù†ÛŒ ÙØ±Ù…Ø§ÛŒÛŒØ¯`;
                
                document.getElementById('smsTemplate').value = defaultTemplate;
            });

         // ==================== ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶ ====================
function loadDefaultSettings() {
    const defaultWaterMethod = localStorage.getItem('defaultWaterMethod') || 'per_resident';
    const defaultElectricityMethod = localStorage.getItem('defaultElectricityMethod') || 'per_unit';
    const defaultGasMethod = localStorage.getItem('defaultGasMethod') || 'per_area';
    const defaultElevatorMethod = localStorage.getItem('defaultElevatorMethod') || 'per_unit';
    const defaultCleaningMethod = localStorage.getItem('defaultCleaningMethod') || 'per_unit';
    const defaultMiscMethod = localStorage.getItem('defaultMiscMethod') || 'per_unit';
    
    // Ø§Ø¹Ù…Ø§Ù„ Ø¨Ù‡ Ø³Ù„Ú©ØªÙˆØ±Ù‡Ø§ÛŒ ØµÙØ­Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
    document.getElementById('defaultWaterMethod').value = defaultWaterMethod;
    document.getElementById('defaultElectricityMethod').value = defaultElectricityMethod;
    document.getElementById('defaultGasMethod').value = defaultGasMethod;
    document.getElementById('defaultElevatorMethod').value = defaultElevatorMethod;
    document.getElementById('defaultCleaningMethod').value = defaultCleaningMethod;
    document.getElementById('defaultMiscMethod').value = defaultMiscMethod;
    
    // âœ… Ø§Ø¹Ù…Ø§Ù„ Ø¨Ù‡ Ø³Ù„Ú©ØªÙˆØ±Ù‡Ø§ÛŒ Ø§ØµÙ„ÛŒ ØªØ¨â€ŒÙ‡Ø§
    document.getElementById('waterMethod').value = defaultWaterMethod;
    document.getElementById('electricityMethod').value = defaultElectricityMethod;
    document.getElementById('gasMethod').value = defaultGasMethod;
    document.getElementById('elevatorMethod').value = defaultElevatorMethod;
    document.getElementById('cleaningMethod').value = defaultCleaningMethod;
    document.getElementById('miscMethod').value = defaultMiscMethod;
}

document.getElementById('saveDefaultsBtn').addEventListener('click', function() {
    const defaultWaterMethod = document.getElementById('defaultWaterMethod').value;
    const defaultElectricityMethod = document.getElementById('defaultElectricityMethod').value;
    const defaultGasMethod = document.getElementById('defaultGasMethod').value;
    const defaultElevatorMethod = document.getElementById('defaultElevatorMethod').value;
    const defaultCleaningMethod = document.getElementById('defaultCleaningMethod').value;
    const defaultMiscMethod = document.getElementById('defaultMiscMethod').value;
    
    localStorage.setItem('defaultWaterMethod', defaultWaterMethod);
    localStorage.setItem('defaultElectricityMethod', defaultElectricityMethod);
    localStorage.setItem('defaultGasMethod', defaultGasMethod);
    localStorage.setItem('defaultElevatorMethod', defaultElevatorMethod);
    localStorage.setItem('defaultCleaningMethod', defaultCleaningMethod);
    localStorage.setItem('defaultMiscMethod', defaultMiscMethod);
    
    document.getElementById('waterMethod').value = defaultWaterMethod;
    document.getElementById('electricityMethod').value = defaultElectricityMethod;
    document.getElementById('gasMethod').value = defaultGasMethod;
    document.getElementById('elevatorMethod').value = defaultElevatorMethod;
    document.getElementById('cleaningMethod').value = defaultCleaningMethod;
    document.getElementById('miscMethod').value = defaultMiscMethod;
    
    showNotification('ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯');
    showSettingsPage('main');
});

document.getElementById('resetDefaultsBtn').addEventListener('click', function() {
    document.getElementById('defaultWaterMethod').value = 'per_resident';
    document.getElementById('defaultElectricityMethod').value = 'per_unit';
    document.getElementById('defaultGasMethod').value = 'per_area';
    document.getElementById('defaultElevatorMethod').value = 'per_unit';
    document.getElementById('defaultCleaningMethod').value = 'per_unit';
    document.getElementById('defaultMiscMethod').value = 'per_unit';
});

// ==================== Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒÙ‡Ø§ ====================
            document.getElementById('exportAllPaymentsCSVBtn').addEventListener('click', exportAllPaymentsCSV);
            document.getElementById('exportPaymentsReportPDFBtn').addEventListener('click', function() {
                showNotification('Ø¨Ø±Ø§ÛŒ Ú†Ø§Ù¾ ÛŒØ§ Ø°Ø®ÛŒØ±Ù‡ PDFØŒ Ù¾Ù†Ø¬Ø±Ù‡ Ú†Ø§Ù¾ Ù…Ø±ÙˆØ±Ú¯Ø± Ø¨Ø§Ø² Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯. Ø¯Ø± Ù¾Ù†Ø¬Ø±Ù‡ Ú†Ø§Ù¾ØŒ Ú¯Ø²ÛŒÙ†Ù‡ "Ø°Ø®ÛŒØ±Ù‡ Ø¨Ù‡ PDF" Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.', 'info');
                setTimeout(() => {
                    window.print();
                }, 500);
            });
            
            document.getElementById('clearOldPaymentsBtn').addEventListener('click', clearOldPayments);
            
            function updatePaymentsStats() {
                const totalCount = payments.length;
                const totalAmount = payments.reduce((sum, p) => sum + p.amount, 0);
                const lastPayment = payments.length > 0 ? 
                    payments[payments.length - 1].paymentDate : 
                    '-';
                
                document.getElementById('totalPaymentsCount').textContent = totalCount;
                document.getElementById('totalPaymentsAmount').textContent = formatEnglishNumber(totalAmount) + ' ØªÙˆÙ…Ø§Ù†';
                document.getElementById('lastPaymentDate').textContent = lastPayment;
            }

            // ==================== ÙÛŒÙ„ØªØ±ÛŒÙ†Ú¯ Ø¢Ø±Ø´ÛŒÙˆ ====================
            const toggleFiltersBtn = document.getElementById('toggleFiltersBtn');
            const archiveFiltersPanel = document.getElementById('archiveFiltersPanel');
            const applyFiltersBtn = document.getElementById('applyFiltersBtn');
            const resetFiltersBtn = document.getElementById('resetFiltersBtn');
            
            toggleFiltersBtn.addEventListener('click', function() {
                const isVisible = archiveFiltersPanel.style.display === 'block';
                archiveFiltersPanel.style.display = isVisible ? 'none' : 'block';
            });
            
            document.addEventListener('click', function(e) {
                if (e.target.closest('#billTypeFilters .filter-checkbox')) {
                    const filter = e.target.closest('.filter-checkbox');
                    filter.classList.toggle('active');
                }
                
                if (e.target.closest('.quick-select-btn[data-period]')) {
                    const btn = e.target.closest('.quick-select-btn');
                    const period = btn.dataset.period;
                    setQuickDateRange(period);
                    showNotification(`Ø¨Ø§Ø²Ù‡ Ø²Ù…Ø§Ù†ÛŒ ${btn.textContent} Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯`, 'info');
                }
            });
            
            document.getElementById('selectAllBills').addEventListener('click', function() {
                document.querySelectorAll('#billTypeFilters .filter-checkbox').forEach(filter => {
                    filter.classList.add('active');
                });
                showNotification('Ù‡Ù…Ù‡ Ù†ÙˆØ¹ Ù‚Ø¨ÙˆØ¶ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù†Ø¯', 'info');
            });
            
            document.getElementById('selectNoneBills').addEventListener('click', function() {
                document.querySelectorAll('#billTypeFilters .filter-checkbox').forEach(filter => {
                    filter.classList.remove('active');
                });
                showNotification('Ù‡ÛŒÚ† Ù†ÙˆØ¹ Ù‚Ø¨Ø¶ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯', 'info');
            });
            
            applyFiltersBtn.addEventListener('click', function() {
                updateArchiveList();
                archiveFiltersPanel.style.display = 'none';
                showNotification('ÙÛŒÙ„ØªØ±Ù‡Ø§ Ø§Ø¹Ù…Ø§Ù„ Ø´Ø¯Ù†Ø¯');
            });
            
            resetFiltersBtn.addEventListener('click', function() {
                document.querySelectorAll('#billTypeFilters .filter-checkbox').forEach(filter => {
                    filter.classList.add('active');
                });
                document.getElementById('filterDateFrom').value = '';
                document.getElementById('filterDateTo').value = '';
                updateArchiveList();
                showNotification('Ù‡Ù…Ù‡ ÙÛŒÙ„ØªØ±Ù‡Ø§ Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø´Ø¯Ù†Ø¯', 'info');
            });

            // ==================== ØªÙˆØ§Ø¨Ø¹ ØªØ§Ø±ÛŒØ® ====================
            function setQuickDateRange(period) {
                const now = new Date();
                const fromDate = new Date();
                
                switch(period) {
                    case 'lastMonth':
                        fromDate.setMonth(now.getMonth() - 1);
                        break;
                    case 'last3Months':
                        fromDate.setMonth(now.getMonth() - 3);
                        break;
                    case 'thisYear':
                        fromDate.setMonth(0);
                        fromDate.setDate(1);
                        break;
                }
                
                const persianFrom = gregorianToPersian(fromDate);
                const persianTo = gregorianToPersian(now);
                
                document.getElementById('filterDateFrom').value = persianFrom;
                document.getElementById('filterDateTo').value = persianTo;
                
                // Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù†ØŒ ØªØ§Ø±ÛŒØ® Ø§Ù…Ø±ÙˆØ² Ø±Ø§ Ù‡Ù… Ø¯Ø± Ú©Ù†Ø³ÙˆÙ„ Ù†Ù…Ø§ÛŒØ´ Ø¯Ù‡ÛŒØ¯
                console.log('Ø§Ù…Ø±ÙˆØ²:', gregorianToPersian(now), 'Ø¨Ø§Ø²Ù‡:', persianFrom, 'ØªØ§', persianTo);
            }

            // ==================== ØªÙˆØ§Ø¨Ø¹ ÙÛŒÙ„ØªØ±ÛŒÙ†Ú¯ Ø¢Ø±Ø´ÛŒÙˆ ====================
            function applyArchiveFilters(archive) {
    const selectedBillTypes = Array.from(document.querySelectorAll('#billTypeFilters .filter-checkbox.active'))
        .map(filter => filter.dataset.billType);
    
    let filtered = [...archive];
    
    // 1. ÙÛŒÙ„ØªØ± Ù†ÙˆØ¹ Ù‚Ø¨Ø¶
    if (selectedBillTypes.length > 0) {
        filtered = filtered.filter(record => selectedBillTypes.includes(record.billType));
    }
    
    // 2. ÙÛŒÙ„ØªØ± ØªØ§Ø±ÛŒØ®
    const dateFrom = document.getElementById('filterDateFrom').value.trim();
    const dateTo = document.getElementById('filterDateTo').value.trim();
    
    if (dateFrom || dateTo) {
        const fromNum = dateFrom ? parseInt(dateFrom.replace(/\//g, '')) : 0;
        const toNum = dateTo ? parseInt(dateTo.replace(/\//g, '')) : 99999999;
        
        if (!isNaN(fromNum) && !isNaN(toNum)) {
            filtered = filtered.filter(record => {
                try {
                    const recordDate = new Date(record.createdAt);
                    const recordPersian = gregorianToPersian(recordDate);
                    const recordNum = parseInt(recordPersian.replace(/\//g, ''));
                    return recordNum >= fromNum && recordNum <= toNum;
                } catch {
                    return false;
                }
            });
        }
    }
    
    // 3. Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ
    filtered.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
    
    return filtered;
}

            // ==================== Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù„ÛŒØ³Øª Ø¢Ø±Ø´ÛŒÙˆ ====================
            function updateArchiveList() {
                try {
                    const archive = loadFromStorage('archive') || [];
                    const archiveList = document.getElementById('archiveList');
                    
                    if (archive.length === 0) {
                        archiveList.innerHTML = `
                            <div class="empty-message">
                                Ù‡Ù†ÙˆØ² Ø¯ÙˆØ±Ù‡â€ŒØ§ÛŒ Ø¯Ø± Ø¢Ø±Ø´ÛŒÙˆ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª
                            </div>
                        `;
                        return;
                    }
                    
                    const filteredArchive = applyArchiveFilters(archive);
                    
                    archiveList.innerHTML = '';
                    
                    if (filteredArchive.length === 0) {
                        archiveList.innerHTML = `
                            <div class="empty-message">
                                Ù‡ÛŒÚ† Ø¯ÙˆØ±Ù‡â€ŒØ§ÛŒ Ø¨Ø§ ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ ÛŒØ§ÙØª Ù†Ø´Ø¯
                            </div>
                        `;
                        return;
                    }
                    
                    filteredArchive.forEach(record => {
                        const item = document.createElement('div');
                        item.className = 'content-card';
                        item.style.marginBottom = '8px';
                        item.style.padding = '10px';
                        
                        const persianDate = new Date(record.createdAt).toLocaleDateString('fa-IR');
                        
                        // Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´
                        let additionalInfo = '';
                        
                        if (record.description) {
                            additionalInfo += record.description;
                        }
                        
                        if (record.billId && ['water', 'electricity', 'gas'].includes(record.billType)) {
                            if (additionalInfo) additionalInfo += ' | ';
                            additionalInfo += `Ø´Ù†Ø§Ø³Ù‡: ${record.billId}`;
                        }
                        
                        item.innerHTML = `
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px;">
                                <div style="flex: 1;">
                                    <div style="font-weight: 600; color: var(--secondary-color); font-size: 0.85rem; margin-bottom: 4px;">
                                        ${getBillTypeName(record.billType)} - ${record.period}
                                    </div>
                                    <div style="font-size: 0.75rem; color: var(--text-color); opacity: 0.7;">
                                        ${persianDate} | ${formatEnglishNumber(record.total)} ØªÙˆÙ…Ø§Ù†
                                    </div>
                                    ${additionalInfo ? `
                                    <div style="font-size: 0.7rem; color: var(--text-color); opacity: 0.6; margin-top: 2px; word-break: break-word;">
                                        ${additionalInfo}
                                    </div>
                                    ` : ''}
                                </div>
                            </div>
                            <div style="display: flex; gap: 4px; flex-wrap: wrap;">
                                <button class="action-btn btn-success" onclick="viewArchiveDetails(${record.id})" style="padding: 4px 6px; font-size: 0.7rem; min-height: 24px;">
                                    Ù…Ø´Ø§Ù‡Ø¯Ù‡
                                </button>
                                <button class="action-btn btn-primary" onclick="exportArchiveToCSV(${record.id})" style="padding: 4px 6px; font-size: 0.7rem; min-height: 24px;">
                                    CSV
                                </button>
                                <button class="action-btn btn-warning" onclick="printSingleArchiveRecord(${record.id})" style="padding: 4px 6px; font-size: 0.7rem; min-height: 24px;">
                                    Ú†Ø§Ù¾/PDF
                                </button>
                                <button class="action-btn btn-danger" onclick="deleteArchiveRecord(${record.id})" style="padding: 4px 6px; font-size: 0.7rem; min-height: 24px;">
                                    Ø­Ø°Ù
                                </button>
                            </div>
                        `;
                        
                        archiveList.appendChild(item);
                    });
                } catch (error) {
                    console.error('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¢Ø±Ø´ÛŒÙˆ:', error);
                    archiveList.innerHTML = `
                        <div class="empty-message" style="color: var(--danger-color);">
                            Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¢Ø±Ø´ÛŒÙˆ
                        </div>
                    `;
                }
            }

            // ==================== ØªÙˆØ§Ø¨Ø¹ Ú†Ø§Ù¾ Ø¢Ø±Ø´ÛŒÙˆ ====================
           window.printSingleArchiveRecord = function(recordId) {
    try {
        const archive = loadFromStorage('archive') || [];
        const record = archive.find(r => r.id == recordId);
        
        if (!record) {
            showNotification('Ø±Ú©ÙˆØ±Ø¯ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯', 'error');
            return;
        }
        
        showNotification('Ø¨Ø±Ø§ÛŒ Ú†Ø§Ù¾ ÛŒØ§ Ø°Ø®ÛŒØ±Ù‡ PDF Ø§ÛŒÙ† Ø¯ÙˆØ±Ù‡ØŒ Ù¾Ù†Ø¬Ø±Ù‡ Ú†Ø§Ù¾ Ù…Ø±ÙˆØ±Ú¯Ø± Ø¨Ø§Ø² Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.', 'info');
        
        // Ø§ÛŒØ¬Ø§Ø¯ Ù…ÙˆØ¯Ø§Ù„ Ú†Ø§Ù¾ Ù…Ø®ØµÙˆØµ Ø§ÛŒÙ† Ø±Ú©ÙˆØ±Ø¯
        const modal = document.createElement('div');
        modal.className = 'settings-modal print-optimized';
        modal.style.display = 'flex';
        
        let printHTML = `
            <div class="settings-content">
                <div class="settings-header">
                    <div class="settings-title">${getBillTypeName(record.billType)} - ${record.period}</div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <div class="summary-row">
                        <span>Ø¯ÙˆØ±Ù‡:</span>
                        <span>${record.period}</span>
                    </div>
                    <div class="summary-row">
                        <span>Ù…Ø¨Ù„Øº Ú©Ù„:</span>
                        <span>${formatEnglishNumber(record.total)} ØªÙˆÙ…Ø§Ù†</span>
                    </div>
                    <div class="summary-row">
                        <span>Ø±ÙˆØ´ Ù…Ø­Ø§Ø³Ø¨Ù‡:</span>
                        <span>${getMethodName(record.method)}</span>
                    </div>
        `;
        
        if (record.description) {
            printHTML += `
                <div class="summary-row">
                    <span>ØªÙˆØ¶ÛŒØ­Ø§Øª:</span>
                    <span>${record.description}</span>
                </div>
            `;
        }
        
        if (record.billId) {
            printHTML += `
                <div class="summary-row">
                    <span>Ø´Ù†Ø§Ø³Ù‡ Ù‚Ø¨Ø¶:</span>
                    <span>${record.billId}</span>
                </div>
            `;
        }
        
        printHTML += `
                <div class="summary-row">
                    <span>ØªØ§Ø±ÛŒØ® Ø«Ø¨Øª:</span>
                    <span>${new Date(record.createdAt).toLocaleDateString('fa-IR')}</span>
                </div>
            </div>
        `;
        
        if (record.shares && record.shares.length > 0) {
            printHTML += `
                <div class="category-title">Ø³Ù‡Ù… ÙˆØ§Ø­Ø¯Ù‡Ø§</div>
                <table class="data-table" style="margin-top: 10px;">
                    <thead>
                        <tr>
                            <th>ÙˆØ§Ø­Ø¯</th>
                            <th>Ù†Ø§Ù…</th>
                            <th>${record.billType === 'gas' ? 'Ù…ØªØ±Ø§Ú˜' : 
                                (record.billType === 'elevator' || record.billType === 'cleaning' || record.billType === 'misc') ? 'ÙˆØ§Ø­Ø¯Ù‡Ø§' : 'Ù†ÙØ±Ø§Øª'}</th>
                            <th>Ø³Ù‡Ù…</th>
                            <th>ØªÙˆØ¶ÛŒØ­Ø§Øª</th> <!-- âœ… Ø³ØªÙˆÙ† ØªÙˆØ¶ÛŒØ­Ø§Øª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯ -->
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            record.shares.forEach(share => {
                const value = record.billType === 'gas' ? share.area : 
                            (record.billType === 'elevator' || record.billType === 'cleaning' || record.billType === 'misc') ? 1 : share.count;
                
                printHTML += `
                    <tr>
                        <td>${share.unit}</td>
                        <td>${share.name}</td>
                        <td dir="ltr">${formatEnglishNumber(value)}</td>
                        <td dir="ltr">${formatEnglishNumber(share.amount)}</td>
                        <td>${record.description || '-'}</td> <!-- âœ… ØªÙˆØ¶ÛŒØ­Ø§Øª Ø¯Ø± Ù‡Ø± Ø±Ø¯ÛŒÙ -->
                    </tr>
                `;
            });
            
            printHTML += `
                    </tbody>
                </table>
            `;
        }
        
        printHTML += `
                <div style="margin-top: 30px; text-align: center; color: #666; font-size: 11pt; border-top: 1px solid #ddd; padding-top: 15px;">
                    <div>Ø§ÛŒÙ† Ú¯Ø²Ø§Ø±Ø´ ØªÙˆØ³Ø· Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø± Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø§Ø®ØªÙ…Ø§Ù† ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯Ù‡ Ø§Ø³Øª</div>
                    <div>ØªØ§Ø±ÛŒØ® ØªÙˆÙ„ÛŒØ¯: ${new Date().toLocaleString('fa-IR')}</div>
                </div>
            </div>
        `;
        
        modal.innerHTML = printHTML;
        document.body.appendChild(modal);
        
        setTimeout(() => {
            window.print();
            setTimeout(() => {
                modal.remove();
            }, 500);
        }, 800);
    } catch (error) {
        console.error('Ø®Ø·Ø§ Ø¯Ø± Ú†Ø§Ù¾ Ø±Ú©ÙˆØ±Ø¯:', error);
        showNotification('Ø®Ø·Ø§ Ø¯Ø± Ú†Ø§Ù¾ Ø¯ÙˆØ±Ù‡', 'error');
    }
};

            window.printArchiveSummary = function() {
    try {
        const archive = loadFromStorage('archive') || [];
        
        // âœ… ÙÛŒÙ„ØªØ± Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§Ù†ØªØ®Ø§Ø¨â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±
        const filteredArchive = applyArchiveFilters(archive);
        
        if (filteredArchive.length === 0) {
            showNotification('Ù‡ÛŒÚ† Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ø¨Ø§ ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ ÛŒØ§ÙØª Ù†Ø´Ø¯', 'error');
            return;
        }
        
        showNotification('Ø¨Ø±Ø§ÛŒ Ú†Ø§Ù¾ ÛŒØ§ Ø°Ø®ÛŒØ±Ù‡ PDF Ø®Ù„Ø§ØµÙ‡ Ø¢Ø±Ø´ÛŒÙˆØŒ Ù¾Ù†Ø¬Ø±Ù‡ Ú†Ø§Ù¾ Ù…Ø±ÙˆØ±Ú¯Ø± Ø¨Ø§Ø² Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.', 'info');
        
        const modal = document.createElement('div');
        modal.className = 'settings-modal print-optimized';
        modal.style.display = 'flex';
        modal.innerHTML = `
            <div class="settings-content" style="max-width: 800px;">
                <div class="settings-header">
                    <div class="settings-title">Ø®Ù„Ø§ØµÙ‡ Ø¢Ø±Ø´ÛŒÙˆ Ù‚Ø¨ÙˆØ¶ Ø³Ø§Ø®ØªÙ…Ø§Ù†</div>
                    <button class="close-settings-btn" onclick="this.parentElement.parentElement.parentElement.remove()">Ã—</button>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <div class="summary-row">
                        <span>ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ Ø¯ÙˆØ±Ù‡â€ŒÙ‡Ø§:</span>
                        <span style="font-weight: bold;">${filteredArchive.length} Ø¯ÙˆØ±Ù‡</span>
                    </div>
                    <div class="summary-row">
                        <span>ØªØ§Ø±ÛŒØ® ØªÙˆÙ„ÛŒØ¯ Ú¯Ø²Ø§Ø±Ø´:</span>
                        <span>${new Date().toLocaleString('fa-IR')}</span>
                    </div>
                </div>
                
                <div class="category-title">Ø®Ù„Ø§ØµÙ‡ Ø¯ÙˆØ±Ù‡â€ŒÙ‡Ø§</div>
                <table class="data-table" style="margin-top: 10px;">
                    <thead>
                        <tr>
                            <th>Ø±Ø¯ÛŒÙ</th>
                            <th>Ù†ÙˆØ¹ Ù‚Ø¨Ø¶</th>
                            <th>Ø¯ÙˆØ±Ù‡</th>
                            <th>Ù…Ø¨Ù„Øº Ú©Ù„</th>
                            <th>Ø±ÙˆØ´ Ù…Ø­Ø§Ø³Ø¨Ù‡</th>
                            <th>ØªØ§Ø±ÛŒØ® Ø«Ø¨Øª</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${filteredArchive.map((record, index) => `
                            <tr>
                                <td>${index + 1}</td>
                                <td>${getBillTypeName(record.billType)}</td>
                                <td>${record.period}</td>
                                <td dir="ltr">${formatEnglishNumber(record.total)} ØªÙˆÙ…Ø§Ù†</td>
                                <td>${getMethodName(record.method)}</td>
                                <td>${new Date(record.createdAt).toLocaleDateString('fa-IR')}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
                
                <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #000;">
                    <div class="category-title">Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ</div>
                    <div style="display: flex; flex-wrap: wrap; gap: 20px; margin-top: 15px;">
                        <div style="flex: 1; min-width: 200px;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Ù†ÙˆØ¹ Ù‚Ø¨Ø¶</th>
                                        <th>ØªØ¹Ø¯Ø§Ø¯</th>
                                        <th>Ø¬Ù…Ø¹ Ù…Ø¨Ø§Ù„Øº</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${(() => {
                                        const stats = {};
                                        filteredArchive.forEach(record => {
                                            if (!stats[record.billType]) {
                                                stats[record.billType] = {
                                                    count: 0,
                                                    total: 0
                                                };
                                            }
                                            stats[record.billType].count++;
                                            stats[record.billType].total += record.total;
                                        });
                                        
                                        return Object.entries(stats).map(([type, data]) => `
                                            <tr>
                                                <td>${getBillTypeName(type)}</td>
                                                <td>${data.count}</td>
                                                <td dir="ltr">${formatEnglishNumber(data.total)} ØªÙˆÙ…Ø§Ù†</td>
                                            </tr>
                                        `).join('');
                                    })()}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 30px; text-align: center; color: #666; font-size: 11pt; border-top: 1px solid #ddd; padding-top: 15px;">
                    <div>Ø§ÛŒÙ† Ú¯Ø²Ø§Ø±Ø´ ØªÙˆØ³Ø· Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø± Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø§Ø®ØªÙ…Ø§Ù† ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯Ù‡ Ø§Ø³Øª</div>
                    <div>ØªØ§Ø±ÛŒØ® ØªÙˆÙ„ÛŒØ¯: ${new Date().toLocaleString('fa-IR')}</div>
                </div>
                
                <div class="form-actions" style="margin-top: 30px;">
                    <button class="btn btn-primary" onclick="window.print()" style="width: 100%;">
                        Ú†Ø§Ù¾ / Ø°Ø®ÛŒØ±Ù‡ PDF
                    </button>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        
        modal.addEventListener('click', function(e) {
            if (e.target === this) {
                this.remove();
            }
        });
        
        setTimeout(() => {
            window.print();
        }, 1000);
        
    } catch (error) {
        console.error('Ø®Ø·Ø§ Ø¯Ø± ØªÙˆÙ„ÛŒØ¯ Ø®Ù„Ø§ØµÙ‡ Ø¢Ø±Ø´ÛŒÙˆ:', error);
        showNotification('Ø®Ø·Ø§ Ø¯Ø± ØªÙˆÙ„ÛŒØ¯ Ú¯Ø²Ø§Ø±Ø´ Ø®Ù„Ø§ØµÙ‡ Ø¢Ø±Ø´ÛŒÙˆ', 'error');
    }
};
            
            // ==================== Ú†Ø§Ù¾ Ø¢Ø±Ø´ÛŒÙˆ ====================
            document.getElementById('exportArchivePDFBtn').addEventListener('click', function() {
                printArchiveSummary();
            });
            
            document.getElementById('exportArchiveCSVBtn').addEventListener('click', function() {
                exportArchiveToCSV();
            });

            // ==================== ØªÙˆØ§Ø¨Ø¹ Ú†Ø§Ù¾ ====================
            document.getElementById('exportUnitReportPDFBtn').addEventListener('click', function() {
                showNotification('Ø¨Ø±Ø§ÛŒ Ú†Ø§Ù¾ ÛŒØ§ Ø°Ø®ÛŒØ±Ù‡ PDF Ú¯Ø²Ø§Ø±Ø´ ÙˆØ§Ø­Ø¯ØŒ Ù¾Ù†Ø¬Ø±Ù‡ Ú†Ø§Ù¾ Ù…Ø±ÙˆØ±Ú¯Ø± Ø¨Ø§Ø² Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯. Ø¯Ø± Ù¾Ù†Ø¬Ø±Ù‡ Ú†Ø§Ù¾ØŒ Ú¯Ø²ÛŒÙ†Ù‡ "Ø°Ø®ÛŒØ±Ù‡ Ø¨Ù‡ PDF" Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.', 'info');
                setTimeout(() => {
                    window.print();
                }, 500);
            });

            // ==================== ØªÙˆØ§Ø¨Ø¹ Import/Export ====================
            function exportJSON() {
                try {
                    const backupData = {
                        version: "6.0",
                        exportDate: new Date().toISOString(),
                        residents: residents,
                        payments: payments,
                        archive: loadFromStorage('archive') || [],
                        settings: {
                            managerName: localStorage.getItem('managerName') || '',
                            managerPhone: localStorage.getItem('managerPhone') || '',
                            managerUnit: localStorage.getItem('managerUnit') || '',
                            managerStartDate: localStorage.getItem('managerStartDate') || '',
                            smsTemplate: localStorage.getItem('smsTemplate') || ''
                        },
                        defaultMethods: {
                            water: localStorage.getItem('defaultWaterMethod') || 'per_resident',
                            electricity: localStorage.getItem('defaultElectricityMethod') || 'per_unit',
                            gas: localStorage.getItem('defaultGasMethod') || 'per_area',
                            elevator: localStorage.getItem('defaultElevatorMethod') || 'per_unit',
                            cleaning: localStorage.getItem('defaultCleaningMethod') || 'per_unit',
                            misc: localStorage.getItem('defaultMiscMethod') || 'per_unit'
                        },
                        theme: localStorage.getItem('appTheme') || 'blue'
                    };
                    
                    const jsonStr = JSON.stringify(backupData, null, 2);
                    const blob = new Blob([jsonStr], { type: 'application/json;charset=utf-8' });
                    const url = URL.createObjectURL(blob);
                    
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `Ù‚Ø¨Ø¶â€ŒÙ‡Ø§_${new Date().toLocaleDateString('fa-IR').replace(/\//g, '-')}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    showNotification('Ø®Ø±ÙˆØ¬ÛŒ JSON Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯');
                } catch (error) {
                    console.error('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ JSON:', error);
                    showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ ÙØ§ÛŒÙ„ JSON', 'error');
                }
            }
            
            async function importJSON() {
                try {
                    const input = document.createElement('input');
                    input.type = 'file';
                    input.accept = '.json';
                    
                    input.onchange = async (e) => {
                        const file = e.target.files[0];
                        if (!file) return;
                        
                        const text = await file.text();
                        const backupData = JSON.parse(text);
                        
                        if (!backupData.version || !backupData.residents) {
                            throw new Error('ÙØ±Ù…Øª ÙØ§ÛŒÙ„ JSON Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª');
                        }
                        
                        if (confirm('Ø¢ÛŒØ§ Ø§Ø² Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.')) {
                            if (backupData.residents && Array.isArray(backupData.residents)) {
                                saveToStorage('residents', backupData.residents);
                                residents = backupData.residents;
                            }
                            
                            if (backupData.payments && Array.isArray(backupData.payments)) {
                                saveToStorage('payments', backupData.payments);
                                payments = backupData.payments;
                            }
                            
                            if (backupData.archive && Array.isArray(backupData.archive)) {
                                saveToStorage('archive', backupData.archive);
                            }
                            
                            if (backupData.settings) {
                                const { settings } = backupData;
                                if (settings.managerName) localStorage.setItem('managerName', settings.managerName);
                                if (settings.managerPhone) localStorage.setItem('managerPhone', settings.managerPhone);
                                if (settings.managerUnit) localStorage.setItem('managerUnit', settings.managerUnit);
                                if (settings.managerStartDate) localStorage.setItem('managerStartDate', settings.managerStartDate);
                                if (settings.smsTemplate) localStorage.setItem('smsTemplate', settings.smsTemplate);
                            }
                            
                            if (backupData.defaultMethods) {
                                const { defaultMethods } = backupData;
                                Object.keys(defaultMethods).forEach(key => {
                                    localStorage.setItem(`default${key.charAt(0).toUpperCase() + key.slice(1)}Method`, defaultMethods[key]);
                                });
                            }
                            
                            if (!localStorage.getItem('defaultMiscMethod')) {
                                localStorage.setItem('defaultMiscMethod', 'per_unit');
                            }
                            
                            if (backupData.theme) {
                                document.documentElement.setAttribute('data-theme', backupData.theme);
                                localStorage.setItem('appTheme', backupData.theme);
                                themeButtons.forEach(btn => {
                                    btn.classList.remove('active');
                                    if (btn.dataset.theme === backupData.theme) {
                                        btn.classList.add('active');
                                    }
                                });
                            }
                            
                            updateResidentsList();
                            updateUnitReportFilter();
                            updatePaymentsTable();
                            updateWaterList();
                            updateElectricityList();
                            updateGasList();
                            updateElevatorList();
                            updateCleaningList();
                            updateMiscList();
                            
                            showNotification('Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯Ù†Ø¯');
                        }
                    };
                    
                    input.click();
                } catch (error) {
                    console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ JSON:', error);
                    showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„ JSON', 'error');
                }
            }
            
            function exportResidentsCSV() {
                try {
                    if (!residents || residents.length === 0) {
                        showNotification('Ù‡ÛŒÚ† Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯', 'error');
                        return;
                    }
                    
                    let csvContent = "Ø´Ù…Ø§Ø±Ù‡ ÙˆØ§Ø­Ø¯,Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ,Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ†,ØªØ¹Ø¯Ø§Ø¯ Ø³Ø§Ú©Ù†ÛŒÙ†,Ù…ØªØ±Ø§Ú˜ (Ù…ØªØ± Ù…Ø±Ø¨Ø¹)\n";
                    
                    residents.forEach(resident => {
                        const row = [
                            `"${resident.unit}"`,
                            `"${resident.name}"`,
                            `"${resident.phone}"`,
                            resident.count,
                            resident.area
                        ].join(',');
                        csvContent += row + '\n';
                    });
                    
                    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                    const url = URL.createObjectURL(blob);
                    
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `Ø³Ø§Ú©Ù†ÛŒÙ†_${new Date().toLocaleDateString('fa-IR').replace(/\//g, '-')}.csv`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    showNotification('ÙØ§ÛŒÙ„ CSV Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯');
                } catch (error) {
                    console.error('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ CSV:', error);
                    showNotification('Ø®Ø·Ø§ Ø¯Ø± ØªÙˆÙ„ÛŒØ¯ ÙØ§ÛŒÙ„ CSV', 'error');
                }
            }
            
            function exportArchiveJSON() {
                try {
                    const archive = loadFromStorage('archive') || [];
                    
                    if (archive.length === 0) {
                        showNotification('Ù‡ÛŒÚ† Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ø¯Ø± Ø¢Ø±Ø´ÛŒÙˆ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯', 'error');
                        return;
                    }
                    
                    const jsonStr = JSON.stringify(archive, null, 2);
                    const blob = new Blob([jsonStr], { type: 'application/json;charset=utf-8' });
                    const url = URL.createObjectURL(blob);
                    
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `Ø¢Ø±Ø´ÛŒÙˆ_${new Date().toLocaleDateString('fa-IR').replace(/\//g, '-')}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    showNotification(`ÙØ§ÛŒÙ„ JSON Ø¨Ø§ ${archive.length} Ø±Ú©ÙˆØ±Ø¯ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯`);
                } catch (error) {
                    console.error('Ø®Ø·Ø§ Ø¯Ø± Ø®Ø±ÙˆØ¬ÛŒ JSON Ø¢Ø±Ø´ÛŒÙˆ:', error);
                    showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„ JSON', 'error');
                }
            }
            
            async function importArchiveJSON() {
                try {
                    const input = document.createElement('input');
                    input.type = 'file';
                    input.accept = '.json';
                    
                    input.onchange = async (e) => {
                        const file = e.target.files[0];
                        if (!file) return;
                        
                        const text = await file.text();
                        const archiveData = JSON.parse(text);
                        
                        if (!Array.isArray(archiveData)) {
                            throw new Error('ÙØ±Ù…Øª ÙØ§ÛŒÙ„ JSON Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª');
                        }
                        
                        if (confirm(`Ø¢ÛŒØ§ Ø§Ø² ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù† ${archiveData.length} Ø±Ú©ÙˆØ±Ø¯ Ø¢Ø±Ø´ÛŒÙˆ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ`)) {
                            const existingArchive = loadFromStorage('archive') || [];
                            const combinedArchive = [...existingArchive, ...archiveData];
                            
                            const uniqueArchive = [];
                            const seenIds = new Set();
                            
                            combinedArchive.forEach(record => {
                                if (!seenIds.has(record.id)) {
                                    seenIds.add(record.id);
                                    uniqueArchive.push(record);
                                }
                            });
                            
                            saveToStorage('archive', uniqueArchive);
                            updateArchiveList();
                            
                            showNotification(`${uniqueArchive.length} Ø±Ú©ÙˆØ±Ø¯ Ø¢Ø±Ø´ÛŒÙˆ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù†Ø¯`);
                        }
                    };
                    
                    input.click();
                } catch (error) {
                    console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ JSON Ø¢Ø±Ø´ÛŒÙˆ:', error);
                    showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„ JSON Ø¢Ø±Ø´ÛŒÙˆ', 'error');
                }
            }
            
            function exportPaymentsCSV() {
                try {
                    if (payments.length === 0) {
                        showNotification('Ù‡ÛŒÚ† Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯', 'error');
                        return;
                    }
                    
                    let csvContent = "Ø´Ù…Ø§Ø±Ù‡ ÙˆØ§Ø­Ø¯,Ù†Ø§Ù…,Ù…Ø¨Ù„Øº,Ø¯ÙˆØ±Ù‡,ØªØ§Ø±ÛŒØ® Ù¾Ø±Ø¯Ø§Ø®Øª,ØªÙˆØ¶ÛŒØ­Ø§Øª\n";
                    
                    payments.forEach(payment => {
                        const row = [
                            `"${payment.unitNumber}"`,
                            `"${payment.residentName}"`,
                            payment.amount,
                            `"${payment.period}"`,
                            `"${payment.paymentDate}"`,
                            `"${payment.description || ''}"`
                        ].join(',');
                        csvContent += row + '\n';
                    });
                    
                    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                    const url = URL.createObjectURL(blob);
                    
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒÙ‡Ø§_${new Date().toLocaleDateString('fa-IR').replace(/\//g, '-')}.csv`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    showNotification('ÙØ§ÛŒÙ„ CSV Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒÙ‡Ø§ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯');
                } catch (error) {
                    console.error('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ CSV Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒÙ‡Ø§:', error);
                    showNotification('Ø®Ø·Ø§ Ø¯Ø± ØªÙˆÙ„ÛŒØ¯ ÙØ§ÛŒÙ„ CSV', 'error');
                }
            }
            
            function exportAllPaymentsCSV() {
                exportPaymentsCSV();
            }
            
            function exportArchiveToCSV(recordId = null) {
                try {
                    if (recordId) {
                        const archive = loadFromStorage('archive') || [];
                        const record = archive.find(r => r.id === recordId);
                        
                        if (!record || !record.shares) {
                            showNotification('Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯ÙˆØ±Ù‡ ÛŒØ§ÙØª Ù†Ø´Ø¯', 'error');
                            return;
                        }
                        
                        let csvContent = `Ø¯ÙˆØ±Ù‡,${record.period}\n`;
                        csvContent += `Ù†ÙˆØ¹ Ù‚Ø¨Ø¶,${getBillTypeName(record.billType)}\n`;
                        csvContent += `Ù…Ø¨Ù„Øº Ú©Ù„,${record.total}\n`;
                        csvContent += `Ø±ÙˆØ´ Ù…Ø­Ø§Ø³Ø¨Ù‡,${getMethodName(record.method)}\n`;
                        
                        if (record.description) {
                            csvContent += `ØªÙˆØ¶ÛŒØ­Ø§Øª,${record.description}\n`;
                        } else if (record.billId) {
                            csvContent += `Ø´Ù†Ø§Ø³Ù‡ Ù‚Ø¨Ø¶,${record.billId}\n`;
                        }
                        
                        csvContent += `\n`;
                        
                        if (record.billType === 'gas') {
                            csvContent += "ÙˆØ§Ø­Ø¯,Ù†Ø§Ù…,Ù…ØªØ±Ø§Ú˜,Ø³Ù‡Ù…\n";
                            record.shares.forEach(share => {
                                csvContent += `${share.unit},${share.name},${share.area},${share.amount}\n`;
                            });
                        } else if (record.billType === 'elevator' || record.billType === 'cleaning' || record.billType === 'misc') {
                            csvContent += "ÙˆØ§Ø­Ø¯,Ù†Ø§Ù…,ÙˆØ§Ø­Ø¯Ù‡Ø§,Ø³Ù‡Ù…\n";
                            record.shares.forEach(share => {
                                csvContent += `${share.unit},${share.name},1,${share.amount}\n`;
                            });
                        } else {
                            csvContent += "ÙˆØ§Ø­Ø¯,Ù†Ø§Ù…,Ù†ÙØ±Ø§Øª,Ø³Ù‡Ù…\n";
                            record.shares.forEach(share => {
                                csvContent += `${share.unit},${share.name},${share.count},${share.amount}\n`;
                            });
                        }
                        
                        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                        const url = URL.createObjectURL(blob);
                        
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `Ø¢Ø±Ø´ÛŒÙˆ_${record.billType}_${record.period.replace(/\//g, '-')}.csv`;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                        
                        showNotification('ÙØ§ÛŒÙ„ CSV Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯');
                        return;
                    }
                    
                    const archive = loadFromStorage('archive') || [];
                    
                    if (archive.length === 0) {
                        showNotification('Ù‡ÛŒÚ† Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ø¯Ø± Ø¢Ø±Ø´ÛŒÙˆ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯', 'error');
                        return;
                    }
                    
                    let csvContent = "Ù†ÙˆØ¹ Ù‚Ø¨Ø¶,Ø¯ÙˆØ±Ù‡,Ù…Ø¨Ù„Øº Ú©Ù„,Ø±ÙˆØ´ Ù…Ø­Ø§Ø³Ø¨Ù‡,ØªØ§Ø±ÛŒØ® Ø«Ø¨Øª,ØªØ¹Ø¯Ø§Ø¯ ÙˆØ§Ø­Ø¯Ù‡Ø§\n";
                    
                    archive.forEach(record => {
                        csvContent += `"${getBillTypeName(record.billType)}","${record.period}",${record.total},"${getMethodName(record.method)}","${new Date(record.createdAt).toLocaleDateString('fa-IR')}",${record.shares ? record.shares.length : 0}\n`;
                    });
                    
                    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                    const url = URL.createObjectURL(blob);
                    
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `Ø¢Ø±Ø´ÛŒÙˆ_Ù‚Ø¨ÙˆØ¶_${new Date().toLocaleDateString('fa-IR').replace(/\//g, '-')}.csv`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    showNotification(`ÙØ§ÛŒÙ„ CSV Ø¨Ø§ ${archive.length} Ø±Ú©ÙˆØ±Ø¯ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯`);
                } catch (error) {
                    console.error('Ø®Ø·Ø§ Ø¯Ø± Ø®Ø±ÙˆØ¬ÛŒ CSV Ø¢Ø±Ø´ÛŒÙˆ:', error);
                    showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„ CSV', 'error');
                }
            }
            
            async function importCSV() {
                try {
                    const input = document.createElement('input');
                    input.type = 'file';
                    input.accept = '.csv';
                    
                    input.onchange = async (e) => {
                        const file = e.target.files[0];
                        if (!file) return;
                        
                        const text = await file.text();
                        const lines = text.split('\n').filter(line => line.trim());
                        
                        if (lines.length < 2) {
                            showNotification('ÙØ§ÛŒÙ„ CSV Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ø³Ø·Ø± Ø¯Ø§Ø¯Ù‡ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯', 'error');
                            return;
                        }
                        
                        const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
                        
                        const expectedHeaders = ['Ø´Ù…Ø§Ø±Ù‡ ÙˆØ§Ø­Ø¯', 'Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ', 'Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ†', 'ØªØ¹Ø¯Ø§Ø¯ Ø³Ø§Ú©Ù†ÛŒÙ†', 'Ù…ØªØ±Ø§Ú˜ (Ù…ØªØ± Ù…Ø±Ø¨Ø¹)'];
                        const hasValidHeaders = expectedHeaders.every(header => 
                            headers.some(h => h.includes(header))
                        );
                        
                        if (!hasValidHeaders) {
                            showNotification('ÙØ±Ù…Øª ÙØ§ÛŒÙ„ CSV Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª', 'error');
                            return;
                        }
                        
                        const newResidents = [];
                        
                        for (let i = 1; i < lines.length; i++) {
                            if (!lines[i].trim()) continue;
                            
                            const values = lines[i].split(',').map(v => v.replace(/"/g, '').trim());
                            
                            if (values.length < 5) continue;
                            
                            const resident = {
                                id: Date.now() + i,
                                unit: values[0],
                                name: values[1],
                                phone: values[2],
                                count: parseInt(values[3]) || 1,
                                area: parseFloat(values[4]) || 0
                            };
                            
                            newResidents.push(resident);
                        }
                        
                        if (newResidents.length === 0) {
                            showNotification('Ù‡ÛŒÚ† Ø¯Ø§Ø¯Ù‡ Ù…Ø¹ØªØ¨Ø±ÛŒ Ø¯Ø± ÙØ§ÛŒÙ„ CSV ÛŒØ§ÙØª Ù†Ø´Ø¯', 'error');
                            return;
                        }
                        
                        if (confirm(`Ø¢ÛŒØ§ Ø§Ø² ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù† ${newResidents.length} Ø³Ø§Ú©Ù† Ø§Ø² ÙØ§ÛŒÙ„ CSV Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ`)) {
                            const existingUnits = residents.map(r => r.unit);
                            const uniqueResidents = newResidents.filter(r => !existingUnits.includes(r.unit));
                            
                            if (uniqueResidents.length !== newResidents.length) {
                                showNotification(`${newResidents.length - uniqueResidents.length} Ø³Ø§Ú©Ù† ØªÚ©Ø±Ø§Ø±ÛŒ Ù†Ø§Ø¯ÛŒØ¯Ù‡ Ú¯Ø±ÙØªÙ‡ Ø´Ø¯Ù†Ø¯`, 'warning');
                            }
                            
                            residents = [...residents, ...uniqueResidents];
                            saveToStorage('residents', residents);
                            updateResidentsList();
                            updateUnitReportFilter();
                            
                            showNotification(`${uniqueResidents.length} Ø³Ø§Ú©Ù† Ø¬Ø¯ÛŒØ¯ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù†Ø¯`);
                        }
                    };
                    
                    input.click();
                } catch (error) {
                    console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ CSV:', error);
                    showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„ CSV', 'error');
                }
            }
            
            function exportHTMLBackup() {
                try {
                    const allData = {
                        localStorage: {},
                        residents: residents,
                        payments: payments,
                        archive: loadFromStorage('archive') || [],
                        timestamp: new Date().toISOString(),
                        version: "6.0"
                    };
                    
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i);
                        allData.localStorage[key] = localStorage.getItem(key);
                    }
                    
                    const jsonData = JSON.stringify(allData, null, 2);
                    
                    const htmlContent = `<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø± Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø§Ø®ØªÙ…Ø§Ù†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Tahoma, sans-serif;
        }
        
        body {
            background: #f5f7fa;
            color: #333;
            direction: rtl;
            padding: 10px;
            min-height: 100vh;
            line-height: 1.5;
        }
        
        .backup-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            padding: 0;
        }
        
        .backup-header {
            background: linear-gradient(135deg, #64b5f6 0%, #1976d2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .backup-header h1 {
            font-size: 20px;
            margin-bottom: 8px;
            font-weight: bold;
        }
        
        .backup-header .subtitle {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 15px;
        }
        
        .backup-icon {
            font-size: 40px;
            margin-bottom: 15px;
        }
        
        .backup-info {
            padding: 15px;
            background: #f8f9fa;
            margin: 15px;
            border-radius: 10px;
            border-right: 4px solid #64b5f6;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .info-item {
            background: white;
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            text-align: center;
        }
        
        .info-label {
            font-size: 11px;
            color: #666;
            margin-bottom: 4px;
        }
        
        .info-value {
            font-size: 16px;
            font-weight: bold;
            color: #1976d2;
        }
        
        .backup-data {
            padding: 15px;
        }
        
        .data-section {
            margin-bottom: 15px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
        }
        
        .section-title {
            color: #1976d2;
            font-size: 16px;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 2px solid #64b5f6;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .section-icon {
            font-size: 20px;
        }
        
        .backup-footer {
            background: #f8f9fa;
            padding: 15px;
            text-align: center;
            border-top: 1px solid #ddd;
            font-size: 12px;
            color: #666;
        }
        
        .warning-box {
            background: linear-gradient(135deg, #fff3cd 0%, #ffecb5 100%);
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 15px;
            margin: 15px;
            text-align: center;
        }
        
        .warning-icon {
            font-size: 30px;
            color: #ff9800;
            margin-bottom: 10px;
        }
        
        .warning-title {
            color: #d32f2f;
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .warning-text {
            color: #5d4037;
            line-height: 1.5;
            font-size: 13px;
        }
        
        .accordion {
            margin-top: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .accordion-header {
            background: #f8f9fa;
            padding: 12px 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            color: #1976d2;
            border-bottom: 1px solid #ddd;
        }
        
        .accordion-content {
            padding: 0;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            background: white;
        }
        
        .accordion-content.open {
            max-height: 300px;
            padding: 15px;
            overflow-y: auto;
        }
        
        pre {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 6px;
            overflow: auto;
            font-size: 11px;
            line-height: 1.4;
            max-height: 250px;
            margin: 0;
        }
        
        .restore-btn {
            background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            margin: 15px auto;
            display: block;
            width: 90%;
            max-width: 300px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .restore-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(76, 175, 80, 0.3);
        }
        
        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .backup-container {
                box-shadow: none;
                border: 1px solid #ddd;
            }
            
            .restore-btn {
                display: none;
            }
        }
        
    </style>
</head>
<body>
    <div class="backup-container">
        <div class="backup-header">
            <div class="backup-icon">ğŸ’¾</div>
            <h1>Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø± Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø§Ø®ØªÙ…Ø§Ù†</h1>
            <div class="subtitle">Ù†Ø³Ø®Ù‡ ${allData.version} - ØªØ§Ø±ÛŒØ® Ø§ÛŒØ¬Ø§Ø¯: ${new Date().toLocaleString('fa-IR')}</div>
        </div>
        
        <div class="backup-info">
            <div style="text-align: center; margin-bottom: 15px;">
                <div style="font-size: 13px; color: #666; margin-bottom: 4px;">Ø®Ù„Ø§ØµÙ‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡</div>
                <div style="font-size: 16px; color: #1976d2; font-weight: bold;">ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ… Ø¯Ø± Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯</div>
            </div>
            
            <div class="info-grid">
                <div class="info-item">
                    <div class="info-label">ØªØ¹Ø¯Ø§Ø¯ Ø³Ø§Ú©Ù†ÛŒÙ†</div>
                    <div class="info-value">${allData.residents.length} Ù†ÙØ±</div>
                </div>
                
                <div class="info-item">
                    <div class="info-label">ØªØ¹Ø¯Ø§Ø¯ ÙˆØ§Ø­Ø¯Ù‡Ø§</div>
                    <div class="info-value">${allData.residents.length} ÙˆØ§Ø­Ø¯</div>
                </div>
                
                <div class="info-item">
                    <div class="info-label">ØªØ¹Ø¯Ø§Ø¯ Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒÙ‡Ø§</div>
                    <div class="info-value">${allData.payments.length} Ù…ÙˆØ±Ø¯</div>
                </div>
                
                <div class="info-item">
                    <div class="info-label">Ø¯ÙˆØ±Ù‡â€ŒÙ‡Ø§ÛŒ Ø¢Ø±Ø´ÛŒÙˆ</div>
                    <div class="info-value">${allData.archive.length} Ø¯ÙˆØ±Ù‡</div>
                </div>
            </div>
        </div>
        
        <div class="warning-box">
            <div class="warning-icon">âš ï¸</div>
            <div class="warning-title">ØªÙˆØ¬Ù‡ Ù…Ù‡Ù…</div>
            <div class="warning-text">
                Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ø­Ø§ÙˆÛŒ ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø§Ø®ØªÙ…Ø§Ù† Ø´Ù…Ø§Ø³Øª.<br>
                Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒØŒ Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ø±Ø§ Ø¯Ø± Ù‚Ø³Ù…Øª "ØªÙ†Ø¸ÛŒÙ…Ø§Øª â†’ Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ â†’ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ú©Ø§Ù…Ù„ (HTML)" Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ù†ÛŒØ¯.<br>
                <strong>ØªÙˆØµÛŒÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ø±Ø§ Ø¯Ø± Ù…Ú©Ø§Ù† Ø§Ù…Ù†ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ù†Ù…Ø§ÛŒÛŒØ¯.</strong>
            </div>
            
            <button class="restore-btn" id="restoreInstructionsBtn">
                ğŸ“‹ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¯Ø³ØªÙˆØ±Ø§Ù„Ø¹Ù…Ù„ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ
            </button>
        </div>
        
        <div class="backup-data">
            <div class="data-section">
                <div class="section-title">
                    <span class="section-icon">ğŸ‘¥</span>
                    <span>Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³Ø§Ú©Ù†ÛŒÙ†</span>
                </div>
                <div style="margin-bottom: 10px; font-size: 13px; color: #666;">
                    ${allData.residents.length} Ø³Ø§Ú©Ù† Ø¨Ø§ Ø¬Ø²Ø¦ÛŒØ§Øª Ú©Ø§Ù…Ù„ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯
                </div>
            </div>
            
            <div class="data-section">
                <div class="section-title">
                    <span class="section-icon">ğŸ’°</span>
                    <span>Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒÙ‡Ø§</span>
                </div>
                <div style="margin-bottom: 10px; font-size: 13px; color: #666;">
                    ${allData.payments.length} Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ Ø«Ø¨Øª Ø´Ø¯Ù‡ Ø§Ø³Øª
                </div>
            </div>
            
            <div class="data-section">
                <div class="section-title">
                    <span class="section-icon">ğŸ“</span>
                    <span>Ø¢Ø±Ø´ÛŒÙˆ Ù‚Ø¨ÙˆØ¶</span>
                </div>
                <div style="margin-bottom: 10px; font-size: 13px; color: #666;">
                    ${allData.archive.length} Ø¯ÙˆØ±Ù‡ Ù‚Ø¨Ø¶ Ø¯Ø± Ø¢Ø±Ø´ÛŒÙˆ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯
                </div>
            </div>
            
            <div class="data-section">
                <div class="section-title">
                    <span class="section-icon">âš™ï¸</span>
                    <span>ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³ÛŒØ³ØªÙ…</span>
                </div>
                <div style="margin-bottom: 10px; font-size: 13px; color: #666;">
                    ØªÙ…Ø§Ù… ØªÙ†Ø¸ÛŒÙ…Ø§ØªØŒ ØªÙ…â€ŒÙ‡Ø§ Ùˆ Ù‚Ø§Ù„Ø¨ Ù¾ÛŒØ§Ù…Ú©â€ŒÙ‡Ø§ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯
                </div>
            </div>
            
            <div class="accordion">
                <div class="accordion-header" id="accordionToggleBtn">
                    <span>ğŸ” Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ JSON (Ø¨Ø±Ø§ÛŒ ØªÙˆØ³Ø¹Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ú¯Ø§Ù†)</span>
                    <span>â–¼</span>
                </div>
                <div id="jsonDataContent" class="accordion-content">
                    <pre>${jsonData}</pre>
                </div>
            </div>
        </div>
        
        <div class="backup-footer">
            <div style="margin-bottom: 8px;">
                Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø± Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø§Ø®ØªÙ…Ø§Ù†
            </div>
            <div>
                Ø¨Ø±Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ùˆ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ Ø¨ÛŒØ´ØªØ± Ø¨Ø§ ØªÙˆØ³Ø¹Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ù‡ ØªÙ…Ø§Ø³ Ø¨Ú¯ÛŒØ±ÛŒØ¯
            </div>
        </div>
    </div>
    
    <script>
        function showRestoreInstructions() {
            alert('ğŸ“‹ Ø¯Ø³ØªÙˆØ±Ø§Ù„Ø¹Ù…Ù„ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ:\\n\\n1. ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø±Ø§ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒØ¯\\n2. Ø¯Ø± Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø§ØµÙ„ÛŒ Ø¨Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø±ÙˆÛŒØ¯\\n3. "Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§" Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯\\n4. Ø¯Ú©Ù…Ù‡ "Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ú©Ø§Ù…Ù„ (HTML)" Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯\\n5. Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯\\n\\nâš ï¸ ØªÙˆØ¬Ù‡: Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒØŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ Ø±Ø§ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ù…ÛŒâ€ŒÚ©Ù†Ø¯.');
        }
        
        function toggleAccordion() {
            const content = document.getElementById('jsonDataContent');
            const icon = document.getElementById('accordionToggleBtn').querySelector('span:last-child');
            content.classList.toggle('open');
            icon.textContent = content.classList.contains('open') ? 'â–²' : 'â–¼';
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            const restoreBtn = document.getElementById('restoreInstructionsBtn');
            const accordionBtn = document.getElementById('accordionToggleBtn');
            
            if (restoreBtn) {
                restoreBtn.addEventListener('click', showRestoreInstructions);
            }
            
            if (accordionBtn) {
                accordionBtn.addEventListener('click', toggleAccordion);
            }
        });
    <\/script>
</body>
</html>`;
                    
                    const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' });
                    const url = URL.createObjectURL(blob);
                    
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `Ù¾Ø´ØªÛŒØ¨Ø§Ù†_Ø³Ø§Ø®ØªÙ…Ø§Ù†_${new Date().getFullYear()}${String(new Date().getMonth()+1).padStart(2,'0')}${String(new Date().getDate()).padStart(2,'0')}_${String(new Date().getHours()).padStart(2,'0')}${String(new Date().getMinutes()).padStart(2,'0')}.html`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    showNotification('Ù¾Ø´ØªÛŒØ¨Ø§Ù† HTML Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯');
                } catch (error) {
                    console.error('Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ Ù¾Ø´ØªÛŒØ¨Ø§Ù† HTML:', error);
                    showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ Ù¾Ø´ØªÛŒØ¨Ø§Ù†', 'error');
                }
            }
            
            async function importHTMLBackup() {
                try {
                    const input = document.createElement('input');
                    input.type = 'file';
                    input.accept = '.html,.htm';
                    
                    input.onchange = async (e) => {
                        const file = e.target.files[0];
                        if (!file) return;
                        
                        const text = await file.text();
                        
                        const jsonMatch = text.match(/const data = ({[\s\S]*?});/);
                        let backupData;
                        
                        if (jsonMatch) {
                            backupData = JSON.parse(jsonMatch[1]);
                        } else {
                            const preMatch = text.match(/<pre[^>]*>([\s\S]*?)<\/pre>/);
                            if (!preMatch) {
                                throw new Error('ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª');
                            }
                            
                            const jsonStr = preMatch[1].trim();
                            backupData = JSON.parse(jsonStr);
                        }
                        
                        if (!backupData.residents || !Array.isArray(backupData.residents)) {
                            throw new Error('Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª');
                        }
                        
                        if (confirm('Ø¢ÛŒØ§ Ø§Ø² Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.')) {
                            if (backupData.localStorage) {
                                localStorage.clear();
                                
                                Object.keys(backupData.localStorage).forEach(key => {
                                    localStorage.setItem(key, backupData.localStorage[key]);
                                });
                            }
                            
                            if (!localStorage.getItem('defaultMiscMethod')) {
                                localStorage.setItem('defaultMiscMethod', 'per_unit');
                            }
                            
                            residents = loadFromStorage('residents') || [];
                            payments = loadFromStorage('payments') || [];
                            
                            const savedTheme = localStorage.getItem('appTheme') || 'blue';
                            document.documentElement.setAttribute('data-theme', savedTheme);
                            themeButtons.forEach(btn => {
                                btn.classList.remove('active');
                                if (btn.dataset.theme === savedTheme) {
                                    btn.classList.add('active');
                                }
                            });
                            
                            updateResidentsList();
                            updateUnitReportFilter();
                            updatePaymentsTable();
                            updateWaterList();
                            updateElectricityList();
                            updateGasList();
                            updateElevatorList();
                            updateCleaningList();
                            updateMiscList();
                            
                            showNotification('Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯');
                        }
                    };
                    
                    input.click();
                } catch (error) {
                    console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†:', error);
                    showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†', 'error');
                }
            }
            
            function clearOldPayments() {
                if (payments.length === 0) {
                    showNotification('Ù‡ÛŒÚ† Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯', 'info');
                    return;
                }
                
                if (confirm('Ø¢ÛŒØ§ Ø§Ø² Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ù†ÛŒØ³Øª.')) {
                    const sixMonthsAgo = new Date();
                    sixMonthsAgo.setMonth(sixMonthsAgo.getMonth() - 6);
                    
                    payments = payments.filter(payment => {
                        const paymentDate = new Date(payment.createdAt);
                        return paymentDate >= sixMonthsAgo;
                    });
                    
                    saveToStorage('payments', payments);
                    updatePaymentsTable();
                    updatePaymentsStats();
                    
                    showNotification('Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø´Ø¯Ù†Ø¯');
                }
            }

            // ==================== ØªÙˆØ§Ø¨Ø¹ Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù…Ú© ====================
            async function copyToClipboard(text) {
                try {
                    await navigator.clipboard.writeText(text);
                    return true;
                } catch (err) {
                    console.error('Ø®Ø·Ø§ Ø¯Ø± Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù†:', err);
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    document.body.appendChild(textArea);
                    textArea.select();
                    try {
                        document.execCommand('copy');
                        return true;
                    } catch (e) {
                        console.error('Ø®Ø·Ø§ Ø¯Ø± Ø±ÙˆØ´ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ†:', e);
                        return false;
                    } finally {
                        document.body.removeChild(textArea);
                    }
                }
            }
            
            window.sendWaterSMS = async function(id) {
                const share = waterShares.find(s => s.id === id);
                if (share) {
                    const smsTemplate = localStorage.getItem('smsTemplate') || document.getElementById('smsTemplate').value;
                    const period = document.getElementById('waterPeriod').value;
                    const total = document.getElementById('waterTotal').value;
                    const billId = document.getElementById('waterBillId').value;
                    
                    let message = smsTemplate
                        .replace(/{billType}/g, 'Ø¢Ø¨')
                        .replace(/{period}/g, period)
                        .replace(/{totalAmount}/g, total)
                        .replace(/{shareAmount}/g, formatEnglishNumber(share.amount))
                        .replace(/{unitNumber}/g, share.unit)
                        .replace(/{residentName}/g, share.name);
                    
                    if (billId) {
                        message += `\nØ´Ù†Ø§Ø³Ù‡ Ù‚Ø¨Ø¶: ${billId}`;
                    }
                    
                    const success = await copyToClipboard(message);
                    if (success) {
                        showNotification(`Ù¾ÛŒØ§Ù…Ú© Ø¨Ø±Ø§ÛŒ ${share.name} Ø¯Ø± Ú©Ù„ÛŒÙ¾â€ŒØ¨Ø±Ø¯ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯`);
                    } else {
                        showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù¾ÛŒØ§Ù…Ú© Ø¯Ø± Ú©Ù„ÛŒÙ¾â€ŒØ¨Ø±Ø¯', 'error');
                    }
                }
            };
            
            window.sendElectricitySMS = async function(id) {
                const share = electricityShares.find(s => s.id === id);
                if (share) {
                    const smsTemplate = localStorage.getItem('smsTemplate') || document.getElementById('smsTemplate').value;
                    const period = document.getElementById('electricityPeriod').value;
                    const total = document.getElementById('electricityTotal').value;
                    const billId = document.getElementById('electricityBillId').value;
                    
                    let message = smsTemplate
                        .replace(/{billType}/g, 'Ø¨Ø±Ù‚')
                        .replace(/{period}/g, period)
                        .replace(/{totalAmount}/g, total)
                        .replace(/{shareAmount}/g, formatEnglishNumber(share.amount))
                        .replace(/{unitNumber}/g, share.unit)
                        .replace(/{residentName}/g, share.name);
                    
                    if (billId) {
                        message += `\nØ´Ù†Ø§Ø³Ù‡ Ù‚Ø¨Ø¶: ${billId}`;
                    }
                    
                    const success = await copyToClipboard(message);
                    if (success) {
                        showNotification(`Ù¾ÛŒØ§Ù…Ú© Ø¨Ø±Ø§ÛŒ ${share.name} Ø¯Ø± Ú©Ù„ÛŒÙ¾â€ŒØ¨Ø±Ø¯ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯`);
                    } else {
                        showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù¾ÛŒØ§Ù…Ú© Ø¯Ø± Ú©Ù„ÛŒÙ¾â€ŒØ¨Ø±Ø¯', 'error');
                    }
                }
            };
            
            window.sendGasSMS = async function(id) {
                const share = gasShares.find(s => s.id === id);
                if (share) {
                    const smsTemplate = localStorage.getItem('smsTemplate') || document.getElementById('smsTemplate').value;
                    const period = document.getElementById('gasPeriod').value;
                    const total = document.getElementById('gasTotal').value;
                    const billId = document.getElementById('gasBillId').value;
                    
                    let message = smsTemplate
                        .replace(/{billType}/g, 'Ú¯Ø§Ø²')
                        .replace(/{period}/g, period)
                        .replace(/{totalAmount}/g, total)
                        .replace(/{shareAmount}/g, formatEnglishNumber(share.amount))
                        .replace(/{unitNumber}/g, share.unit)
                        .replace(/{residentName}/g, share.name);
                    
                    if (billId) {
                        message += `\nØ´Ù†Ø§Ø³Ù‡ Ù‚Ø¨Ø¶: ${billId}`;
                    }
                    
                    const success = await copyToClipboard(message);
                    if (success) {
                        showNotification(`Ù¾ÛŒØ§Ù…Ú© Ø¨Ø±Ø§ÛŒ ${share.name} Ø¯Ø± Ú©Ù„ÛŒÙ¾â€ŒØ¨Ø±Ø¯ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯`);
                    } else {
                        showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù¾ÛŒØ§Ù…Ú© Ø¯Ø± Ú©Ù„ÛŒÙ¾â€ŒØ¨Ø±Ø¯', 'error');
                    }
                }
            };
            
            window.sendElevatorSMS = async function(id) {
                const share = elevatorShares.find(s => s.id === id);
                if (share) {
                    const smsTemplate = localStorage.getItem('smsTemplate') || document.getElementById('smsTemplate').value;
                    const period = document.getElementById('elevatorPeriod').value;
                    const total = document.getElementById('elevatorTotal').value;
                    const description = document.getElementById('elevatorDescription').value;
                    
                    let message = smsTemplate
                        .replace(/{billType}/g, 'Ø¢Ø³Ø§Ù†Ø³ÙˆØ±')
                        .replace(/{period}/g, period)
                        .replace(/{totalAmount}/g, total)
                        .replace(/{shareAmount}/g, formatEnglishNumber(share.amount))
                        .replace(/{unitNumber}/g, share.unit)
                        .replace(/{residentName}/g, share.name);
                    
                    if (description) {
                        message += `\nØªÙˆØ¶ÛŒØ­Ø§Øª: ${description}`;
                    }
                    
                    const success = await copyToClipboard(message);
                    if (success) {
                        showNotification(`Ù¾ÛŒØ§Ù…Ú© Ø¨Ø±Ø§ÛŒ ${share.name} Ø¯Ø± Ú©Ù„ÛŒÙ¾â€ŒØ¨Ø±Ø¯ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯`);
                    } else {
                        showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù¾ÛŒØ§Ù…Ú© Ø¯Ø± Ú©Ù„ÛŒÙ¾â€ŒØ¨Ø±Ø¯', 'error');
                    }
                }
            };
            
            window.sendCleaningSMS = async function(id) {
                const share = cleaningShares.find(s => s.id === id);
                if (share) {
                    const smsTemplate = localStorage.getItem('smsTemplate') || document.getElementById('smsTemplate').value;
                    const period = document.getElementById('cleaningPeriod').value;
                    const total = document.getElementById('cleaningTotal').value;
                    const description = document.getElementById('cleaningDescription').value;
                    
                    let message = smsTemplate
                        .replace(/{billType}/g, 'Ù†Ø¸Ø§ÙØª')
                        .replace(/{period}/g, period)
                        .replace(/{totalAmount}/g, total)
                        .replace(/{shareAmount}/g, formatEnglishNumber(share.amount))
                        .replace(/{unitNumber}/g, share.unit)
                        .replace(/{residentName}/g, share.name);
                    
                    if (description) {
                        message += `\nØªÙˆØ¶ÛŒØ­Ø§Øª: ${description}`;
                    }
                    
                    const success = await copyToClipboard(message);
                    if (success) {
                        showNotification(`Ù¾ÛŒØ§Ù…Ú© Ø¨Ø±Ø§ÛŒ ${share.name} Ø¯Ø± Ú©Ù„ÛŒÙ¾â€ŒØ¨Ø±Ø¯ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯`);
                    } else {
                        showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù¾ÛŒØ§Ù…Ú© Ø¯Ø± Ú©Ù„ÛŒÙ¾â€ŒØ¨Ø±Ø¯', 'error');
                    }
                }
            };
            
            window.sendMiscSMS = async function(id) {
                const share = miscShares.find(s => s.id === id);
                if (share) {
                    const smsTemplate = localStorage.getItem('smsTemplate') || document.getElementById('smsTemplate').value;
                    const period = document.getElementById('miscPeriod').value;
                    const total = document.getElementById('miscTotal').value;
                    const description = document.getElementById('miscDescription').value;
                    
                    let message = smsTemplate
                        .replace(/{billType}/g, 'Ù…ØªÙØ±Ù‚Ù‡')
                        .replace(/{period}/g, period)
                        .replace(/{totalAmount}/g, total)
                        .replace(/{shareAmount}/g, formatEnglishNumber(share.amount))
                        .replace(/{unitNumber}/g, share.unit)
                        .replace(/{residentName}/g, share.name);
                    
                    if (description) {
                        message += `\nØªÙˆØ¶ÛŒØ­Ø§Øª: ${description}`;
                    }
                    
                    const success = await copyToClipboard(message);
                    if (success) {
                        showNotification(`Ù¾ÛŒØ§Ù…Ú© Ø¨Ø±Ø§ÛŒ ${share.name} Ø¯Ø± Ú©Ù„ÛŒÙ¾â€ŒØ¨Ø±Ø¯ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯`);
                    } else {
                        showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù¾ÛŒØ§Ù…Ú© Ø¯Ø± Ú©Ù„ÛŒÙ¾â€ŒØ¨Ø±Ø¯', 'error');
                    }
                }
            };

            // ==================== ØªÙˆØ§Ø¨Ø¹ Ø¢Ø±Ø´ÛŒÙˆ ====================
window.viewArchiveDetails = function(recordId) {
    try {
        const archive = loadFromStorage('archive') || [];
        const record = archive.find(r => r.id == recordId);
        
        if (!record) {
            showNotification('Ø±Ú©ÙˆØ±Ø¯ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯', 'error');
            return;
        }
        
        let detailsHTML = `
            <div class="category-title">${getBillTypeName(record.billType)}</div>
            <div style="margin-bottom: 16px;">
                <div class="summary-row">
                    <span>Ø¯ÙˆØ±Ù‡:</span>
                    <span>${record.period}</span>
                </div>
                <div class="summary-row">
                    <span>Ù…Ø¨Ù„Øº Ú©Ù„:</span>
                    <span>${formatEnglishNumber(record.total)} ØªÙˆÙ…Ø§Ù†</span>
                </div>
                <div class="summary-row">
                    <span>Ø±ÙˆØ´ Ù…Ø­Ø§Ø³Ø¨Ù‡:</span>
                    <span>${getMethodName(record.method)}</span>
                </div>
        `;
        
        // Ù†Ù…Ø§ÛŒØ´ ØªÙˆØ¶ÛŒØ­Ø§Øª
        if (record.description) {
            detailsHTML += `
                <div class="summary-row">
                    <span>ØªÙˆØ¶ÛŒØ­Ø§Øª:</span>
                    <span>${record.description}</span>
                </div>
            `;
        }
        
        // Ù†Ù…Ø§ÛŒØ´ Ø´Ù†Ø§Ø³Ù‡ Ù‚Ø¨Ø¶ Ø¨Ø±Ø§ÛŒ Ø¢Ø¨ØŒ Ø¨Ø±Ù‚ØŒ Ú¯Ø§Ø²
        if (record.billId && ['water', 'electricity', 'gas'].includes(record.billType)) {
            detailsHTML += `
                <div class="summary-row">
                    <span>Ø´Ù†Ø§Ø³Ù‡ Ù‚Ø¨Ø¶:</span>
                    <span>${record.billId}</span>
                </div>
            `;
        }
        
        detailsHTML += `
                <div class="summary-row">
                    <span>ØªØ§Ø±ÛŒØ® Ø«Ø¨Øª:</span>
                    <span>${new Date(record.createdAt).toLocaleDateString('fa-IR')}</span>
                </div>
            </div>
        `;
        
        // Ù†Ù…Ø§ÛŒØ´ Ø³Ù‡Ù… ÙˆØ§Ø­Ø¯Ù‡Ø§
        if (record.shares && record.shares.length > 0) {
            detailsHTML += `
                <div class="category-title">Ø³Ù‡Ù… ÙˆØ§Ø­Ø¯Ù‡Ø§</div>
                <div style="max-height: 300px; overflow-y: auto; margin-top: 10px;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ÙˆØ§Ø­Ø¯</th>
                                <th>Ù†Ø§Ù…</th>
                                <th>${record.billType === 'gas' ? 'Ù…ØªØ±Ø§Ú˜' : 
                                    (record.billType === 'elevator' || record.billType === 'cleaning' || record.billType === 'misc') ? 'ÙˆØ§Ø­Ø¯Ù‡Ø§' : 'Ù†ÙØ±Ø§Øª'}</th>
                                <th>Ø³Ù‡Ù…</th>
                                <th>ØªÙˆØ¶ÛŒØ­Ø§Øª</th> <!-- âœ… Ø³ØªÙˆÙ† Ø¬Ø¯ÛŒØ¯ -->
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            record.shares.forEach(share => {
                const value = record.billType === 'gas' ? share.area : 
                            (record.billType === 'elevator' || record.billType === 'cleaning' || record.billType === 'misc') ? 1 : share.count;
                
                detailsHTML += `
                    <tr>
                        <td>${share.unit}</td>
                        <td>${share.name}</td>
                        <td dir="ltr">${formatEnglishNumber(value)}</td>
                        <td dir="ltr">${formatEnglishNumber(share.amount)}</td>
                        <td>${record.description || '-'}</td> <!-- âœ… ØªÙˆØ¶ÛŒØ­Ø§Øª Ø¯Ø± Ù‡Ø± Ø±Ø¯ÛŒÙ -->
                    </tr>
                `;
            });
            
            detailsHTML += `
                        </tbody>
                    </table>
                </div>
            `;
        }
        
        detailsHTML += `
            <div class="form-actions" style="margin-top: 20px;">
                <button class="btn btn-warning" onclick="printSingleArchiveRecord(${recordId})">
                    Ú†Ø§Ù¾/Ø°Ø®ÛŒØ±Ù‡ PDF
                </button>
                <button class="btn btn-primary" onclick="exportArchiveToCSV(${recordId})">
                    Ø¯Ø±ÛŒØ§ÙØª CSV
                </button>
            </div>
        `;
        
        const modal = document.createElement('div');
        modal.className = 'settings-modal';
        modal.style.display = 'flex';
        modal.innerHTML = `
            <div class="settings-content">
                <div class="settings-header">
                    <div class="settings-title">Ø¬Ø²Ø¦ÛŒØ§Øª Ø¯ÙˆØ±Ù‡ ${record.period}</div>
                    <button class="close-settings-btn" onclick="this.parentElement.parentElement.parentElement.remove()">Ã—</button>
                </div>
                <div>${detailsHTML}</div>
            </div>
        `;
        
        document.body.appendChild(modal);
        
        modal.addEventListener('click', function(e) {
            if (e.target === this) {
                this.remove();
            }
        });
    } catch (error) {
        console.error('Ø®Ø·Ø§ Ø¯Ø± Ù†Ù…Ø§ÛŒØ´ Ø¬Ø²Ø¦ÛŒØ§Øª:', error);
        showNotification('Ø®Ø·Ø§ Ø¯Ø± Ù†Ù…Ø§ÛŒØ´ Ø¬Ø²Ø¦ÛŒØ§Øª Ø¯ÙˆØ±Ù‡', 'error');
    }
};
            
            window.deleteArchiveRecord = function(recordId) {
                if (confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ø¯ÙˆØ±Ù‡ Ø§Ø² Ø¢Ø±Ø´ÛŒÙˆ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ù†ÛŒØ³Øª.')) {
                    try {
                        let archive = loadFromStorage('archive') || [];
                        archive = archive.filter(r => r.id !== recordId);
                        saveToStorage('archive', archive);
                        updateArchiveList();
                        showNotification('Ø¯ÙˆØ±Ù‡ Ø­Ø°Ù Ø´Ø¯');
                    } catch (error) {
                        console.error('Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ø±Ú©ÙˆØ±Ø¯:', error);
                        showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ø¯ÙˆØ±Ù‡', 'error');
                    }
                }
            };

            // ==================== Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÙˆØ¯Ø§Ù„ Ú¯Ø²Ø§Ø±Ø´ ÙˆØ§Ø­Ø¯ ====================
            const unitReportModal = document.getElementById('unitReportModal');
            const closeUnitReportBtn = document.getElementById('closeUnitReportBtn');
            const printUnitReportBtn = document.getElementById('printUnitReportBtn');
            const exportUnitReportPDFBtn = document.getElementById('exportUnitReportPDFBtn');
            
            closeUnitReportBtn.addEventListener('click', function() {
                unitReportModal.style.display = 'none';
            });
            
            unitReportModal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.style.display = 'none';
                }
            });
            
            printUnitReportBtn.addEventListener('click', function() {
                showNotification('Ø¨Ø±Ø§ÛŒ Ú†Ø§Ù¾ ÛŒØ§ Ø°Ø®ÛŒØ±Ù‡ PDFØŒ Ù¾Ù†Ø¬Ø±Ù‡ Ú†Ø§Ù¾ Ù…Ø±ÙˆØ±Ú¯Ø± Ø¨Ø§Ø² Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯. Ø¯Ø± Ù¾Ù†Ø¬Ø±Ù‡ Ú†Ø§Ù¾ØŒ Ú¯Ø²ÛŒÙ†Ù‡ "Ø°Ø®ÛŒØ±Ù‡ Ø¨Ù‡ PDF" Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.', 'info');
                setTimeout(() => {
                    window.print();
                }, 300);
            });
            
            // ==================== Ø¯Ú©Ù…Ù‡ Ú†Ø§Ù¾/Ø°Ø®ÛŒØ±Ù‡ PDF Ø¯Ø± ØªØ¨ Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒÙ‡Ø§ ====================
            exportUnitReportBtn.addEventListener('click', function() {
                const unitNumber = document.getElementById('unitReportFilter').value;
                
                if (!unitNumber) {
                    showNotification('Ù„Ø·ÙØ§Ù‹ ÛŒÚ© ÙˆØ§Ø­Ø¯ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯', 'error');
                    return;
                }
                
                generateUnitReport();
                
                setTimeout(() => {
                    showNotification('Ø¨Ø±Ø§ÛŒ Ú†Ø§Ù¾ ÛŒØ§ Ø°Ø®ÛŒØ±Ù‡ PDF Ú¯Ø²Ø§Ø±Ø´ØŒ Ù¾Ù†Ø¬Ø±Ù‡ Ú†Ø§Ù¾ Ù…Ø±ÙˆØ±Ú¯Ø± Ø¨Ø§Ø² Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯. Ø¯Ø± Ù¾Ù†Ø¬Ø±Ù‡ Ú†Ø§Ù¾ØŒ Ú¯Ø²ÛŒÙ†Ù‡ "Ø°Ø®ÛŒØ±Ù‡ Ø¨Ù‡ PDF" Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.', 'info');
                    setTimeout(() => {
                        window.print();
                    }, 1000);
                }, 500);
            });

            // ==================== Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† ====================
            function showNotification(message, type = 'info') {
    // Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ info (Ø¢Ø¨ÛŒ) Ù†Ø´Ø§Ù† Ø¯Ø§Ø¯Ù‡ Ù†Ø´ÙˆØ¯
    if (type === 'info') return;
    
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.textContent = message;
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.remove();
    }, 3000);
}

            // ==================== Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø§Ø¹Ø¯Ø§Ø¯ ====================
            function setupNumberInputValidation() {
                const numberInputs = document.querySelectorAll('.number-input, .payment-input');
                
                numberInputs.forEach(input => {
                    input.addEventListener('input', function(e) {
                        let value = this.value;
                        value = value.replace(/[^\d,]/g, '');
                        value = value.replace(/,+/g, ',');
                        if (value.startsWith(',')) {
                            value = value.substring(1);
                        }
                        this.value = value;
                    });
                    
                    input.addEventListener('blur', function() {
                        if (this.value) {
                            const num = parseEnglishNumber(this.value);
                            if (!isNaN(num)) {
                                this.value = formatEnglishNumber(num);
                            }
                        }
                    });
                });
            }

                // ==================== Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ ====================
            setupNumberInputValidation();
            updateResidentsList();
            updateUnitReportFilter();
            updatePaymentsTable();
            
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ùˆ Ø§Ø¹Ù…Ø§Ù„ Ø±ÙˆÛŒ ÙÛŒÙ„Ø¯Ù‡Ø§
            loadDefaultSettings();
            
            // Ø§Ø¬Ø±Ø§ÛŒ ØªØ§Ø¨Ø¹ ØªÙ†Ø¸ÛŒÙ… Ø¹Ø±Ø¶ ØªØ¨â€ŒÙ‡Ø§
            setTimeout(adjustTabWidths, 100);
            
            // Ø³Ø§Ø²Ú¯Ø§Ø±ÛŒ Ø¨Ø§ Ù†Ø³Ø®Ù‡â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ
            if (!localStorage.getItem('defaultMiscMethod')) {
                localStorage.setItem('defaultMiscMethod', 'per_unit');
            }
            
            const today = new Date();
            const persianDate = gregorianToPersian(today);
            const currentYear = today.getFullYear() - 621;
            const currentMonth = String(today.getMonth() + 1).padStart(2, '0');
            
            document.getElementById('paymentPeriod').value = `${currentYear}/${currentMonth}`;
            document.getElementById('paymentDate').value = persianDate;
            
            // ÙØ±Ù…Øª Ø®ÙˆØ¯Ú©Ø§Ø± ØªØ§Ø±ÛŒØ® Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„ØªØ±Ù‡Ø§
            function setupDateAutoFormat() {
                const fromInput = document.getElementById('filterDateFrom');
                const toInput = document.getElementById('filterDateTo');
                
                function formatDate(value) {
                    if (!value) return '';
                    value = value.replace(/[^\d]/g, '');
                    if (value.length > 4) {
                        value = value.slice(0, 4) + '/' + value.slice(4);
                    }
                    if (value.length > 7) {
                        value = value.slice(0, 7) + '/' + value.slice(7, 9);
                    }
                    return value;
                }
                
                if (fromInput) {
                    fromInput.addEventListener('input', function() {
                        this.value = formatDate(this.value);
                    });
                }
                
                if (toInput) {
                    toInput.addEventListener('input', function() {
                        this.value = formatDate(this.value);
                    });
                }
            }
            
            setTimeout(setupDateAutoFormat, 500);      
            setQuickDateRange('last3Months');
            
            console.log('âœ… Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø± Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø§Ø®ØªÙ…Ø§Ù† Ù†Ø³Ø®Ù‡ Û¶.Û° Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯');
            console.log('âœ¨ ØªØºÛŒÛŒØ±Ø§Øª Ø§Ø¹Ù…Ø§Ù„ Ø´Ø¯Ù‡:');
            console.log('1. âœ… Û¸ ØªÙ… Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ Ø±Ù†Ú¯â€ŒØ¨Ù†Ø¯ÛŒ Ø²ÛŒØ¨Ø§ Ùˆ Ø§ÛŒÙ…ÙˆØ¬ÛŒ');
            console.log('2. âœ… Ø·Ø±Ø§Ø­ÛŒ Ø¬Ø¯ÛŒØ¯ Ù‡Ø¯Ø± Ø¨Ø§ Ú©Ø§Ø±Øª Ø¹Ù†ÙˆØ§Ù† Ùˆ ØªÙ…â€ŒÙ‡Ø§');
            console.log('3. âœ… Ø³ÛŒØ³ØªÙ… ØªØ¨â€ŒÙ‡Ø§ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¨Ø§ Ø¹Ø±Ø¶ Ø®ÙˆØ¯Ú©Ø§Ø±');
            console.log('4. âœ… Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ ØªÙ… Ø¯Ø± ÛŒÚ© Ø®Ø· (Ø­ØªÛŒ Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„)');
            console.log('5. âœ… Ø°Ø®ÛŒØ±Ù‡ Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± ØªÙ… Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡');
            console.log('6. âœ… Ø¨Ù‡Ø¨ÙˆØ¯ Ø±ÛŒØ³Ù¾Ø§Ù†Ø³ÛŒÙˆ Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ù‡ Ø¯Ø³ØªÚ¯Ø§Ù‡â€ŒÙ‡Ø§');
            console.log('7. âœ… Ø§ØµÙ„Ø§Ø­ ØªÙˆØ§Ø¨Ø¹ ØªØ§Ø±ÛŒØ® Ø´Ù…Ø³ÛŒ');
            console.log('8. âœ… Ø§ØµÙ„Ø§Ø­ Ù†Ù…Ø§ÛŒØ´ Ø¬Ø²Ø¦ÛŒØ§Øª Ø¢Ø±Ø´ÛŒÙˆ');
            console.log('9. âœ… Ø§ÙØ²ÙˆØ¯Ù† ÙÛŒÙ„Ø¯ ØªÙˆØ¶ÛŒØ­Ø§Øª Ø¯Ø± Ù¾Ø±Ø¯Ø§Ø®ØªÛŒâ€ŒÙ‡Ø§');
            console.log('10. âœ… Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù† Ø¨Ø®Ø´ "Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø±"');
        });
    </script>
</body>
</html>
